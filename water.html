<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ê∞¥ÊßΩ„Éë„Ç∫„É´ | „Å±„Å±„ÇìÂºè</title>
    <script src="ranking.js"></script>
    <style>
        body {
            font-family: "UD Digital Kyokasho-tai-R", sans-serif;
            background-color: #e0f7fa; /* Ê∞¥„Å£„ÅΩ„ÅÑËÉåÊôØ */
            text-align: center;
            padding: 20px;
            margin: 0;
            color: #006064;
            touch-action: manipulation;
            user-select: none;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            position: relative;
        }

        h1 { margin: 0 0 10px 0; color: #00bcd4; font-size: 24px; }

        /* „Ç≤„Éº„É†ÊÉÖÂ†±„Ç®„É™„Ç¢ */
        .info-bar {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 10px; font-weight: bold; font-size: 14px; color: #aaa;
        }

        /* ÂïèÈ°åÊñá„Ç®„É™„Ç¢ */
        .question-text {
            font-size: 24px; font-weight: bold; color: #0277bd;
            margin-bottom: 20px;
            background: #e1f5fe; padding: 15px; border-radius: 10px;
            border: 2px solid #b3e5fc;
            box-shadow: 0 4px #81d4fa;
        }

        /* Ê∞¥ÊßΩ„Ç®„É™„Ç¢ */
        .tank-wrapper {
            position: relative;
            width: 200px;
            height: 300px;
            margin: 0 auto 20px auto;
            border: 8px solid #b0bec5;
            border-top: none; 
            border-radius: 0 0 20px 20px;
            background: rgba(255, 255, 255, 0.5);
            box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
            overflow: hidden; 
        }

        /* ÁõÆÁõõ„ÇäÁ∑ö */
        .ticks {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
        }
        .tick {
            position: absolute; left: 0; width: 20px; height: 1px; background: #90a4ae;
        }
        .tick.major { width: 40px; background: #546e7a; }
        .tick-label {
            position: absolute; left: 45px; font-size: 12px; color: #546e7a; transform: translateY(-50%);
        }

        /* „Çø„Éº„Ç≤„ÉÉ„Éà„É©„Ç§„É≥ */
        .target-line {
            position: absolute;
            left: 0; width: 100%; height: 2px;
            background: #ff1744;
            z-index: 10;
            transition: bottom 0.5s;
        }
        .target-tag {
            position: absolute; right: 0; top: -22px;
            background: #ff1744; color: white;
            font-size: 14px; padding: 2px 8px;
            border-radius: 4px 0 0 4px; font-weight: bold;
        }

        /* Ê∞¥ */
        .water {
            position: absolute;
            bottom: 0; left: 0; width: 100%;
            height: 0%;
            background: linear-gradient(to top, #0288d1, #4fc3f7);
            opacity: 0.8;
            transition: height 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
            z-index: 1;
        }
        .water::after {
            content: ""; position: absolute; top: -10px; left: 0; width: 100%; height: 20px;
            background: rgba(255,255,255,0.3); border-radius: 50%;
        }

        /* „Éá„Ç∏„Çø„É´Ë°®Á§∫ */
        .digital-display {
            background: #263238; color: #00e676;
            font-family: monospace; font-size: 32px;
            padding: 10px 20px; border-radius: 10px;
            display: inline-block; margin-bottom: 20px;
            border: 4px solid #555;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.5);
        }

        /* „Ç≥„ÉÉ„ÉóÔºàÊìç‰Ωú„Éú„Çø„É≥Ôºâ */
        .cup-area {
            display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;
        }
        .cup-btn {
            position: relative;
            width: 70px; height: 80px;
            border: none;
            background: #fff;
            border: 3px solid #ddd;
            border-radius: 5px 5px 20px 20px;
            cursor: pointer;
            transition: transform 0.1s;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            font-weight: bold; color: #555;
            box-shadow: 0 4px rgba(0,0,0,0.1);
        }
        .cup-btn:active { transform: translateY(5px) rotate(-10deg); }
        .cup-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .cup-water {
            position: absolute; bottom: 5px; left: 5px; right: 5px;
            border-radius: 0 0 15px 15px; opacity: 0.6;
        }
        
        .cup-1-2  { border-color: #29b6f6; color: #01579b; }
        .cup-1-2 .cup-water { height: 80%; background: #29b6f6; }
        
        .cup-1-4  { border-color: #66bb6a; color: #1b5e20; }
        .cup-1-4 .cup-water { height: 40%; background: #66bb6a; }

        .cup-1-5  { border-color: #ffa726; color: #e65100; }
        .cup-1-5 .cup-water { height: 35%; background: #ffa726; }

        .cup-1-10 { border-color: #ef5350; color: #b71c1c; }
        .cup-1-10 .cup-water { height: 20%; background: #ef5350; }

        .cup-label { z-index: 2; font-size: 22px; text-shadow: 0 0 5px rgba(255,255,255,0.8); }
        .cup-sub { z-index: 2; font-size: 14px; margin-top: 2px; color:#555;}

        /* „Ç≥„É≥„Éà„É≠„Éº„É´ */
        .controls { margin-top: 20px; }
        .reset-btn {
            background: #ff5252; color: white; border: none; padding: 10px 20px;
            border-radius: 30px; font-weight: bold; cursor: pointer;
            box-shadow: 0 4px #d32f2f;
        }
        .reset-btn:active { transform: translateY(2px); box-shadow: none; }

        /* „É°„ÉÉ„Çª„Éº„Ç∏ */
        #msg-area {
            height: 30px; margin-top: 10px; font-weight: bold; color: #e91e63;
        }

        .back-link { display: inline-block; margin-top: 30px; color: #00838f; text-decoration: underline; }

        /* ÁµêÊûúÁîªÈù¢ */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.95); z-index: 100;
            display: none; flex-direction: column; justify-content: center; align-items: center;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>üíß „Å¥„Å£„Åü„ÇäÊ∫Ä„Çø„É≥ÔºÅ</h1>
    
    <div class="info-bar">
        <span>‚è±Ô∏è „Çø„Ç§„É†„Ç¢„Çø„ÉÉ„ÇØ</span>
        <span id="q-count">„ÇÇ„Çì„Å†„ÅÑ - / 5</span>
    </div>

    <div id="question-text" class="question-text">
        0.0L „Å´„Åó„Å¶„Å≠
    </div>

    <div class="tank-wrapper">
        <div class="ticks" id="ticks-container">
            </div>
        <div class="target-line" id="target-line" style="bottom: 50%;">
            <div class="target-tag" id="target-tag">0.5</div>
        </div>
        <div class="water" id="water"></div>
    </div>

    <div class="digital-display">
        <span id="current-display">0.00</span> L
    </div>

    <div id="msg-area"></div>

    <div class="cup-area" id="cup-area">
        </div>

    <div class="controls">
        <button class="reset-btn" onclick="resetWater()">Ê∞¥„Çí„Åô„Å¶„Çã („É™„Çª„ÉÉ„Éà)</button>
    </div>

    <br>
    <a href="index.html" class="back-link">üè† „Éõ„Éº„É†„Å∏„ÇÇ„Å©„Çã</a>
</div>

<div id="result-screen" class="overlay">
    <div style="font-size:80px;">üèÜ</div>
    <h2 style="color:#00bcd4; font-size:32px; margin:10px 0;">ÂÖ®„ÇÇ„Çì„ÇØ„É™„Ç¢ÔºÅ</h2>
    <p style="font-size:24px; font-weight:bold; color:#e91e63;">„Çø„Ç§„É†: <span id="final-time">0.0</span>Áßí</p>
    
    <div style="margin-top:20px; display:flex; gap:10px;">
        <button onclick="location.reload()" style="padding:10px 20px; font-size:16px; background:#4dd0e1; color:white; border:none; border-radius:30px; font-weight:bold; cursor:pointer;">
            „ÇÇ„ÅÜ„ÅÑ„Å£„Åã„ÅÑ
        </button>
        
        <a href="index.html" style="padding:10px 20px; font-size:16px; background:#90a4ae; color:white; text-decoration:none; border-radius:30px; font-weight:bold; display:inline-block;">
            üè† „Éõ„Éº„É†„Å∏
        </a>
        </div>
</div>

<script>
    let currentVolume = 0;
    let targetVolume = 0;
    let questions = []; 
    let currentQIndex = 0;
    let startTime = 0;

    // „Ç≥„ÉÉ„Éó„ÅÆÂÆöÁæ©
    const CUP_TYPES = {
        '1/2':  { val: 50, label: '1/2',  sub: 'L', cls: 'cup-1-2' },
        '1/4':  { val: 25, label: '1/4',  sub: 'L', cls: 'cup-1-4' },
        '1/5':  { val: 20, label: '1/5',  sub: 'L', cls: 'cup-1-5' },
        '1/10': { val: 10, label: '1/10', sub: 'L', cls: 'cup-1-10' }
    };

    window.onload = function() {
        createTicks();
        initGame();
        
        const cupArea = document.getElementById('cup-area');
        for (let key in CUP_TYPES) {
            const info = CUP_TYPES[key];
            const btn = document.createElement('button');
            btn.className = `cup-btn ${info.cls}`;
            btn.innerHTML = `
                <div class="cup-water"></div>
                <div class="cup-label">${info.label}</div>
                <div class="cup-sub">${info.sub}</div>
            `;
            btn.onclick = () => pourWater(info.val);
            cupArea.appendChild(btn);
        }
    };

    function initGame() {
        const allTargets = [];
        // 0.1, 0.2 ... 1.0 (10„Äú100)
        for (let i = 1; i <= 10; i++) {
            allTargets.push(i * 10);
        }
        // „Åï„Çâ„Å´ 0.25, 0.75, 0.85 „ÇíËøΩÂä†
        allTargets.push(25, 75, 85);

        // „Ç∑„É£„ÉÉ„Éï„É´„Åó„Å¶5ÂÄãÈÅ∏„Å∂
        allTargets.sort(() => Math.random() - 0.5);
        questions = allTargets.slice(0, 5);
        
        currentQIndex = 0;
        startTime = Date.now();
        startLevel();
    }

    function createTicks() {
        const container = document.getElementById('ticks-container');
        for (let i = 1; i < 10; i++) {
            const tick = document.createElement('div');
            tick.className = i % 5 === 0 ? 'tick major' : 'tick';
            tick.style.bottom = (i * 10) + '%';
            
            if (i % 5 === 0 || i === 1) { 
                const label = document.createElement('div');
                label.className = 'tick-label';
                label.innerText = (i / 10).toFixed(1);
                label.style.bottom = (i * 10) + '%';
                container.appendChild(label);
            }
            container.appendChild(tick);
        }
    }

    function startLevel() {
        if (currentQIndex >= questions.length) {
            finishGame();
            return;
        }

        targetVolume = questions[currentQIndex];
        currentVolume = 0;
        
        updateWaterVisual();
        document.getElementById('msg-area').innerText = "";
        enableCups(true);

        document.getElementById('q-count').innerText = "„ÇÇ„Çì„Å†„ÅÑ " + (currentQIndex + 1) + " / 5";

        const targetL = (targetVolume / 100).toFixed(2).replace(/\.?0+$/, ""); // ‰∏çË¶Å„Å™0„ÇíÊ∂à„Åô
        document.getElementById('question-text').innerText = `${targetL} L „Å´„Åó„Å¶„Å≠`;

        // „Çø„Éº„Ç≤„ÉÉ„Éà„É©„Ç§„É≥ÁßªÂãï
        const line = document.getElementById('target-line');
        const tag = document.getElementById('target-tag');
        line.style.bottom = targetVolume + '%';
        tag.innerText = targetL;
    }

    function pourWater(amount) {
        if (currentVolume >= 100) return; 

        currentVolume += amount;
        updateWaterVisual();
        checkClear();
    }

    function resetWater() {
        currentVolume = 0;
        updateWaterVisual();
        document.getElementById('msg-area').innerText = "";
        enableCups(true);
    }

    function updateWaterVisual() {
        const visualHeight = Math.min(currentVolume, 100); 
        document.getElementById('water').style.height = visualHeight + '%';
        
        const decimalVal = (currentVolume / 100).toFixed(2);
        document.getElementById('current-display').innerText = decimalVal;

        const water = document.getElementById('water');
        if (currentVolume > 100) {
            water.style.background = "#ef5350"; 
        } else {
            water.style.background = "linear-gradient(to top, #0288d1, #4fc3f7)";
        }
    }

    function checkClear() {
        const msg = document.getElementById('msg-area');
        
        if (currentVolume === targetVolume) {
            msg.innerText = "„Éî„ÉÉ„Çø„É™ÔºÅ„Åõ„ÅÑ„Åã„ÅÑÔºÅüéâ";
            msg.style.color = "#00e676";
            enableCups(false);
            
            setTimeout(() => {
                currentQIndex++;
                startLevel();
            }, 1000);

        } else if (currentVolume > targetVolume) {
            if (currentVolume > 100) {
                 msg.innerText = "„ÅÇ„Åµ„Çå„Å°„ÇÉ„Å£„ÅüÔºÅüò±";
            } else {
                 msg.innerText = "Á∑ö„ÇíË∂Ö„Åà„Å°„ÇÉ„Å£„Åü‚Ä¶„ÇÑ„Çä„Å™„Åä„Åó„Å¶„Å≠";
            }
            msg.style.color = "#ff1744";
        }
    }

    function enableCups(enabled) {
        const btns = document.querySelectorAll('.cup-btn');
        btns.forEach(b => b.disabled = !enabled);
    }

    function finishGame() {
        const endTime = Date.now();
        const timeSec = ((endTime - startTime) / 1000).toFixed(1);

        document.getElementById('result-screen').style.display = 'flex';
        document.getElementById('final-time').innerText = timeSec;

        if (typeof showSaveDialog === 'function') {
            showSaveDialog('water', timeSec);
        }
    }

</script>

</body>
</html>