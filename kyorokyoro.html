<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã©ã“ã«ããˆãŸï¼Ÿå‹•ä½“è¦–åŠ›ã‚²ãƒ¼ãƒ </title>
    <style>
        body {
            font-family: "UD Digital Kyokasho-tai-R", "Hiragino Kaku Gothic ProN", sans-serif;
            background-color: #fff3e0; /* ã‚„ã•ã—ã„ã‚ªãƒ¬ãƒ³ã‚¸ */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            touch-action: manipulation;
        }

        #game-container {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            width: 95%;
            max-width: 500px;
            position: relative;
        }

        .screen { display: none; }
        .active { display: block; }

        h1 { color: #e65100; font-size: 24px; margin: 10px 0; }

        /* è¨­å®šã‚¨ãƒªã‚¢ */
        .setting-group {
            background: #ffe0b2;
            padding: 10px 15px;
            border-radius: 15px;
            margin-bottom: 10px;
            text-align: left;
            font-size: 18px;
        }
        .setting-group label { font-weight: bold; color: #e65100; }
        select {
            font-size: 18px; padding: 5px; border-radius: 8px;
            border: 2px solid #e65100; background: white;
        }

        /* --- 3x3ã®ç®±ã‚¨ãƒªã‚¢ --- */
        #box-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px auto;
            max-width: 400px;
            position: relative; /* çµµæ–‡å­—ã®é…ç½®åŸºæº– */
        }

        /* ç®±ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .box {
            aspect-ratio: 1 / 1;
            background: #ffffff;
            border: 4px solid #ffcc80;
            border-radius: 15px;
            position: relative;
            cursor: pointer;
            box-shadow: inset 0 0 10px rgba(255, 152, 0, 0.1);
        }
        /* å›ç­”æ™‚ã®ãƒ›ãƒãƒ¼ */
        .answering .box:hover { background: #fff8e1; }
        
        /* æ­£è§£ãƒ»ä¸æ­£è§£æ™‚ã®è‰² */
        .box.correct-box { background: #c8e6c9; border-color: #4caf50; }
        .box.wrong-box { background: #ffcdd2; border-color: #f44336; }

        /* --- ç§»å‹•ã™ã‚‹ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ --- */
        #mover {
            position: absolute;
            font-size: 60px;
            /* ç®±ã®ä¸­å¤®ã«é…ç½®ã™ã‚‹ãŸã‚ã®èª¿æ•´ */
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none; /* ã‚¯ãƒªãƒƒã‚¯ã®é‚ªé­”ã‚’ã—ãªã„ */
            display: none; /* æœ€åˆã¯éš ã™ */
            z-index: 10;
            filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.2));
        }

        /* ãƒœã‚¿ãƒ³é¡ */
        .start-btn, .retry-btn {
            font-size: 24px; padding: 15px 40px;
            background: #ff9800; color: white;
            border: none; border-radius: 50px;
            cursor: pointer; margin: 15px 0; font-weight: bold;
            box-shadow: 0 5px #e65100;
        }
        .start-btn:active, .retry-btn:active { transform: scale(0.95); box-shadow: none; }

        .back-btn {
            background: #90a4ae; font-size: 14px; padding: 8px 20px;
            color: white; border-radius: 20px; text-decoration: none;
            display: inline-block; margin-top: 10px;
        }

        /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        #game-message {
            font-size: 20px; font-weight: bold; color: #e65100; height: 30px;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="home-screen" class="screen active">
        <h1>ã©ã“ã« ããˆãŸï¼Ÿ</h1>
        <div style="font-size: 80px; margin: 10px;">ğŸ‘€</div>
        <p>ã¯ã“ã®ä¸Šã‚’ã†ã”ã ã©ã†ã¶ã¤ã‚’<br>ç›®ã§è¿½ã£ã¦ã­ï¼</p>

        <div class="setting-group">
            <label>ã‚¹ãƒ”ãƒ¼ãƒ‰ï¼š</label>
            <select id="speed-select">
                <option value="800">ã‚†ã£ãã‚Š</option>
                <option value="500" selected>ãµã¤ã†</option>
                <option value="300">ã¯ã‚„ã„</option>
                <option value="150">è¶…é«˜é€Ÿï¼</option>
                <option value="100">ç¥é€Ÿ (0.1ç§’)</option>
                <option value="50">å…‰é€Ÿ (0.05ç§’)</option>
            </select>
        </div>
        <div class="setting-group">
            <label>ã†ã”ãå›æ•°ï¼š</label>
            <select id="count-select">
                <option value="5">5å›</option>
                <option value="10" selected>10å›</option>
                <option value="20">20å›</option>
            </select>
        </div>

        <button class="start-btn" onclick="startGame()">ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>
        <br><a href="index.html" class="back-btn">ğŸ  ã‚‚ã©ã‚‹</a>
    </div>

    <div id="game-screen" class="screen">
        <div id="game-message">ã‚ˆãè¦‹ã¦ã¦ã­...</div>
        
        <div id="box-grid">
            <div id="mover">ğŸ¶</div>
            <div class="box" onclick="checkAnswer(0)"></div>
            <div class="box" onclick="checkAnswer(1)"></div>
            <div class="box" onclick="checkAnswer(2)"></div>
            <div class="box" onclick="checkAnswer(3)"></div>
            <div class="box" onclick="checkAnswer(4)"></div>
            <div class="box" onclick="checkAnswer(5)"></div>
            <div class="box" onclick="checkAnswer(6)"></div>
            <div class="box" onclick="checkAnswer(7)"></div>
            <div class="box" onclick="checkAnswer(8)"></div>
        </div>

        <a href="index.html" class="back-btn" id="giveup-btn">ğŸ  ã‚„ã‚ã‚‹</a>
        <div id="result-area" style="display:none;">
             <button class="retry-btn" onclick="startGame()">ã‚‚ã†ã„ã£ã‹ã„</button>
             <br><a href="index.html" class="back-btn">ğŸ  ã‚‚ã©ã‚‹</a>
        </div>
    </div>
</div>

<script>
    const boxes = document.querySelectorAll('.box');
    const mover = document.getElementById('mover');
    const message = document.getElementById('game-message');
    const grid = document.getElementById('box-grid');

    let currentPos = -1;
    let lastPos = -1; // æœ€å¾Œã«æ¶ˆãˆãŸå ´æ‰€ï¼ˆæ­£è§£ï¼‰
    let moveCount = 0;
    let maxMoves = 10;
    let speed = 500;
    let timer;
    let isAnswering = false; // å›ç­”å—ä»˜ä¸­ã‹ã©ã†ã‹

    // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ãƒªã‚¹ãƒˆ
    const chars = ['ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ¸', 'ğŸ·'];

    function changeScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function startGame() {
        // è¨­å®šèª­ã¿è¾¼ã¿ã¨ãƒªã‚»ãƒƒãƒˆ
        speed = parseInt(document.getElementById('speed-select').value);
        maxMoves = parseInt(document.getElementById('count-select').value);
        moveCount = 0;
        isAnswering = false;
        grid.classList.remove('answering');
        document.getElementById('giveup-btn').style.display = 'inline-block';
        document.getElementById('result-area').style.display = 'none';
        boxes.forEach(b => b.className = 'box'); // ç®±ã®è‰²ã‚’æˆ»ã™

        // ã‚­ãƒ£ãƒ©ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«æ±ºå®š
        mover.textContent = chars[Math.floor(Math.random() * chars.length)];
        
        message.textContent = "ã‚ˆãè¦‹ã¦ã¦ã­...";
        changeScreen('game-screen');

        // å°‘ã—å¾…ã£ã¦ã‹ã‚‰ç§»å‹•é–‹å§‹
        setTimeout(startMoving, 1000);
    }

    function startMoving() {
        mover.style.display = 'block';
        
        timer = setInterval(() => {
            moveOnce();
            moveCount++;

            if (moveCount >= maxMoves) {
                // çµ‚äº†ï¼
                clearInterval(timer);
                finishMoving();
            }
        }, speed);
    }

    function moveOnce() {
        let nextPos;
        // åŒã˜å ´æ‰€ã«é€£ç¶šã§å‡ºãªã„ã‚ˆã†ã«ã™ã‚‹ãƒ«ãƒ¼ãƒ—
        do {
            nextPos = Math.floor(Math.random() * boxes.length);
        } while (nextPos === currentPos);

        currentPos = nextPos;
        // ã‚­ãƒ£ãƒ©ã‚’ãã®ç®±ã®ä¸Šã«ç§»å‹•ã•ã›ã‚‹
        boxes[currentPos].appendChild(mover);
    }

    function finishMoving() {
        lastPos = currentPos; // æ­£è§£ã‚’è¨˜æ†¶
        
        // ãƒ‘ãƒƒã¨æ¶ˆã™
        setTimeout(() => {
            mover.style.display = 'none';
            message.textContent = "ã©ã“ã§ æ¶ˆãˆãŸï¼Ÿ ã‚¿ãƒƒãƒã—ã¦ï¼";
            grid.classList.add('answering'); // ã‚«ãƒ¼ã‚½ãƒ«ã‚’å¤‰ãˆã‚‹ç”¨
            isAnswering = true; // å›ç­”å—ä»˜é–‹å§‹
        }, speed); // æœ€å¾Œã®ä½ç½®ã§å°‘ã—æ­¢ã¾ã£ã¦ã‹ã‚‰æ¶ˆãˆã‚‹
    }

    // ç®±ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ™‚ã®åˆ¤å®š
    function checkAnswer(index) {
        if (!isAnswering) return; // å—ä»˜ä¸­ä»¥å¤–ã¯ç„¡è¦–

        isAnswering = false;
        grid.classList.remove('answering');
        document.getElementById('giveup-btn').style.display = 'none';

        if (index === lastPos) {
            // æ­£è§£ï¼
            message.textContent = "ã ã„ã›ã„ã‹ã„ï¼âœ¨";
            boxes[index].classList.add('correct-box');
            // æ­£è§£ã®ç®±ã«ã‚­ãƒ£ãƒ©ã‚’å†è¡¨ç¤º
            boxes[index].appendChild(mover);
            mover.style.display = 'block';
        } else {
            // ä¸æ­£è§£...
            message.textContent = "ã–ã‚“ã­ã‚“... ã“ã“ã§ã—ãŸï¼";
            boxes[index].classList.add('wrong-box'); // é¸ã‚“ã ç®±ã‚’èµ¤ã
            boxes[lastPos].classList.add('correct-box'); // æ­£è§£ã‚’ç·‘ã«
            // æ­£è§£ã®ç®±ã«ã‚­ãƒ£ãƒ©ã‚’å†è¡¨ç¤º
            boxes[lastPos].appendChild(mover);
            mover.style.display = 'block';
        }

        // çµæœãƒœã‚¿ãƒ³è¡¨ç¤º
        document.getElementById('result-area').style.display = 'block';
    }
</script>

</body>
</html>