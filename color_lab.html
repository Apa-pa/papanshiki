<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ã„ã‚ã¾ãœå®Ÿé¨“å®¤</title>
    <script src="ranking.js"></script>
    <style>
        body {
            font-family: "UD Digital Kyokasho-tai-R", sans-serif;
            background-color: #f3e5f5; /* è–„ã„ç´« */
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #4a148c;
            touch-action: manipulation;
        }

        #game-container {
            width: 100%;
            max-width: 600px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        h1 { margin: 10px 0; font-size: 24px; color: #8e24aa; }

        /* å•é¡Œã‚¨ãƒªã‚¢ */
        .question-area {
            background: #fff3e0;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 3px dashed #ffb74d;
        }

        .target-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 10px;
            border: 4px solid white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: background-color 0.5s;
        }

        /* ãƒ•ãƒ©ã‚¹ã‚³ï¼ˆæ··ãœã‚‹å ´æ‰€ï¼‰ */
        .flask-area {
            position: relative;
            height: 200px;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            margin: 20px 0;
        }

        .flask {
            width: 120px;
            height: 140px;
            background: #e1f5fe; /* ç©ºã®ãƒ•ãƒ©ã‚¹ã‚³ã®è‰² */
            border: 4px solid #444;
            border-top: none;
            border-radius: 0 0 50px 50px;
            position: relative;
            overflow: hidden;
        }
        /* ãƒ•ãƒ©ã‚¹ã‚³ã®é¦– */
        .flask::before {
            content: '';
            position: absolute;
            top: -40px; left: 35px;
            width: 42px; height: 50px;
            background: inherit;
            border: 4px solid #444;
            border-bottom: none;
            z-index: 1;
        }

        .liquid {
            position: absolute;
            bottom: 0; left: 0;
            width: 100%; height: 0%; /* é‡ */
            background-color: transparent;
            transition: all 0.5s ease;
        }

        /* çµµã®å…·ãƒãƒ¥ãƒ¼ãƒ– */
        .tubes-grid {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .tube-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            border: none;
            background: none;
            cursor: pointer;
            transition: transform 0.1s;
        }
        .tube-btn:active { transform: scale(0.9); }

        .tube-body {
            width: 40px; height: 60px;
            border-radius: 5px 5px 15px 15px;
            border: 2px solid rgba(0,0,0,0.1);
            position: relative;
            margin-bottom: 5px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
        }
        /* ã‚­ãƒ£ãƒƒãƒ— */
        .tube-body::before {
            content: '';
            position: absolute;
            top: -12px; left: 5px;
            width: 30px; height: 10px;
            background: #333;
            border-radius: 2px;
        }
        
        .tube-label { font-size: 14px; font-weight: bold; color: #555; }

        /* è‰²å®šç¾© */
        .col-red { background-color: #ff1744; }
        .col-blue { background-color: #2979ff; }
        .col-yellow { background-color: #ffea00; }
        .col-white { background-color: #ffffff; border: 1px solid #ddd; }
        .col-black { background-color: #37474f; }

        /* æ“ä½œãƒœã‚¿ãƒ³ */
        .action-btns {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .btn {
            padding: 12px 30px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 4px rgba(0,0,0,0.2);
        }
        .btn-reset { background: #90a4ae; }
        .btn-check { background: #8e24aa; }
        .btn:active { transform: translateY(2px); box-shadow: none; }

        /* ã‚¹ã‚¿ãƒ¼ãƒˆãƒ»çµæœç”»é¢ */
        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            text-align: center;
        }
        .start-btn {
            font-size: 24px; padding: 15px 50px;
            background: #ff6f00; color: white;
            border: none; border-radius: 50px;
            font-weight: bold; cursor: pointer;
            box-shadow: 0 5px #e65100;
        }
        
        /* ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .pop-anim { animation: pop 0.3s; }

    </style>
</head>
<body>

<div id="game-container">
    <h1>ğŸ¨ ã„ã‚ã¾ãœå®Ÿé¨“å®¤</h1>

    <div style="text-align: right; font-size: 14px; color:#888; margin-right: 10px;">
        ã®ã“ã‚Š <span id="q-count">0</span> å•
    </div>

    <div class="question-area">
        <div style="margin-bottom:5px;">ã“ã®è‰²ã‚’ã¤ãã‚ã†ï¼</div>
        <div id="target-circle" class="target-circle" style="background-color: orange;"></div>
        <div id="target-name" style="font-weight:bold; font-size:20px;">ã‚ªãƒ¬ãƒ³ã‚¸</div>
    </div>

    <div class="flask-area">
        <div class="flask">
            <div id="liquid" class="liquid"></div>
        </div>
    </div>

    <div>çµµã®å…·ã‚’é¸ã‚“ã§ã­ï¼ˆ2ã¤ã¾ã§ï¼‰</div>
    <div class="tubes-grid">
        <button class="tube-btn" onclick="addColor('red')">
            <div class="tube-body col-red"></div>
            <div class="tube-label">ã‚ã‹</div>
        </button>
        <button class="tube-btn" onclick="addColor('blue')">
            <div class="tube-body col-blue"></div>
            <div class="tube-label">ã‚ãŠ</div>
        </button>
        <button class="tube-btn" onclick="addColor('yellow')">
            <div class="tube-body col-yellow"></div>
            <div class="tube-label">ãã„ã‚</div>
        </button>
        <button class="tube-btn" onclick="addColor('white')">
            <div class="tube-body col-white"></div>
            <div class="tube-label">ã—ã‚</div>
        </button>
        <button class="tube-btn" onclick="addColor('black')">
            <div class="tube-body col-black"></div>
            <div class="tube-label">ãã‚</div>
        </button>
    </div>

    <div class="action-btns">
        <button class="btn btn-reset" onclick="resetFlask()">ã‚„ã‚ŠãªãŠã™</button>
        <button class="btn btn-check" onclick="checkAnswer()">ã§ããŸï¼</button>
    </div>

    <div id="start-screen" class="overlay">
        <div style="font-size: 80px; margin-bottom: 20px;">ğŸ¨</div>
        <h1 style="color:#8e24aa; margin:0;">ã„ã‚ã¾ãœå®Ÿé¨“å®¤</h1>
        <p style="margin: 20px; color:#555;">
            2ã¤ã® çµµã®å…·ã‚’ ã¾ãœã¦<br>ãŠé¡Œã®è‰²ã‚’ ä½œã£ã¦ã­ï¼
        </p>
        <button class="start-btn" onclick="startGame()">ã˜ã£ã‘ã‚“é–‹å§‹</button>
        <br>
        <a href="index.html" style="color:#8e24aa; margin-top:20px; text-decoration: underline;">ğŸ  ã‚‚ã©ã‚‹</a>
    </div>

    <div id="result-screen" class="overlay" style="display:none; background: rgba(0,0,0,0.8); color:white;">
        <div id="result-icon" style="font-size: 80px;">â­•</div>
        <h2 id="result-msg">ã ã„ã›ã„ã‹ã„ï¼</h2>
        <button class="start-btn" onclick="nextQuestion()">ã¤ãã®å•é¡Œã¸</button>
    </div>

    <div id="all-clear-screen" class="overlay" style="display:none; background: rgba(255,255,255,0.95); color:#4a148c;">
        <h1 style="color:#e65100;">ãœã‚“ã¶ã§ããŸï¼</h1>
        <div style="font-size: 80px; margin: 20px;">ğŸ‘¨â€ğŸ¨ğŸ‘©â€ğŸ¨</div>
        <p style="font-size: 20px;">ã™ã”ã„ï¼<br>ãã¿ã¯ è‰²ã®ãƒã‚«ã‚»ã ï¼</p>
        <button onclick="showPointGetDialog(30)" style="font-size:20px; padding:10px 30px; background:#ff9800; color:white; border:none; border-radius:30px; margin:10px; font-weight:bold; cursor:pointer;">
    ğŸ 30ãƒã‚¤ãƒ³ãƒˆã‚’ã‚‚ã‚‰ã†
</button>
        <button class="start-btn" onclick="location.reload()">ã‚‚ã†ã„ã£ã‹ã„</button>
        <br>
        <a href="index.html" style="color:#8e24aa; margin-top:20px; text-decoration: underline;">ğŸ  ãƒ›ãƒ¼ãƒ ã¸</a>
    </div>

</div>

<script>
    // è‰²ã®å®šç¾©ï¼ˆçµµã®å…·ãƒ«ãƒ¼ãƒ«ï¼‰
    const colorRules = {
        // åŸºæœ¬è‰²
        "red": { name: "ã‚ã‹", code: "#ff1744" },
        "blue": { name: "ã‚ãŠ", code: "#2979ff" },
        "yellow": { name: "ãã„ã‚", code: "#ffea00" },
        "white": { name: "ã—ã‚", code: "#ffffff" },
        "black": { name: "ãã‚", code: "#37474f" },
        
        // æ··ãœãŸè‰²ï¼ˆã‚­ãƒ¼ã¯ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼‰
        // red, yellow -> red_yellow
        // blue, yellow -> blue_yellow
        // blue, red -> blue_red
        // red, white -> red_white
        // blue, white -> blue_white
        // black, white -> black_white
        
        // â˜…ä¿®æ­£ãƒã‚¤ãƒ³ãƒˆ: white(w) ã¨ yellow(y) ãªã®ã§ã€ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã ã¨ white_yellow ãŒæ­£ã—ã„
        "red_yellow": { name: "ã‚ªãƒ¬ãƒ³ã‚¸", code: "#ff9100" },
        "blue_yellow": { name: "ã¿ã©ã‚Š", code: "#00c853" },
        "blue_red": { name: "ã‚€ã‚‰ã•ã", code: "#aa00ff" },
        "red_white": { name: "ãƒ”ãƒ³ã‚¯", code: "#f48fb1" },
        "blue_white": { name: "ã¿ãšã„ã‚", code: "#80d8ff" },
        "black_white": { name: "ã¯ã„ã„ã‚", code: "#9e9e9e" },
        "white_yellow": { name: "ã‚¯ãƒªãƒ¼ãƒ ã„ã‚", code: "#fff59d" } // ã“ã“ã‚’ä¿®æ­£ï¼
    };

    // å‡ºé¡Œã™ã‚‹è‰²ã®ãƒªã‚¹ãƒˆ
    const questionKeys = [
        "red_yellow", 
        "blue_yellow", 
        "blue_red",   
        "red_white",  
        "blue_white", 
        "black_white", 
        "white_yellow" // ã‚­ãƒ¼ä¿®æ­£
    ];

    let currentTargetKey = "";
    let addedColors = [];
    let qIndex = 0;
    let shuffledQuestions = [];

    function startGame() {
        document.getElementById('start-screen').style.display = 'none';
        shuffledQuestions = [...questionKeys].sort(() => Math.random() - 0.5);
        qIndex = 0;
        loadQuestion();
    }

    function loadQuestion() {
        // æ®‹ã‚Šå•é¡Œæ•°ã‚’è¡¨ç¤º
        document.getElementById('q-count').innerText = (shuffledQuestions.length - qIndex);

        if (qIndex >= shuffledQuestions.length) {
            // å…¨å•ã‚¯ãƒªã‚¢ï¼
            document.getElementById('all-clear-screen').style.display = 'flex';
            return;
        }
        
        currentTargetKey = shuffledQuestions[qIndex];
        const targetData = colorRules[currentTargetKey];
        
        // ãŠé¡Œã®è¡¨ç¤º
        document.getElementById('target-circle').style.backgroundColor = targetData.code;
        document.getElementById('target-name').innerText = targetData.name;
        
        resetFlask();
    }

    function addColor(color) {
        if (addedColors.length >= 2) return; // 2è‰²ã¾ã§

        addedColors.push(color);
        updateFlask();
    }

    function resetFlask() {
        addedColors = [];
        updateFlask();
    }

    function updateFlask() {
        const liquid = document.getElementById('liquid');
        
        if (addedColors.length === 0) {
            liquid.style.height = "0%";
            liquid.style.backgroundColor = "transparent";
            return;
        }

        // é«˜ã•ï¼ˆé‡ï¼‰ã®æ›´æ–°
        liquid.style.height = (addedColors.length * 40) + "%"; // 40%, 80%

        // è‰²ã®æ›´æ–°
        let resultColorCode = "";
        
        if (addedColors.length === 1) {
            // 1è‰²ã ã‘
            resultColorCode = colorRules[addedColors[0]].code;
        } else {
            // 2è‰²ã¾ã–ã£ãŸ
            const key = makeKey(addedColors[0], addedColors[1]);
            if (colorRules[key]) {
                resultColorCode = colorRules[key].code;
            } else {
                // å®šç¾©ã•ã‚Œã¦ã„ãªã„çµ„ã¿åˆã‚ã›ï¼ˆèŒ¶è‰²ã£ã½ãã™ã‚‹ï¼‰
                resultColorCode = "#795548"; 
            }
        }
        liquid.style.backgroundColor = resultColorCode;
    }

    function checkAnswer() {
        if (addedColors.length !== 2) {
            return;
        }

        const currentMixKey = makeKey(addedColors[0], addedColors[1]);
        const resultScreen = document.getElementById('result-screen');
        const msg = document.getElementById('result-msg');
        const icon = document.getElementById('result-icon');

        resultScreen.style.display = 'flex';

        if (currentMixKey === currentTargetKey) {
            // æ­£è§£
            icon.innerText = "â­•";
            msg.innerText = "ã ã„ã›ã„ã‹ã„ï¼";
            msg.style.color = "#b2ff59";
        } else {
            // ä¸æ­£è§£
            icon.innerText = "âŒ";
            msg.innerText = "ã–ã‚“ã­ã‚“...";
            msg.style.color = "#ff5252";
        }
    }

    function nextQuestion() {
        document.getElementById('result-screen').style.display = 'none';
        
        // æ¬¡ã¸é€²ã‚€
        qIndex++;
        loadQuestion();
    }

    // ã‚­ãƒ¼ã‚’ç”Ÿæˆã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼ˆã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã«ä¸¦ã¹ã‚‹ï¼‰
    function makeKey(c1, c2) {
        const sorted = [c1, c2].sort();
        return sorted[0] + "_" + sorted[1];
    }

</script>
</body>
</html>