<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>„ÅÇ„ÇÅ„Åµ„ÇäÊØçÈü≥</title>
    <style>
        body {
            font-family: "UD Digital Kyokasho-tai-R", sans-serif;
            background-color: #263238;
            margin: 0;
            padding: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            height: 100vh;
            height: 100dvh;
            color: white;
            touch-action: manipulation;
        }

        #app-container {
            width: 100%;
            max-width: 500px;
            height: 100%;
            display: flex;
            flex-direction: column;
            background-color: #37474f;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            position: relative;
        }

        /* „Ç≤„Éº„É†ÁîªÈù¢ */
        #game-area {
            flex: 1;
            position: relative;
            background: linear-gradient(to bottom, #004d40, #00695c); /* ÊØçÈü≥Áâà„ÅØÊ∑±Á∑ë„ÅÆÁ©∫ */
            overflow: hidden;
            border-bottom: 2px solid #4db6ac;
        }

        /* „Çπ„Ç≥„Ç¢„Éª„É©„Ç§„ÉïË°®Á§∫ */
        .hud {
            position: absolute;
            top: 10px; left: 15px;
            font-size: 20px; font-weight: bold;
            text-shadow: 2px 2px 0 #000; z-index: 10;
        }
        .life-area {
            position: absolute;
            top: 10px; right: 15px;
            font-size: 24px; z-index: 10;
        }

        /* ËêΩ„Å°„Å¶„Åè„ÇãÈõ´ */
        .drop {
            position: absolute;
            width: 60px; height: 70px;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; font-size: 24px;
            color: #004d40;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 120'%3E%3Cpath d='M50 0 C50 0 5 40 5 75 C5 100 25 120 50 120 C75 120 95 100 95 75 C95 40 50 0 50 0 Z' fill='%23e0f2f1' stroke='%2380cbc4' stroke-width='2'/%3E%3C/svg%3E");
            background-size: contain; background-repeat: no-repeat;
            text-shadow: 0 0 2px white;
            padding-top: 15px; box-sizing: border-box;
            will-change: top;
        }
        .drop.hit {
            transform: scale(1.5); opacity: 0; transition: all 0.2s;
        }

        /* Êìç‰Ωú„Éë„Éç„É´ */
        #controls {
            flex-shrink: 0;
            background: #fff;
            padding: 20px;
            box-sizing: border-box;
            display: flex; justify-content: center;
            z-index: 20;
        }

        /* „Ç≠„Éº„Éë„ÉÉ„ÉâÔºàÊØçÈü≥Áî®„É¨„Ç§„Ç¢„Ç¶„ÉàÔºâ */
        #keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3Âàó */
            gap: 15px;
            width: 100%;
            max-width: 400px;
            height: auto;
        }

        .key-btn {
            background: white;
            border: 2px solid #b0bec5;
            border-radius: 12px;
            font-size: 36px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #455a64;
            cursor: pointer;
            box-shadow: 0 4px #90a4ae;
            padding: 15px 0;
            touch-action: manipulation;
            transition: 0.1s;
            -webkit-tap-highlight-color: transparent;
        }
        .key-btn:active {
            background: #e0f2f1;
            transform: translateY(3px);
            box-shadow: 0 1px #90a4ae;
            border-color: #009688;
            color: #009688;
        }

        /* „Çπ„Çø„Éº„Éà„ÉªÁµêÊûúÁîªÈù¢ */
        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 77, 64, 0.9);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            z-index: 100; text-align: center;
        }
        .title-logo { font-size: 40px; margin-bottom: 20px; text-shadow: 0 4px 10px rgba(0,0,0,0.5); color: white; }
        .start-btn {
            font-size: 24px; padding: 15px 50px;
            background: #ffca28; color: #3e2723;
            border: none; border-radius: 50px;
            font-weight: bold; cursor: pointer;
            box-shadow: 0 5px #ff6f00; margin-top: 20px;
        }
        .start-btn:active { transform: scale(0.95); box-shadow: none; }

        .damage-effect {
            animation: shake 0.3s;
            box-shadow: inset 0 0 50px rgba(255, 82, 82, 0.8) !important;
        }
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
    </style>
</head>
<body>

<div id="app-container">
    <div id="game-area">
        <div class="hud">„Çπ„Ç≥„Ç¢: <span id="score">0</span></div>
        <div class="life-area" id="life-icons">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
        <div id="drops-container"></div>
    </div>

    <div id="controls">
        <div id="keypad">
            <button class="key-btn" onclick="checkInput('a')">a</button>
            <button class="key-btn" onclick="checkInput('i')">i</button>
            <button class="key-btn" onclick="checkInput('u')">u</button>
            
            <button class="key-btn" onclick="checkInput('e')">e</button>
            <button class="key-btn" onclick="checkInput('o')">o</button>
            <div style="pointer-events: none;"></div>
        </div>
    </div>

    <div id="start-screen" class="overlay">
        <div style="font-size:60px;">üó£Ô∏è</div>
        <div class="title-logo">„ÅÇ„ÇÅ„Åµ„Çä<br>ÊØçÈü≥(„Åº„ÅÑ„Çì)</div>
        <p style="color:#b2dfdb;">„Å≤„Çâ„Åå„Å™„ÅÆ ÊØçÈü≥(„Åº„ÅÑ„Çì)„Çí „Åä„Åó„Å¶„Å≠ÔºÅ</p>
        <p style="color:#80cbc4; font-size: 14px;">Ôºà„Çå„ÅÑÔºö „Åã ‚Üí a „ÄÅ „Åç ‚Üí i Ôºâ</p>
        <button class="start-btn" onclick="gameStart()">„Çπ„Çø„Éº„Éà</button>
        <br>
        <a href="index.html" style="color:#80cbc4; margin-top:20px; text-decoration: underline;">üè† „ÇÇ„Å©„Çã</a>
    </div>

    <div id="gameover-screen" class="overlay" style="display:none;">
        <h1 style="color:#ff5252;">„Åä„Åó„Åæ„ÅÑÔºÅ</h1>
        <div style="font-size: 80px; margin: 10px;">üò≠</div>
        <p style="font-size:24px; color: white;">„Çπ„Ç≥„Ç¢: <span id="final-score">0</span></p>
        <button class="start-btn" onclick="location.reload()">„ÇÇ„ÅÜ„ÅÑ„Å£„Åã„ÅÑ</button>
        <br>
        <a href="index.html" style="color:#80cbc4; margin-top:20px; text-decoration: underline;">üè† „Éõ„Éº„É†„Å∏</a>
    </div>
</div>

<script>
    const gameArea = document.getElementById('game-area');
    const dropsContainer = document.getElementById('drops-container');
    
    // „Éá„Éº„Çø: ÊØçÈü≥„Åî„Å®„ÅÆ„Å≤„Çâ„Åå„Å™„É™„Çπ„Éà
    const vowelMap = {
        'a': ['„ÅÇ','„Åã','„Åï','„Åü','„Å™','„ÅØ','„Åæ','„ÇÑ','„Çâ','„Çè'],
        'i': ['„ÅÑ','„Åç','„Åó','„Å°','„Å´','„Å≤','„Åø','„Çä'],
        'u': ['„ÅÜ','„Åè','„Åô','„Å§','„Å¨','„Åµ','„ÇÄ','„ÇÜ','„Çã'],
        'e': ['„Åà','„Åë','„Åõ','„Å¶','„Å≠','„Å∏','„ÇÅ','„Çå'],
        'o': ['„Åä','„Åì','„Åù','„Å®','„ÅÆ','„Åª','„ÇÇ','„Çà','„Çç','„Çí']
    };
    const keys = Object.keys(vowelMap);

    let score = 0;
    let life = 5;
    let isPlaying = false;
    let drops = []; 
    let frameCount = 0;
    let spawnRate = 120;
    let baseFallSpeed = 0.003; 
    let currentFallSpeedPx = 0;
    let gameHeight = 0;
    let animationId;

    function resizeGame() {
        gameHeight = gameArea.clientHeight;
        currentFallSpeedPx = gameHeight * baseFallSpeed;
    }
    
    window.addEventListener('resize', resizeGame);
    resizeGame();

    function gameStart() {
        resizeGame();
        document.getElementById('start-screen').style.display = 'none';
        score = 0;
        life = 5;
        updateUI();
        isPlaying = true;
        gameLoop();
    }

    function gameLoop() {
        if (!isPlaying) return;
        frameCount++;

        if (frameCount % 600 === 0) { 
            spawnRate = Math.max(30, spawnRate - 5);
            baseFallSpeed += 0.0002;
            currentFallSpeedPx = gameHeight * baseFallSpeed;
        }

        if (frameCount % spawnRate === 0) {
            spawnDrop();
        }

        moveDrops();
        animationId = requestAnimationFrame(gameLoop);
    }

    function spawnDrop() {
        const dropEl = document.createElement('div');
        dropEl.className = 'drop';
        
        // „É©„É≥„ÉÄ„É†„Å™ÊØçÈü≥„Ç≠„Éº„ÇíÈÅ∏„Å∂
        const targetKey = keys[Math.floor(Math.random() * keys.length)];
        // „Åù„ÅÆË°å„Åã„Çâ„É©„É≥„ÉÄ„É†„Å™„Å≤„Çâ„Åå„Å™„ÇíÈÅ∏„Å∂
        const chars = vowelMap[targetKey];
        const targetChar = chars[Math.floor(Math.random() * chars.length)];

        dropEl.textContent = targetChar;
        
        const maxLeft = gameArea.clientWidth - 70;
        const x = Math.random() * maxLeft;
        
        dropEl.style.left = x + 'px';
        dropEl.style.top = '-80px'; 

        dropsContainer.appendChild(dropEl);

        drops.push({
            el: dropEl,
            y: -80,
            key: targetKey // Ê≠£Ëß£„Ç≠„Éº„Çí‰øùÂ≠ò
        });
    }

    function moveDrops() {
        for (let i = drops.length - 1; i >= 0; i--) {
            const drop = drops[i];
            drop.y += currentFallSpeedPx;
            drop.el.style.top = drop.y + 'px';

            if (drop.y > gameHeight - 60) {
                takeDamage();
                drop.el.remove();
                drops.splice(i, 1);
            }
        }
    }

    function checkInput(inputKey) {
        if (!isPlaying) return;
        
        let targetIndex = -1;
        let maxY = -9999;

        for (let i = 0; i < drops.length; i++) {
            if (drops[i].key === inputKey) {
                if (drops[i].y > maxY) {
                    maxY = drops[i].y;
                    targetIndex = i;
                }
            }
        }

        if (targetIndex !== -1) {
            const target = drops[targetIndex];
            target.el.classList.add('hit');
            target.el.textContent = "‚ú®";
            
            setTimeout(() => {
                if(target.el.parentNode) target.el.remove();
            }, 200);
            
            drops.splice(targetIndex, 1);
            score += 10;
        } else {
            const bg = document.getElementById('app-container');
            bg.style.boxShadow = "inset 0 0 50px rgba(255, 255, 0, 0.3)";
            setTimeout(() => bg.style.boxShadow = "none", 100);
        }

        updateUI();
    }

    function takeDamage() {
        life--;
        updateUI();
        const app = document.getElementById('app-container');
        app.classList.add('damage-effect');
        setTimeout(() => app.classList.remove('damage-effect'), 300);

        if (life <= 0) {
            gameOver();
        }
    }

    function updateUI() {
        document.getElementById('score').textContent = score;
        let hearts = "";
        for(let i=0; i<life; i++) hearts += "‚ù§Ô∏è";
        document.getElementById('life-icons').textContent = hearts;
    }

    function gameOver() {
        isPlaying = false;
        cancelAnimationFrame(animationId);
        document.getElementById('final-score').textContent = score;
        document.getElementById('gameover-screen').style.display = 'flex';
    }

</script>
</body>
</html>