<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ã‚ã‚ãµã‚Šç®—æ•°</title>
    <style>
        body {
            font-family: "UD Digital Kyokasho-tai-R", sans-serif;
            background-color: #263238;
            margin: 0;
            padding: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100vh;
            color: white;
            touch-action: manipulation;
        }

        /* ã‚²ãƒ¼ãƒ ç”»é¢ */
        #game-area {
            flex: 1;
            position: relative;
            background: linear-gradient(to bottom, #37474f, #455a64);
            overflow: hidden;
        }

        /* ã‚¹ã‚³ã‚¢ãƒ»ãƒ©ã‚¤ãƒ•è¡¨ç¤º */
        .hud {
            position: absolute;
            top: 10px;
            left: 15px;
            font-size: 20px;
            font-weight: bold;
            text-shadow: 2px 2px 0 #000;
            z-index: 10;
        }
        .life-area {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            z-index: 10;
        }

        /* è½ã¡ã¦ãã‚‹é›« */
        .drop {
            position: absolute;
            width: 60px;
            height: 70px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 18px;
            color: #0d47a1;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 120'%3E%3Cpath d='M50 0 C50 0 5 40 5 75 C5 100 25 120 50 120 C75 120 95 100 95 75 C95 40 50 0 50 0 Z' fill='%23e3f2fd' stroke='%2390caf9' stroke-width='2'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
            text-shadow: 0 0 2px white;
            padding-top: 15px;
            box-sizing: border-box;
            transition: transform 0.1s;
        }
        .drop.hit {
            transform: scale(1.5);
            opacity: 0;
            transition: all 0.2s;
        }

        /* æ“ä½œãƒ‘ãƒãƒ«ï¼ˆã‚¹ãƒƒã‚­ãƒªã•ã›ã¾ã—ãŸï¼‰ */
        #controls {
            height: 240px;
            background: #fff;
            border-top: 5px solid #90caf9;
            padding: 10px;
            box-sizing: border-box;
            display: flex;
            justify-content: center;
        }

        /* ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰ï¼ˆæ•°å­—ã®ã¿ï¼‰ */
        #keypad {
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* 5åˆ—2è¡Œã§é…ç½® */
            gap: 8px;
            width: 100%;
            max-width: 600px;
            height: 100%;
        }

        .key-btn {
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 32px; /* æ•°å­—å¤§ãã */
            font-weight: bold;
            color: #455a64;
            cursor: pointer;
            box-shadow: 0 4px #b0bec5;
            touch-action: manipulation;
            transition: 0.1s;
        }
        .key-btn:active {
            background: #e3f2fd;
            transform: translateY(2px);
            box-shadow: 0 1px #b0bec5;
            border-color: #2196f3;
            color: #2196f3;
        }

        /* ã‚¹ã‚¿ãƒ¼ãƒˆãƒ»çµæœç”»é¢ */
        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            text-align: center;
        }
        .title-logo { font-size: 40px; margin-bottom: 20px; }
        .start-btn {
            font-size: 24px; padding: 15px 50px;
            background: #ff9800; color: white;
            border: none; border-radius: 50px;
            font-weight: bold; cursor: pointer;
            box-shadow: 0 5px #e65100;
        }
        .start-btn:active { transform: scale(0.95); }

        /* ãƒ€ãƒ¡ãƒ¼ã‚¸æ¼”å‡º */
        .damage-effect {
            animation: shake 0.3s;
            box-shadow: inset 0 0 50px red;
        }
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

    </style>
</head>
<body>

    <div id="game-area">
        <div class="hud">ã¨ãã¦ã‚“: <span id="score">0</span></div>
        <div class="life-area" id="life-icons">â¤ï¸â¤ï¸â¤ï¸â¤ï¸â¤ï¸</div>
        <div id="drops-container"></div>
    </div>

    <div id="controls">
        <div id="keypad">
            <button class="key-btn" onclick="checkInput(1)">1</button>
            <button class="key-btn" onclick="checkInput(2)">2</button>
            <button class="key-btn" onclick="checkInput(3)">3</button>
            <button class="key-btn" onclick="checkInput(4)">4</button>
            <button class="key-btn" onclick="checkInput(5)">5</button>
            <button class="key-btn" onclick="checkInput(6)">6</button>
            <button class="key-btn" onclick="checkInput(7)">7</button>
            <button class="key-btn" onclick="checkInput(8)">8</button>
            <button class="key-btn" onclick="checkInput(9)">9</button>
            <button class="key-btn" onclick="checkInput(0)">0</button>
        </div>
    </div>

    <div id="start-screen" class="overlay">
        <div style="font-size:60px;">â˜”</div>
        <div class="title-logo">ã‚ã‚ãµã‚Š<br>ã•ã‚“ã™ã†</div>
        <p style="color:#ddd;">ã“ãŸãˆã¯ ãœã‚“ã¶ 1ã‘ãŸï¼<br>ã™ã†ã˜ã‚’ ãŠã—ã¦ ã¯ã£ã—ã‚ƒã ï¼</p>
        <button class="start-btn" onclick="gameStart()">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        <br>
        <a href="index.html" style="color:white; margin-top:20px;">ğŸ  ã‚‚ã©ã‚‹</a>
    </div>

    <div id="gameover-screen" class="overlay" style="display:none;">
        <h1 style="color:#ff5252;">ãŠã—ã¾ã„ï¼</h1>
        <p style="font-size:24px;">ã¨ãã¦ã‚“: <span id="final-score">0</span> ã¦ã‚“</p>
        <button class="start-btn" onclick="location.reload()">ã‚‚ã†ã„ã£ã‹ã„</button>
        <br>
        <a href="index.html" style="color:white; margin-top:20px;">ğŸ  ãƒ›ãƒ¼ãƒ ã¸</a>
    </div>

<script>
    const gameArea = document.getElementById('game-area');
    const dropsContainer = document.getElementById('drops-container');
    
    let score = 0;
    let life = 5;
    let isPlaying = false;
    let drops = []; 
    let frameCount = 0;
    let spawnRate = 120;
    let fallSpeed = 1.5;

    let animationId;

    function gameStart() {
        document.getElementById('start-screen').style.display = 'none';
        score = 0;
        life = 5;
        updateUI();
        isPlaying = true;
        gameLoop();
    }

    function gameLoop() {
        if (!isPlaying) return;

        frameCount++;

        if (frameCount % 600 === 0) { 
            spawnRate = Math.max(30, spawnRate - 5);
            fallSpeed += 0.1;
        }

        if (frameCount % spawnRate === 0) {
            spawnDrop();
        }

        moveDrops();

        animationId = requestAnimationFrame(gameLoop);
    }

    function spawnDrop() {
        const dropEl = document.createElement('div');
        dropEl.className = 'drop';
        
        let num1, num2, answer, symbol;
        
        // ã€ä¿®æ­£ã€‘ç­”ãˆãŒå¿…ãš0ã€œ9ï¼ˆ1æ¡ï¼‰ã«ãªã‚‹å•é¡Œã‚’ç”Ÿæˆ
        if (Math.random() > 0.5) {
            // è¶³ã—ç®—: ç­”ãˆãŒ9ä»¥ä¸‹ã«ãªã‚‹ã‚ˆã†ã«
            num1 = Math.floor(Math.random() * 10); // 0-9
            num2 = Math.floor(Math.random() * (10 - num1)); // ç­”ãˆãŒ9ã‚’è¶…ãˆãªã„ç¯„å›²
            answer = num1 + num2;
            symbol = "+";
        } else {
            // å¼•ãç®—: ç­”ãˆãŒ0ä»¥ä¸Š9ä»¥ä¸‹ã«ãªã‚‹ã‚ˆã†ã«
            // ã¾ãšç­”ãˆ(0-9)ã‚’æ±ºã‚ã‚‹
            answer = Math.floor(Math.random() * 10);
            // å¼•ãæ•°(0-9)ã‚’æ±ºã‚ã‚‹
            num2 = Math.floor(Math.random() * 10);
            // å¼•ã‹ã‚Œã‚‹æ•°ã‚’é€†ç®—
            num1 = answer + num2;
            symbol = "-";
        }

        dropEl.textContent = `${num1}${symbol}${num2}`;
        
        const x = Math.random() * (gameArea.clientWidth - 70);
        dropEl.style.left = x + 'px';
        dropEl.style.top = '-80px'; 

        dropsContainer.appendChild(dropEl);

        drops.push({
            el: dropEl,
            y: -80,
            ans: answer
        });
    }

    function moveDrops() {
        for (let i = drops.length - 1; i >= 0; i--) {
            const drop = drops[i];
            drop.y += fallSpeed;
            drop.el.style.top = drop.y + 'px';

            if (drop.y > gameArea.clientHeight - 50) {
                takeDamage();
                drop.el.remove();
                drops.splice(i, 1);
            }
        }
    }

    // ã€ä¿®æ­£ã€‘ãƒ¯ãƒ³ã‚¿ãƒƒãƒ—ã§åˆ¤å®š
    function checkInput(num) {
        if (!isPlaying) return;
        
        // ç”»é¢ã«ã‚ã‚‹é›«ã®ä¸­ã‹ã‚‰ã€ç­”ãˆãŒä¸€è‡´ã™ã‚‹ã‚‚ã®ã‚’æ¢ã™
        // ä¸€ç•ªä¸‹ã«ã‚ã‚‹ï¼ˆyãŒå¤§ãã„ï¼‰ã‚‚ã®ã‹ã‚‰å„ªå…ˆã—ã¦æ¶ˆã™
        let targetIndex = -1;
        let maxY = -999;

        for (let i = 0; i < drops.length; i++) {
            if (drops[i].ans === num) {
                if (drops[i].y > maxY) {
                    maxY = drops[i].y;
                    targetIndex = i;
                }
            }
        }

        if (targetIndex !== -1) {
            // æ­£è§£ï¼
            const target = drops[targetIndex];
            
            // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
            target.el.classList.add('hit');
            target.el.textContent = "âœ¨"; 
            
            setTimeout(() => target.el.remove(), 200);
            
            drops.splice(targetIndex, 1);
            score += 10;
        } else {
            // ä¸æ­£è§£ï¼ˆãŠæ‰‹ã¤ãï¼‰
            // ç”»é¢ã‚’å°‘ã—èµ¤ãã—ã¦ãƒŸã‚¹ã‚’ä¼ãˆã‚‹
            gameArea.style.backgroundColor = "#5d4037"; // ä¸€ç¬èŒ¶è‰²ã£ã½ã
            setTimeout(() => gameArea.style.background = "", 100);
        }

        updateUI();
    }

    function takeDamage() {
        life--;
        updateUI();
        
        gameArea.classList.add('damage-effect');
        setTimeout(() => gameArea.classList.remove('damage-effect'), 300);

        if (life <= 0) {
            gameOver();
        }
    }

    function updateUI() {
        document.getElementById('score').textContent = score;
        let hearts = "";
        for(let i=0; i<life; i++) hearts += "â¤ï¸";
        document.getElementById('life-icons').textContent = hearts;
    }

    function gameOver() {
        isPlaying = false;
        cancelAnimationFrame(animationId);
        document.getElementById('final-score').textContent = score;
        document.getElementById('gameover-screen').style.display = 'flex';
    }

</script>
</body>
</html>