<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„É≠„Éº„ÉûÂ≠ó Ëô´„Åè„ÅÑ„ÇØ„Ç§„Ç∫</title>
    <script src="ranking.js"></script>
    <style>
        body {
            font-family: "UD Digital Kyokasho-tai-R", "Hiragino Kaku Gothic ProN", sans-serif;
            background-color: #fff3e0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            touch-action: manipulation;
        }

        #game-container {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            width: 95%;
            max-width: 500px;
        }

        .screen { display: none; }
        .active { display: block; }

        h1 { color: #ef6c00; font-size: 24px; margin: 10px 0; }

        /* ÊÉÖÂ†±„Éê„ÉºÔºà„Çø„Ç§„É†„ÉªÈÄ≤ÊçóÔºâ */
        .info-bar {
            display: flex;
            justify-content: space-between;
            padding: 0 10px;
            color: #ef6c00;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 18px;
        }

        /* ÂïèÈ°åË°®Á§∫„Ç®„É™„Ç¢ */
        .question-box {
            background: #fff8e1;
            border: 4px solid #ffcc80;
            border-radius: 20px;
            padding: 20px;
            margin: 10px 0 20px 0;
        }

        .hiragana-display {
            font-size: 80px;
            font-weight: bold;
            color: #333;
            line-height: 1.2;
        }

        .romaji-display {
            font-size: 60px;
            font-weight: bold;
            color: #ef6c00;
            font-family: 'Courier New', monospace;
            margin-top: 10px;
            letter-spacing: 5px;
        }

        .hole {
            color: #e91e63;
            text-decoration: underline;
        }

        /* ÈÅ∏ÊäûËÇ¢„Éú„Çø„É≥ */
        #choices-area {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .choice-btn {
            background: white;
            border: 3px solid #ffb74d;
            color: #ef6c00;
            font-size: 40px;
            font-weight: bold;
            padding: 15px 0;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 4px #ffe0b2;
            font-family: 'Courier New', monospace;
            transition: transform 0.1s;
        }
        .choice-btn:active {
            transform: translateY(2px);
            box-shadow: none;
        }

        /* „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ */
        .start-btn {
            font-size: 24px; padding: 15px 40px;
            background: #ef6c00; color: white;
            border: none; border-radius: 50px;
            cursor: pointer; box-shadow: 0 5px #e65100;
            margin: 10px; font-weight: bold;
        }
        .start-btn:active { transform: scale(0.95); box-shadow: none; }

        .back-btn {
            background: #90a4ae; font-size: 14px; padding: 8px 20px;
            color: white; border-radius: 20px; text-decoration: none;
            display: inline-block; margin-top: 20px;
        }

        /* ÁµêÊûú„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        #result-overlay {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 120px;
            display: none;
            pointer-events: none;
            text-shadow: 2px 2px 0 white;
            z-index: 100;
        }

    </style>
</head>
<body>

<div id="game-container">
    <div id="result-overlay">‚≠ï</div>

    <div id="home-screen" class="screen active">
        <h1>„É≠„Éº„ÉûÂ≠ó Ëô´„Åè„ÅÑ</h1>
        <div style="font-size: 80px; margin: 20px;">üî§</div>
        <p>„Å≤„Çâ„Åå„Å™„Çí „É≠„Éº„ÉûÂ≠ó„Å´„Åó„Çà„ÅÜ„ÄÇ<br>„Å¨„Åë„Å¶„ÅÑ„Çã ÊñáÂ≠ó„ÅØ „Å©„Çå„Åã„Å™Ôºü</p>
        <p style="color:#ef6c00; font-weight:bold;">„Åú„Çì„Å∂„Åß 10„ÇÇ„Çì</p>
        <button class="start-btn" onclick="startGame()">„Çπ„Çø„Éº„ÉàÔºÅ</button>
        <br>
        <a href="index.html" class="back-btn">üè† „ÇÇ„Å©„Çã</a>
    </div>

    <div id="game-screen" class="screen">
        <div class="info-bar">
            <span id="timer-display">0.0„Å≥„Çá„ÅÜ</span>
            <span id="progress-display">1 / 10</span>
        </div>

        <div class="question-box">
            <div id="hira-disp" class="hiragana-display">„Åã</div>
            <div id="roma-disp" class="romaji-display">k<span class="hole">?</span></div>
        </div>

        <div id="choices-area">
            </div>

        <a href="index.html" class="back-btn">üè† „ÇÑ„ÇÅ„Çã</a>
    </div>

    <div id="result-screen" class="screen">
        <h1>üéâ „ÇØ„É™„Ç¢ÔºÅ üéâ</h1>
        <div style="font-size: 80px; margin: 20px;">üèÜ</div>
        <p>„Çø„Ç§„É†„Ç¢„Çø„ÉÉ„ÇØ „Åë„Å£„Åã</p>
        <div id="final-time" style="font-size:40px; color:#ef6c00; font-weight:bold; margin:10px;">0.0„Å≥„Çá„ÅÜ</div>
        
        <button class="start-btn" onclick="startGame()">„ÇÇ„ÅÜ„ÅÑ„Å£„Åã„ÅÑ</button>
        <br>
        <a href="index.html" class="back-btn">üè† „Éõ„Éº„É†„Å∏</a>
    </div>

</div>

<script>
    // ÂïèÈ°å„Éá„Éº„ÇøÔºàÂü∫Êú¨„ÅÆ„É≠„Éº„ÉûÂ≠óÔºâ
    const masterData = [
        {h:'„ÅÇ', r:'a'}, {h:'„ÅÑ', r:'i'}, {h:'„ÅÜ', r:'u'}, {h:'„Åà', r:'e'}, {h:'„Åä', r:'o'},
        {h:'„Åã', r:'ka'}, {h:'„Åç', r:'ki'}, {h:'„Åè', r:'ku'}, {h:'„Åë', r:'ke'}, {h:'„Åì', r:'ko'},
        {h:'„Åï', r:'sa'}, {h:'„Åó', r:'shi'}, {h:'„Åô', r:'su'}, {h:'„Åõ', r:'se'}, {h:'„Åù', r:'so'},
        {h:'„Åü', r:'ta'}, {h:'„Å°', r:'chi'}, {h:'„Å§', r:'tsu'}, {h:'„Å¶', r:'te'}, {h:'„Å®', r:'to'},
        {h:'„Å™', r:'na'}, {h:'„Å´', r:'ni'}, {h:'„Å¨', r:'nu'}, {h:'„Å≠', r:'ne'}, {h:'„ÅÆ', r:'no'},
        {h:'„ÅØ', r:'ha'}, {h:'„Å≤', r:'hi'}, {h:'„Åµ', r:'fu'}, {h:'„Å∏', r:'he'}, {h:'„Åª', r:'ho'},
        {h:'„Åæ', r:'ma'}, {h:'„Åø', r:'mi'}, {h:'„ÇÄ', r:'mu'}, {h:'„ÇÅ', r:'me'}, {h:'„ÇÇ', r:'mo'},
        {h:'„ÇÑ', r:'ya'}, {h:'„ÇÜ', r:'yu'}, {h:'„Çà', r:'yo'},
        {h:'„Çâ', r:'ra'}, {h:'„Çä', r:'ri'}, {h:'„Çã', r:'ru'}, {h:'„Çå', r:'re'}, {h:'„Çç', r:'ro'},
        {h:'„Çè', r:'wa'}, {h:'„Çí', r:'wo'}, {h:'„Çì', r:'n'}
    ];

    const vowels = ['a', 'i', 'u', 'e', 'o'];
    const consonants = ['k', 's', 't', 'n', 'h', 'm', 'y', 'r', 'w'];

    let questions = [];
    let currentQIndex = 0;
    let correctAnswer = ""; 
    const totalQuestions = 10; // 10Âïè„Å´Ë®≠ÂÆö

    // „Çø„Ç§„Éû„ÉºÂ§âÊï∞
    let startTime;
    let timerInterval;

    function changeScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function startGame() {
        // „É©„É≥„ÉÄ„É†„Å´10ÂïèÈÅ∏Âá∫
        questions = [];
        const copyData = [...masterData];
        for(let i=0; i<totalQuestions; i++){
            if(copyData.length === 0) break;
            const r = Math.floor(Math.random() * copyData.length);
            questions.push(copyData[r]);
            copyData.splice(r, 1);
        }

        currentQIndex = 0;
        changeScreen('game-screen');
        startTimer(); // „Çø„Ç§„Éû„Éº„Çπ„Çø„Éº„Éà
        nextProblem();
    }

    function startTimer() {
        startTime = Date.now();
        timerInterval = setInterval(() => {
            const t = ((Date.now() - startTime) / 1000).toFixed(1);
            document.getElementById('timer-display').textContent = t + "„Å≥„Çá„ÅÜ";
        }, 100);
    }

    function stopTimer() {
        clearInterval(timerInterval);
        return ((Date.now() - startTime) / 1000).toFixed(1);
    }

    function nextProblem() {
        if(currentQIndex >= questions.length) {
            // „Ç≤„Éº„É†ÁµÇ‰∫Ü
            const finalTime = stopTimer();
            document.getElementById('final-time').textContent = finalTime + "„Å≥„Çá„ÅÜ";
            changeScreen('result-screen');

            if(typeof showSaveDialog === 'function') {
                showSaveDialog('romaji_hole', finalTime);
            }
            return;
        }

        document.getElementById('progress-display').textContent = (currentQIndex + 1) + " / " + totalQuestions;
        const q = questions[currentQIndex];
        
        // „É≠„Éº„ÉûÂ≠ó„ÅÆ„Å©„Åì„ÇíÈö†„Åô„Åã„É©„É≥„ÉÄ„É†
        const hiddenIndex = Math.floor(Math.random() * q.r.length);
        correctAnswer = q.r[hiddenIndex];

        document.getElementById('hira-disp').textContent = q.h;
        
        let displayHtml = "";
        for(let i=0; i<q.r.length; i++) {
            if(i === hiddenIndex) {
                displayHtml += '<span class="hole">?</span>';
            } else {
                displayHtml += q.r[i];
            }
        }
        document.getElementById('roma-disp').innerHTML = displayHtml;

        // ÈÅ∏ÊäûËÇ¢‰ΩúÊàê
        let choices = [correctAnswer];
        let pool = vowels.includes(correctAnswer) ? vowels : consonants;
        if(!pool.includes(correctAnswer)) {
            pool = "abcdefghijklmnopqrstuvwxyz".split('');
        }

        while(choices.length < 4) {
            const r = pool[Math.floor(Math.random() * pool.length)];
            if(!choices.includes(r)) {
                choices.push(r);
            }
        }
        choices.sort(() => Math.random() - 0.5);

        const area = document.getElementById('choices-area');
        area.innerHTML = "";
        choices.forEach(char => {
            const btn = document.createElement('button');
            btn.className = 'choice-btn';
            btn.textContent = char;
            btn.onclick = () => checkAnswer(char);
            area.appendChild(btn);
        });
    }

    function checkAnswer(ans) {
        const overlay = document.getElementById('result-overlay');
        
        if(ans === correctAnswer) {
            overlay.textContent = "‚≠ï";
            overlay.style.display = "block";
            overlay.style.color = "#ef6c00";
            
            setTimeout(() => {
                overlay.style.display = "none";
                currentQIndex++;
                nextProblem();
            }, 500); // „ÉÜ„É≥„Éù„Çà„ÅèÈÄ≤„ÇÄ„Çà„ÅÜÂ∞ë„ÅóÁü≠„Åè„Åó„Åæ„Åó„Åü
        } else {
            overlay.textContent = "‚ùå";
            overlay.style.display = "block";
            overlay.style.color = "#555";
            
            setTimeout(() => {
                overlay.style.display = "none";
            }, 500);
        }
    }

</script>

</body>
</html>