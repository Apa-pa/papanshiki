<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ­ãƒ¼ãƒå­— è™«ãã„ã‚¯ã‚¤ã‚º</title>
    <style>
        body {
            font-family: "UD Digital Kyokasho-tai-R", "Hiragino Kaku Gothic ProN", sans-serif;
            background-color: #fff3e0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            touch-action: manipulation;
        }

        #game-container {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            width: 95%;
            max-width: 500px;
        }

        .screen { display: none; }
        .active { display: block; }

        h1 { color: #ef6c00; font-size: 24px; margin: 10px 0; }

        /* æƒ…å ±ãƒãƒ¼ï¼ˆã‚¿ã‚¤ãƒ ãƒ»é€²æ—ï¼‰ */
        .info-bar {
            display: flex;
            justify-content: space-between;
            padding: 0 10px;
            color: #ef6c00;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 18px;
        }

        /* å•é¡Œè¡¨ç¤ºã‚¨ãƒªã‚¢ */
        .question-box {
            background: #fff8e1;
            border: 4px solid #ffcc80;
            border-radius: 20px;
            padding: 20px;
            margin: 10px 0 20px 0;
        }

        .hiragana-display {
            font-size: 80px;
            font-weight: bold;
            color: #333;
            line-height: 1.2;
        }

        .romaji-display {
            font-size: 60px;
            font-weight: bold;
            color: #ef6c00;
            font-family: 'Courier New', monospace;
            margin-top: 10px;
            letter-spacing: 5px;
        }

        .hole {
            color: #e91e63;
            text-decoration: underline;
        }

        /* é¸æŠè‚¢ãƒœã‚¿ãƒ³ */
        #choices-area {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .choice-btn {
            background: white;
            border: 3px solid #ffb74d;
            color: #ef6c00;
            font-size: 40px;
            font-weight: bold;
            padding: 15px 0;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 4px #ffe0b2;
            font-family: 'Courier New', monospace;
            transition: transform 0.1s;
        }
        .choice-btn:active {
            transform: translateY(2px);
            box-shadow: none;
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .start-btn {
            font-size: 24px; padding: 15px 40px;
            background: #ef6c00; color: white;
            border: none; border-radius: 50px;
            cursor: pointer; box-shadow: 0 5px #e65100;
            margin: 10px; font-weight: bold;
        }
        .start-btn:active { transform: scale(0.95); box-shadow: none; }

        .back-btn {
            background: #90a4ae; font-size: 14px; padding: 8px 20px;
            color: white; border-radius: 20px; text-decoration: none;
            display: inline-block; margin-top: 20px;
        }

        /* çµæœã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        #result-overlay {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 120px;
            display: none;
            pointer-events: none;
            text-shadow: 2px 2px 0 white;
            z-index: 100;
        }

    </style>
</head>
<body>

<div id="game-container">
    <div id="result-overlay">â­•</div>

    <div id="home-screen" class="screen active">
        <h1>ãƒ­ãƒ¼ãƒå­— è™«ãã„</h1>
        <div style="font-size: 80px; margin: 20px;">ğŸ”¤</div>
        <p>ã²ã‚‰ãŒãªã‚’ ãƒ­ãƒ¼ãƒå­—ã«ã—ã‚ˆã†ã€‚<br>ã¬ã‘ã¦ã„ã‚‹ æ–‡å­—ã¯ ã©ã‚Œã‹ãªï¼Ÿ</p>
        <p style="color:#ef6c00; font-weight:bold;">ãœã‚“ã¶ã§ 10ã‚‚ã‚“</p>
        <button class="start-btn" onclick="startGame()">ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>
        <br>
        <a href="index.html" class="back-btn">ğŸ  ã‚‚ã©ã‚‹</a>
    </div>

    <div id="game-screen" class="screen">
        <div class="info-bar">
            <span id="timer-display">0.0ã³ã‚‡ã†</span>
            <span id="progress-display">1 / 10</span>
        </div>

        <div class="question-box">
            <div id="hira-disp" class="hiragana-display">ã‹</div>
            <div id="roma-disp" class="romaji-display">k<span class="hole">?</span></div>
        </div>

        <div id="choices-area">
            </div>

        <a href="index.html" class="back-btn">ğŸ  ã‚„ã‚ã‚‹</a>
    </div>

    <div id="result-screen" class="screen">
        <h1>ğŸ‰ ã‚¯ãƒªã‚¢ï¼ ğŸ‰</h1>
        <div style="font-size: 80px; margin: 20px;">ğŸ†</div>
        <p>ã‚¿ã‚¤ãƒ ã‚¢ã‚¿ãƒƒã‚¯ ã‘ã£ã‹</p>
        <div id="final-time" style="font-size:40px; color:#ef6c00; font-weight:bold; margin:10px;">0.0ã³ã‚‡ã†</div>
        
        <button class="start-btn" onclick="startGame()">ã‚‚ã†ã„ã£ã‹ã„</button>
        <br>
        <a href="index.html" class="back-btn">ğŸ  ãƒ›ãƒ¼ãƒ ã¸</a>
    </div>

</div>

<script>
    // å•é¡Œãƒ‡ãƒ¼ã‚¿ï¼ˆåŸºæœ¬ã®ãƒ­ãƒ¼ãƒå­—ï¼‰
    const masterData = [
        {h:'ã‚', r:'a'}, {h:'ã„', r:'i'}, {h:'ã†', r:'u'}, {h:'ãˆ', r:'e'}, {h:'ãŠ', r:'o'},
        {h:'ã‹', r:'ka'}, {h:'ã', r:'ki'}, {h:'ã', r:'ku'}, {h:'ã‘', r:'ke'}, {h:'ã“', r:'ko'},
        {h:'ã•', r:'sa'}, {h:'ã—', r:'shi'}, {h:'ã™', r:'su'}, {h:'ã›', r:'se'}, {h:'ã', r:'so'},
        {h:'ãŸ', r:'ta'}, {h:'ã¡', r:'chi'}, {h:'ã¤', r:'tsu'}, {h:'ã¦', r:'te'}, {h:'ã¨', r:'to'},
        {h:'ãª', r:'na'}, {h:'ã«', r:'ni'}, {h:'ã¬', r:'nu'}, {h:'ã­', r:'ne'}, {h:'ã®', r:'no'},
        {h:'ã¯', r:'ha'}, {h:'ã²', r:'hi'}, {h:'ãµ', r:'fu'}, {h:'ã¸', r:'he'}, {h:'ã»', r:'ho'},
        {h:'ã¾', r:'ma'}, {h:'ã¿', r:'mi'}, {h:'ã‚€', r:'mu'}, {h:'ã‚', r:'me'}, {h:'ã‚‚', r:'mo'},
        {h:'ã‚„', r:'ya'}, {h:'ã‚†', r:'yu'}, {h:'ã‚ˆ', r:'yo'},
        {h:'ã‚‰', r:'ra'}, {h:'ã‚Š', r:'ri'}, {h:'ã‚‹', r:'ru'}, {h:'ã‚Œ', r:'re'}, {h:'ã‚', r:'ro'},
        {h:'ã‚', r:'wa'}, {h:'ã‚’', r:'wo'}, {h:'ã‚“', r:'n'}
    ];

    const vowels = ['a', 'i', 'u', 'e', 'o'];
    const consonants = ['k', 's', 't', 'n', 'h', 'm', 'y', 'r', 'w'];

    let questions = [];
    let currentQIndex = 0;
    let correctAnswer = ""; 
    const totalQuestions = 10; // 10å•ã«è¨­å®š

    // ã‚¿ã‚¤ãƒãƒ¼å¤‰æ•°
    let startTime;
    let timerInterval;

    function changeScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function startGame() {
        // ãƒ©ãƒ³ãƒ€ãƒ ã«10å•é¸å‡º
        questions = [];
        const copyData = [...masterData];
        for(let i=0; i<totalQuestions; i++){
            if(copyData.length === 0) break;
            const r = Math.floor(Math.random() * copyData.length);
            questions.push(copyData[r]);
            copyData.splice(r, 1);
        }

        currentQIndex = 0;
        changeScreen('game-screen');
        startTimer(); // ã‚¿ã‚¤ãƒãƒ¼ã‚¹ã‚¿ãƒ¼ãƒˆ
        nextProblem();
    }

    function startTimer() {
        startTime = Date.now();
        timerInterval = setInterval(() => {
            const t = ((Date.now() - startTime) / 1000).toFixed(1);
            document.getElementById('timer-display').textContent = t + "ã³ã‚‡ã†";
        }, 100);
    }

    function stopTimer() {
        clearInterval(timerInterval);
        return ((Date.now() - startTime) / 1000).toFixed(1);
    }

    function nextProblem() {
        if(currentQIndex >= questions.length) {
            // ã‚²ãƒ¼ãƒ çµ‚äº†
            const finalTime = stopTimer();
            document.getElementById('final-time').textContent = finalTime + "ã³ã‚‡ã†";
            changeScreen('result-screen');
            return;
        }

        document.getElementById('progress-display').textContent = (currentQIndex + 1) + " / " + totalQuestions;
        const q = questions[currentQIndex];
        
        // ãƒ­ãƒ¼ãƒå­—ã®ã©ã“ã‚’éš ã™ã‹ãƒ©ãƒ³ãƒ€ãƒ 
        const hiddenIndex = Math.floor(Math.random() * q.r.length);
        correctAnswer = q.r[hiddenIndex];

        document.getElementById('hira-disp').textContent = q.h;
        
        let displayHtml = "";
        for(let i=0; i<q.r.length; i++) {
            if(i === hiddenIndex) {
                displayHtml += '<span class="hole">?</span>';
            } else {
                displayHtml += q.r[i];
            }
        }
        document.getElementById('roma-disp').innerHTML = displayHtml;

        // é¸æŠè‚¢ä½œæˆ
        let choices = [correctAnswer];
        let pool = vowels.includes(correctAnswer) ? vowels : consonants;
        if(!pool.includes(correctAnswer)) {
            pool = "abcdefghijklmnopqrstuvwxyz".split('');
        }

        while(choices.length < 4) {
            const r = pool[Math.floor(Math.random() * pool.length)];
            if(!choices.includes(r)) {
                choices.push(r);
            }
        }
        choices.sort(() => Math.random() - 0.5);

        const area = document.getElementById('choices-area');
        area.innerHTML = "";
        choices.forEach(char => {
            const btn = document.createElement('button');
            btn.className = 'choice-btn';
            btn.textContent = char;
            btn.onclick = () => checkAnswer(char);
            area.appendChild(btn);
        });
    }

    function checkAnswer(ans) {
        const overlay = document.getElementById('result-overlay');
        
        if(ans === correctAnswer) {
            overlay.textContent = "â­•";
            overlay.style.display = "block";
            overlay.style.color = "#ef6c00";
            
            setTimeout(() => {
                overlay.style.display = "none";
                currentQIndex++;
                nextProblem();
            }, 500); // ãƒ†ãƒ³ãƒã‚ˆãé€²ã‚€ã‚ˆã†å°‘ã—çŸ­ãã—ã¾ã—ãŸ
        } else {
            overlay.textContent = "âŒ";
            overlay.style.display = "block";
            overlay.style.color = "#555";
            
            setTimeout(() => {
                overlay.style.display = "none";
            }, 500);
        }
    }

</script>

</body>
</html>