<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãœã‚“ã“ããƒ©ãƒ³ã‚­ãƒ³ã‚° - ã±ã±ã‚“å¼</title>
    <style>
        body {
            font-family: "UD Digital Kyokasho-tai-R", "Hiragino Kaku Gothic ProN", sans-serif;
            background-color: #f0f4f8;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 500px;
            text-align: center;
        }
        h1 { color: #1976d2; font-size: 24px; }
        .game-select {
            margin-bottom: 20px;
            padding: 10px;
            font-size: 16px;
            border-radius: 10px;
            border: 2px solid #bbdefb;
            width: 100%;
        }
        .ranking-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .ranking-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #eee;
            font-size: 18px;
        }
        .ranking-item:nth-child(1) { background-color: #fff9c4; font-weight: bold; } /* 1ä½ã¯é‡‘è‰²ã£ã½ã */
        .rank { width: 40px; font-size: 20px; }
        .name { flex-grow: 1; text-align: left; margin-left: 10px; }
        .score { color: #e91e63; font-weight: bold; }
        
        .loading { padding: 20px; color: #888; }
        .back-btn {
            margin-top: 20px;
            display: inline-block;
            padding: 10px 20px;
            background: #90a4ae;
            color: white;
            text-decoration: none;
            border-radius: 20px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ† ãœã‚“ã“ããƒ©ãƒ³ã‚­ãƒ³ã‚°</h1>
    
    <select id="game-selector" class="game-select" onchange="loadRanking()">
        <option value="touch25">1ã‹ã‚‰25ã¾ã§ã‚¿ãƒƒãƒ</option>
        </select>

    <div id="ranking-container">
        <div class="loading">ãƒ‡ãƒ¼ã‚¿ã‚’ ã‚ˆã¿ã“ã¿ä¸­...</div>
    </div>

    <a href="index.html" class="back-btn">ğŸ  ã‚‚ã©ã‚‹</a>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
    import { getFirestore, collection, query, where, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";

    // Firebaseè¨­å®š (firebase-ranking.jsã¨åŒã˜ã‚‚ã®ã‚’ä½¿ç”¨)
     const firebaseConfig = {
    apiKey: "AIzaSyCYHfZ5ya_HuhutF6eI5vtbXugYb4zKC9g",
    authDomain: "papan-shiki.firebaseapp.com",
    projectId: "papan-shiki",
    storageBucket: "papan-shiki.firebasestorage.app",
    messagingSenderId: "157576103115",
    appId: "1:157576103115:web:1278e7167cbb60ee71c74e"
  };


    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ãƒ©ãƒ³ã‚­ãƒ³ã‚°èª­ã¿è¾¼ã¿é–¢æ•°
    async function loadRanking() {
        const gameId = document.getElementById('game-selector').value;
        const container = document.getElementById('ranking-container');
        container.innerHTML = '<div class="loading">ãƒ‡ãƒ¼ã‚¿ã‚’ ã‚ˆã¿ã“ã¿ä¸­...</div>';

        try {
            // ã‚¯ã‚¨ãƒªã®ä½œæˆ (gameIdã§çµã‚Šè¾¼ã¿ã€scoreã®æ˜‡é †(Timeãªã‚‰æ—©ã„é †)ã§ä¸Šä½10ä»¶)
            // â€»ã‚¹ã‚³ã‚¢å½¢å¼ã®ã‚²ãƒ¼ãƒ ãªã‚‰ 'desc' ã«å¤‰ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
            const q = query(
                collection(db, "world_rankings"),
                where("gameId", "==", gameId),
                orderBy("score", "asc"), 
                limit(10)
            );

            const querySnapshot = await getDocs(q);
            let html = '<ul class="ranking-list">';
            let rank = 1;

            if (querySnapshot.empty) {
                html += '<li class="loading">ã¾ã  ãã‚ããŒ ã‚ã‚Šã¾ã›ã‚“ã€‚</li>';
            } else {
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const medal = rank === 1 ? 'ğŸ¥‡' : rank === 2 ? 'ğŸ¥ˆ' : rank === 3 ? 'ğŸ¥‰' : rank;
                    html += `
                        <li class="ranking-item">
                            <span class="rank">${medal}</span>
                            <span class="name">${data.name}</span>
                            <span class="score">${data.score} <small>ç§’</small></span>
                        </li>
                    `;
                    rank++;
                });
            }
            html += '</ul>';
            container.innerHTML = html;

        } catch (e) {
            console.error("èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ", e);
            container.innerHTML = '<div class="loading" style="color:red;">ã‚¨ãƒ©ãƒ¼ãŒ ãŠãã¾ã—ãŸã€‚</div>';
        }
    }

    // åˆå›èª­ã¿è¾¼ã¿
    window.loadRanking = loadRanking;
    loadRanking();
</script>

</body>
</html>