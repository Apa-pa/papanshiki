<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒ©ãƒãƒ©ã¶ã‚“ã—ã‚‡ã†ãƒ‘ã‚ºãƒ«</title>
    <script src="ranking.js"></script>
    <style>
        body {
            font-family: "UD Digital Kyokasho-tai-R", "Hiragino Kaku Gothic ProN", sans-serif;
            background-color: #fce4ec; /* ã‚„ã•ã—ã„ãƒ”ãƒ³ã‚¯ */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            touch-action: manipulation;
        }

        #game-container {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            width: 95%;
            max-width: 600px;
            min-height: 500px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .screen { display: none; }
        .active { display: block; }

        h1 { color: #e91e63; font-size: 24px; margin: 10px 0; }

        /* --- ã‚²ãƒ¼ãƒ ç”»é¢ã®ãƒ‡ã‚¶ã‚¤ãƒ³ --- */
        
        /* 1. ç­”ãˆã‚’è¡¨ç¤ºã™ã‚‹ã‚¨ãƒªã‚¢ï¼ˆä¸Šã®æ®µï¼‰ */
        #answer-area {
            background-color: #fff0f5;
            border: 3px dashed #f48fb1;
            border-radius: 15px;
            padding: 20px;
            min-height: 80px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        
        /* ç©ºã£ã½ã®ã¨ãã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .placeholder-text {
            color: #aaa;
            font-size: 16px;
            pointer-events: none;
        }

        /* 2. é¸ã¶è¨€è‘‰ã®ã‚¨ãƒªã‚¢ï¼ˆä¸‹ã®æ®µï¼‰ */
        #choices-area {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            min-height: 100px;
        }

        /* è¨€è‘‰ã‚«ãƒ¼ãƒ‰ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .word-card {
            background: white;
            border: 2px solid #e91e63;
            color: #e91e63;
            font-size: 24px;
            font-weight: bold;
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px #f8bbd0;
            transition: transform 0.1s, background 0.2s;
            user-select: none;
        }
        .word-card:active {
            transform: translateY(2px);
            box-shadow: none;
        }
        /* é¸æŠæ¸ˆã¿ã®ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ« */
        .word-card-selected {
            background: #e91e63;
            color: white;
            box-shadow: 0 4px #b0003a;
        }

        /* ãƒœã‚¿ãƒ³é¡ */
        .start-btn {
            font-size: 24px; padding: 15px 40px;
            background: #e91e63; color: white;
            border: none; border-radius: 50px;
            cursor: pointer; box-shadow: 0 5px #c2185b;
            margin: 10px; font-weight: bold;
        }
        .start-btn:active { transform: scale(0.95); box-shadow: none; }

        .check-btn {
            font-size: 22px; padding: 12px 50px;
            background: #00bcd4; color: white;
            border: none; border-radius: 50px;
            cursor: pointer; box-shadow: 0 5px #0097a7;
            font-weight: bold; margin-bottom: 10px;
            display: none; /* æœ€åˆã¯éš ã™ */
        }
        .check-btn:active { transform: translateY(2px); box-shadow: none; }

        .back-btn {
            background: #90a4ae; font-size: 14px; padding: 8px 20px;
            color: white; border-radius: 20px; text-decoration: none;
            display: inline-block; margin-top: 20px;
        }

        /* çµæœè¡¨ç¤º */
        #result-msg {
            font-size: 28px; font-weight: bold; margin: 20px 0; min-height: 40px;
        }
        .correct-anim { animation: hop 0.5s; }
        @keyframes hop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

    </style>
</head>
<body>

<div id="game-container">

    <div id="home-screen" class="screen active">
        <h1>ãƒãƒ©ãƒãƒ©ã¶ã‚“ã—ã‚‡ã†</h1>
        <div style="font-size: 80px; margin: 20px;">ğŸ§©</div>
        <p>ãƒãƒ©ãƒãƒ©ã«ãªã£ãŸ ã“ã¨ã°ã‚’<br>ãŸã ã—ã„ ã˜ã‚…ã‚“ã°ã‚“ã« ãªã‚‰ã¹ã¦ã­ï¼</p>
        <p style="color:#e91e63; font-weight:bold;">ãœã‚“ã¶ã§ 5ã‚‚ã‚“ ã ã‚ˆ</p>
        <button class="start-btn" onclick="startGame()">ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>
        <br>
        <a href="index.html" class="back-btn">ğŸ  ã‚‚ã©ã‚‹</a>
    </div>

    <div id="game-screen" class="screen">
        <div style="text-align: right; color:#888; font-size:14px;">
            ã‚‚ã‚“ã ã„ <span id="q-count">1</span> / 5
        </div>
        
        <h2>ãŸã ã—ã„ ã˜ã‚…ã‚“ã°ã‚“ã« ãŠã—ã¦ã­</h2>

        <div id="answer-area">
            <span class="placeholder-text">ã“ã“ã‚’ãŠã—ã¦ ã“ã¨ã°ã‚’ ã„ã‚Œã¦ã­</span>
        </div>

        <div id="choices-area">
            </div>

        <div id="result-msg"></div>

        <button id="check-btn" class="check-btn" onclick="checkAnswer()">ã“ã‚Œã§ãã¾ã‚Šï¼</button>
        
        <div id="next-area" style="display:none;">
            <button class="start-btn" onclick="nextProblem()">ã¤ãã® ã‚‚ã‚“ã ã„</button>
        </div>

        <br>
        <a href="index.html" class="back-btn" id="quit-btn">ğŸ  ã‚„ã‚ã‚‹</a>
    </div>

    <div id="clear-screen" class="screen">
        <h1>ğŸ‰ ãœã‚“ã¶ã§ããŸï¼ ğŸ‰</h1>
        <div style="font-size: 80px; margin: 20px;">ğŸ’®</div>
        <p>ã™ã”ã„ï¼ ã“ãã”ãƒã‚¹ã‚¿ãƒ¼ã ã­ï¼</p>
        <button onclick="showPointGetDialog(30)" style="font-size:20px; padding:10px 30px; background:#ff9800; color:white; border:none; border-radius:30px; margin:10px; font-weight:bold; cursor:pointer;">
    ğŸ 30ãƒã‚¤ãƒ³ãƒˆã‚’ã‚‚ã‚‰ã†
</button>
        <button class="start-btn" onclick="startGame()">ã‚‚ã†ã„ã£ã‹ã„</button>
        <br>
        <a href="index.html" class="back-btn">ğŸ  ãƒ›ãƒ¼ãƒ ã¸</a>
    </div>

</div>

<script>
    // å•é¡Œãƒ‡ãƒ¼ã‚¿ï¼ˆã™ã¹ã¦ã²ã‚‰ãŒãªï¼‰
    // 30å•ä»¥ä¸Šã«å¢—ã‚„ã—ã¾ã—ãŸ
    const problems = [
        ["ã­ã“", "ãŒ", "ã•ã‹ãª", "ã‚’", "ãŸã¹ãŸ"],
        ["ã‚ãŸã—", "ã¯", "ã‚Šã‚“ã”", "ãŒ", "ã™ã"],
        ["ã‚ã—ãŸ", "ã¯", "ã“ã†ãˆã‚“", "ã«", "ã„ã"],
        ["ã„ã¬", "ãŒ", "ã‚ã‚“ã‚ã‚“", "ã¨", "ã»ãˆã‚‹"],
        ["ãã‚‡ã†", "ã¯", "ã„ã„", "ã¦ã‚“ã", "ã "],
        ["ã¦", "ã‚’", "ãã‚Œã„ã«", "ã‚ã‚‰ã†"],
        ["ãŠãŠããª", "ã“ãˆ", "ã§", "ã†ãŸã†"],
        ["ã‚ã‹ã„", "ã¯ãª", "ãŒ", "ã•ã„ãŸ"],
        ["ã»ã‚“", "ã‚’", "ãŸãã•ã‚“", "ã‚ˆã‚€"],
        ["ã”ã¡ãã†ã•ã¾", "ã§ã—ãŸ"],
        ["ãŠã¨ã†ã•ã‚“", "ãŒ", "ã”ã¯ã‚“", "ã‚’", "ã¤ãã‚‹"],
        ["ã†ã•ã", "ãŒ", "ã´ã‚‡ã‚“ã´ã‚‡ã‚“", "ã¯ã­ã‚‹"],
        ["ãŒã£ã“ã†", "ã¸", "ã„ã£ã¦ãã¾ã™"],
        ["ãŠãµã‚", "ã«", "ã¯ã„ã£ã¦", "ã‚ãŸãŸã¾ã‚‹"],
        ["ãˆã‚“ã´ã¤", "ã§", "ã˜", "ã‚’", "ã‹ã"],
        ["ã‚ã‚", "ãŒ", "ã–ã‚ã–ã‚", "ãµã£ã¦", "ããŸ"],
        ["ã¨ã‚‚ã ã¡", "ã¨", "ãªã‹ã‚ˆã", "ã‚ãã¶"],
        ["ã±ã‚“ã ", "ãŒ", "ã•ã•", "ã‚’", "ãŸã¹ã‚‹"],
        ["ãã„ã‚ã„", "ã¡ã‚‡ã†ã¡ã‚‡", "ãŒ", "ã¨ã‚“ã§ã„ã‚‹"],
        ["ãŠã°ã‚ã¡ã‚ƒã‚“", "ã®", "ã„ãˆ", "ã«", "ã„ã"],
        ["ã†ã¿", "ã§", "ã•ã‹ãª", "ã¨", "ãŠã‚ˆã"],
        ["ã©ã‚“ãã‚Š", "ã‚’", "ã²ã‚ã£ã¦", "ã‚ãã¶"],
        ["ã¯", "ã‚’", "ã—ã£ã‹ã‚Š", "ã¿ãŒã"],
        ["ã‚ˆã‚‹", "ã¯", "ã¯ã‚„ã", "ã­ã‚‹"],
        ["ã›ã‚“ã›ã„", "ã«", "ãŠã¯ã‚ˆã†", "ã¨", "ã„ã†"],
        ["ãã‚…ã†ã«ã‚…ã†", "ã‚’", "ã”ãã”ã", "ã®ã‚€"],
        ["ã½ã‘ã£ã¨", "ã«", "ã¯ã‚“ã‹ã¡", "ã‚’", "ã„ã‚Œã‚‹"],
        ["ã¿ãš", "ã‚’", "ãŸã„ã›ã¤ã«", "ã¤ã‹ã†"],
        ["ãŠã²ã•ã¾", "ãŒ", "ã½ã‹ã½ã‹", "ã‚ãŸãŸã‹ã„"],
        ["ã«ã˜", "ãŒ", "ãã‚Œã„ã«", "ã§ã¦ã„ã‚‹"],
        ["ã¨ã‚Š", "ãŒ", "ãã‚‰", "ã‚’", "ã¨ã¶"]
    ];

    let currentProblemIndex = 0;
    let currentProblem = []; // ä»Šã®å•é¡Œï¼ˆæ­£ã—ã„é †åºï¼‰
    let shuffledChoices = []; // ãƒãƒ©ãƒãƒ©ã®é¸æŠè‚¢
    let userAns = []; // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸ã‚“ã é †åº
    
    // å…¨5å•ã«å¤‰æ›´
    let totalQuestions = 5; 
    
    // å‡ºé¡Œç”¨é…åˆ—
    let selectedProblems = [];

    // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
    function changeScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function startGame() {
        currentProblemIndex = 0;
        
        // å…¨å•é¡Œã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«5å•é¸ã¶
        // é…åˆ—ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã€å…ˆé ­5å€‹ã‚’å–å¾—
        selectedProblems = [...problems].sort(() => Math.random() - 0.5).slice(0, totalQuestions);
        
        changeScreen('game-screen');
        loadProblem();
    }

    function loadProblem() {
        // å…¨å•çµ‚äº†ãƒã‚§ãƒƒã‚¯
        if(currentProblemIndex >= totalQuestions) {
            changeScreen('clear-screen');
            return;
        }

        // è¡¨ç¤ºã®ãƒªã‚»ãƒƒãƒˆ
        document.getElementById('q-count').textContent = currentProblemIndex + 1;
        document.getElementById('result-msg').textContent = "";
        document.getElementById('check-btn').style.display = 'none'; // ãƒœã‚¿ãƒ³éš ã™
        document.getElementById('next-area').style.display = 'none';
        document.getElementById('quit-btn').style.display = 'inline-block';
        
        // å•é¡Œã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        currentProblem = selectedProblems[currentProblemIndex]; // æ­£è§£ãƒ‡ãƒ¼ã‚¿
        userAns = [];

        // é¸æŠè‚¢ç”¨ã«ã‚³ãƒ”ãƒ¼ã—ã¦ã‚·ãƒ£ãƒƒãƒ•ãƒ«
        shuffledChoices = currentProblem.map((word, index) => ({
            id: index,
            text: word
        }));
        shuffledChoices.sort(() => Math.random() - 0.5);

        renderArea();
    }

    // ç”»é¢ã®æç”»ï¼ˆç­”ãˆã‚¨ãƒªã‚¢ã¨é¸æŠè‚¢ã‚¨ãƒªã‚¢ï¼‰
    function renderArea() {
        const ansArea = document.getElementById('answer-area');
        const choiceArea = document.getElementById('choices-area');
        
        ansArea.innerHTML = "";
        choiceArea.innerHTML = "";

        // --- 1. ç­”ãˆã‚¨ãƒªã‚¢ã®æç”» ---
        if (userAns.length === 0) {
            ansArea.innerHTML = '<span class="placeholder-text">ã“ã“ã‚’ãŠã—ã¦ ã“ã¨ã°ã‚’ ã„ã‚Œã¦ã­</span>';
        } else {
            userAns.forEach((item, index) => {
                const btn = document.createElement('div');
                btn.className = 'word-card word-card-selected';
                btn.textContent = item.text;
                // ã‚¯ãƒªãƒƒã‚¯ã§æˆ»ã™
                btn.onclick = () => returnWord(index);
                ansArea.appendChild(btn);
            });
        }

        // --- 2. é¸æŠè‚¢ã‚¨ãƒªã‚¢ã®æç”» ---
        // userAnsã«å«ã¾ã‚Œã¦ã„ãªã„ã‚‚ã®ã ã‘è¡¨ç¤º
        shuffledChoices.forEach(item => {
            // ã™ã§ã«é¸ã°ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            const isSelected = userAns.some(selected => selected.id === item.id);
            
            if (!isSelected) {
                const btn = document.createElement('div');
                btn.className = 'word-card';
                btn.textContent = item.text;
                // ã‚¯ãƒªãƒƒã‚¯ã§é¸ã¶
                btn.onclick = () => selectWord(item);
                choiceArea.appendChild(btn);
            }
        });

        // --- 3. ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºåˆ¶å¾¡ ---
        // å…¨éƒ¨ã®è¨€è‘‰ã‚’é¸ã‚“ã ã‚‰ã€Œæ±ºå®šãƒœã‚¿ãƒ³ã€ã‚’å‡ºã™
        if (userAns.length === currentProblem.length) {
            document.getElementById('check-btn').style.display = 'inline-block';
        } else {
            document.getElementById('check-btn').style.display = 'none';
        }
    }

    // è¨€è‘‰ã‚’é¸ã¶ï¼ˆä¸‹ã‹ã‚‰ä¸Šã¸ï¼‰
    function selectWord(item) {
        if(document.getElementById('next-area').style.display === 'block') return;
        userAns.push(item);
        renderArea();
    }

    // è¨€è‘‰ã‚’æˆ»ã™ï¼ˆä¸Šã‹ã‚‰ä¸‹ã¸ï¼‰
    function returnWord(index) {
        if(document.getElementById('next-area').style.display === 'block') return;
        userAns.splice(index, 1); 
        renderArea();
    }

    // ç­”ãˆåˆã‚ã›
    function checkAnswer() {
        const msg = document.getElementById('result-msg');
        
        let isCorrect = true;
        for(let i=0; i<currentProblem.length; i++) {
            if(userAns[i].text !== currentProblem[i]) {
                isCorrect = false;
                break;
            }
        }

        if (isCorrect) {
            msg.textContent = "â­• ã ã„ã›ã„ã‹ã„ï¼";
            msg.style.color = "#e91e63";
            document.getElementById('answer-area').classList.add('correct-anim');
            
            document.getElementById('check-btn').style.display = 'none';
            document.getElementById('next-area').style.display = 'block';
            document.getElementById('quit-btn').style.display = 'none'; 
        } else {
            msg.textContent = "âŒ ã‚ã‚Œã‚Œï¼Ÿ ã¡ã‚‡ã£ã¨ã¡ãŒã†ã‹ã‚‚";
            msg.style.color = "#555";
        }
    }

    function nextProblem() {
        document.getElementById('answer-area').classList.remove('correct-anim');
        currentProblemIndex++;
        loadProblem();
    }

</script>

</body>
</html>