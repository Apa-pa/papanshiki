<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åæ¢åµã±ã±ã‚“</title>
    <script src="ranking.js"></script>
    <style>
        body {
            font-family: "UD Digital Kyokasho-tai-R", sans-serif;
            background-color: #5d4037;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #333;
            touch-action: manipulation;
        }

        #game-container {
            width: 100%;
            max-width: 600px;
            background: #fff8e1;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            padding: 20px;
            box-sizing: border-box;
            position: relative;
            overflow: hidden;
            min-height: 100vh; 
            display: flex;
            flex-direction: column;
        }

        header {
            text-align: center;
            border-bottom: 2px dashed #8d6e63;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        h1 { margin: 0; color: #e65100; font-size: 28px; }
        .rule-box {
            background: #ffe0b2;
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
            margin-top: 10px;
            color: #5d4037;
            text-align: left;
        }

        .progress-bar {
            text-align: right;
            font-size: 14px;
            color: #8d6e63;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .suspect-list {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .suspect-row {
            display: flex;
            align-items: flex-start;
            background: white;
            padding: 10px;
            border-radius: 15px;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: transform 0.1s, border-color 0.1s;
        }
        .suspect-row:active { transform: scale(0.98); }
        .suspect-row.selected {
            border-color: #e65100;
            background-color: #fff3e0;
        }

        .icon-box {
            width: 70px;
            text-align: center;
            flex-shrink: 0;
        }
        .char-icon { font-size: 50px; display: block; }
        .char-name { font-size: 12px; font-weight: bold; color: #555; }

        .bubble {
            position: relative;
            background: #e1f5fe;
            border-radius: 15px;
            padding: 15px;
            margin-left: 15px;
            flex: 1;
            font-size: 16px;
            color: #01579b;
            font-weight: bold;
            line-height: 1.4;
        }
        .bubble::after {
            content: '';
            position: absolute;
            left: -10px; top: 20px;
            border-top: 10px solid transparent;
            border-bottom: 10px solid transparent;
            border-right: 10px solid #e1f5fe;
        }

        .footer-area {
            margin-top: 20px;
            text-align: center;
        }

        .btn {
            background: #e65100;
            color: white;
            border: none;
            padding: 15px 50px;
            font-size: 20px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px #bf360c;
            font-weight: bold;
            width: 100%;
            max-width: 300px;
        }
        .btn:active { transform: translateY(2px); box-shadow: none; }
        .btn:disabled { background: #ccc; box-shadow: none; cursor: not-allowed; }

        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(93, 64, 55, 0.98);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            text-align: center;
            color: white;
            padding: 20px;
            box-sizing: border-box;
        }
        
        .result-title { font-size: 40px; font-weight: bold; margin-bottom: 20px; }
        .correct-col { color: #00e676; }
        .wrong-col { color: #ff5252; }

        .explanation {
            background: white;
            color: #333;
            padding: 20px;
            border-radius: 10px;
            font-size: 16px;
            text-align: left;
            margin-bottom: 20px;
            line-height: 1.6;
            max-width: 100%;
            width: 100%;
            overflow-y: auto;
            max-height: 40vh;
        }

        .back-link {
            color: #ffcc80;
            text-decoration: underline;
            margin-top: 20px;
            display: inline-block;
        }
    </style>
</head>
<body>

<div id="game-container">
    <header>
        <h1>ğŸ•µï¸â€â™‚ï¸ åæ¢åµã±ã±ã‚“</h1>
        <div class="progress-bar">ã˜ã‘ã‚“ <span id="current-q">1</span> / 3</div>
        <div class="rule-box">
            <strong>ã€ã˜ã‘ã‚“ã€‘</strong> ãƒ—ãƒªãƒ³ã‚’ ãŸã¹ãŸã®ã¯ ã ã‚Œï¼Ÿ<br>
            <strong>ã€ãƒ«ãƒ¼ãƒ«ã€‘</strong> <span style="color:#d32f2f;">ã¯ã‚“ã«ã‚“ã¯ ã‚¦ã‚½ã‚’ã¤ãã€‚</span><br>
            ã¯ã‚“ã«ã‚“ ã˜ã‚ƒãªã‘ã‚Œã° ã»ã‚“ã¨ã†ã‚’ è¨€ã†ã‚ˆã€‚
        </div>
    </header>

    <div class="suspect-list" id="suspect-list">
        </div>

    <div class="footer-area">
        <p style="font-size:14px; color:#666;">ã¯ã‚“ã«ã‚“ã ã¨ ãŠã‚‚ã†äººã‚’ ã‚¿ãƒƒãƒ—ã—ã¦ã­</p>
        <button id="decide-btn" class="btn" onclick="checkAnswer()" disabled>ã“ã„ã¤ãŒ ã¯ã‚“ã«ã‚“ã ï¼</button>
    </div>

    <div id="result-screen" class="overlay" style="display:none;">
        <div id="result-icon" style="font-size: 80px;"></div>
        <div id="result-title" class="result-title"></div>
        
        <div class="explanation" id="explanation-text"></div>

        <button id="next-btn" class="btn" onclick="handleNext()">ã¤ãã®ã˜ã‘ã‚“ã¸</button>
    </div>

    <div id="finish-screen" class="overlay" style="display:none;">
        <h1 style="color:#ffcc80;">äº‹ä»¶è§£æ±ºï¼</h1>
        <div style="font-size: 80px; margin: 20px;">ğŸ•µï¸â€â™‚ï¸âœ¨</div>
        <p style="font-size:20px; line-height:1.8;">
            ã™ã¹ã¦ã® ãƒŠã‚¾ãŒ ã¨ã‘ãŸã­ï¼<br>ãã¿ã¯ åæ¢åµã ï¼
        </p>
        <button class="start-btn" 
            onclick="this.disabled=true; this.innerText='ã‚‚ã‚‰ã„ã¾ã—ãŸ'; this.style.background='#ccc'; if(typeof showPointGetDialog==='function'){showPointGetDialog(30)}else{alert('ranking.jsã‚’æ›´æ–°ã—ã¦ã­')}">
            ğŸ ãƒã‚¤ãƒ³ãƒˆã‚’ã‚‚ã‚‰ã†
        </button>
        <button class="btn" onclick="location.reload()">ã•ã„ã—ã‚‡ã‹ã‚‰ ã‚„ã‚‹</button>
        <br>
        <a href="index.html" class="back-link">ğŸ  ãƒ›ãƒ¼ãƒ ã¸</a>
    </div>

    <div id="start-screen" class="overlay">
        <div style="font-size:80px;">ğŸ®</div>
        <h1>åæ¢åµã±ã±ã‚“</h1>
        <p>ã€Œãƒ—ãƒªãƒ³ã‚’ãŸã¹ãŸ ã¯ã‚“ã«ã‚“ã€ã‚’ã•ãŒã›ï¼<br><br>ã¯ã‚“ã«ã‚“ã¯ 1äººã ã‘ã€‚<br>ã¯ã‚“ã«ã‚“ã¯ å¿…ãšã‚¦ã‚½ã‚’ã¤ãã‚ˆã€‚</p>
        <button class="btn" onclick="gameStart()">ã¡ã‚‡ã†ã•ã‚’ ã‹ã„ã—</button>
        <br>
        <a href="index.html" class="back-link">ğŸ  ãƒ›ãƒ¼ãƒ ã¸</a>
    </div>

</div>

<script>
    const chars = [
        { id: 'rabbit', name: 'ã‚¦ã‚µã‚®', icon: 'ğŸ°' },
        { id: 'bear', name: 'ã‚¯ãƒ', icon: 'ğŸ»' },
        { id: 'fox', name: 'ã‚­ãƒ„ãƒ', icon: 'ğŸ¦Š' }
    ];

    // å•é¡Œãƒ‡ãƒ¼ã‚¿ï¼šå…¨6å•
    const problems = [
        {
            // ãƒ‘ã‚¿ãƒ¼ãƒ³1: ã‚­ãƒ„ãƒçŠ¯äºº (è‡ªåˆ†ã˜ã‚ƒãªã„)
            culprit: 'fox', 
            statements: {
                rabbit: 'ã¼ãã¯ ãŸã¹ã¦ãªã„ã‚ˆã€‚',
                bear: 'ã‚¦ã‚µã‚®ãã‚“ã¯ ãŸã¹ã¦ãªã„ã­ã€‚',
                fox: 'ã‚¯ãƒãã‚“ãŒ ãŸã¹ãŸã‚“ã ï¼' 
            },
            explanation: `
                <strong>è§£èª¬ï¼š</strong><br>
                ã‚­ãƒ„ãƒãŒã¯ã‚“ã«ã‚“ã ã¨è€ƒãˆã‚‹ã¨ã€ã€Œã‚¯ãƒãŒãŸã¹ãŸã€ã¨ã„ã†ã‚¦ã‚½ã‚’ã¤ã„ã¦ã„ã‚‹ã“ã¨ã«ãªã‚‹ã­ã€‚<br>
                ã»ã‹ã®äºŒäººã¯ã€ŒãŸã¹ã¦ãªã„ã€ã¨æœ¬å½“ã®ã“ã¨ã‚’è¨€ã£ã¦ã„ã‚‹ã‹ã‚‰ã€ã¤ã˜ã¤ã¾ãŒåˆã†ã‚ˆã€‚
            `
        },
        {
            // ãƒ‘ã‚¿ãƒ¼ãƒ³2: ã‚¯ãƒçŠ¯äºº (åæŒ‡ã—)
            culprit: 'bear',
            statements: {
                rabbit: 'ã‚¯ãƒãã‚“ãŒ ãŸã¹ãŸã®ã‚’è¦‹ãŸã‚ˆã€‚',
                bear: 'ã¼ãã¯ ãŸã¹ã¦ãªã„ï¼',
                fox: 'ã‚¦ã‚µã‚®ãã‚“ã¯ ã‚¦ã‚½ã‚’ã¤ã„ã¦ãªã„ã‚ˆã€‚'
            },
            explanation: `
                <strong>è§£èª¬ï¼š</strong><br>
                ã‚­ãƒ„ãƒãŒã€Œã‚¦ã‚µã‚®ã¯æ­£ã—ã„ã€ã¨è¨€ã£ã¦ã„ã‚‹ã­ã€‚<br>
                ã‚‚ã—ã‚¦ã‚µã‚®ãŒã‚¦ã‚½ã¤ããªã‚‰ã€ã‚­ãƒ„ãƒã‚‚ã‚¦ã‚½ã¤ãã«ãªã£ã¦ã€ã¯ã‚“ã«ã‚“ãŒ2äººã«ãªã£ã¡ã‚ƒã†ã€‚<br>
                ã ã‹ã‚‰ã‚¦ã‚µã‚®ã®ã€Œã‚¯ãƒãŒãŸã¹ãŸã€ã¯æœ¬å½“ãªã‚“ã ã€‚
            `
        },
        {
            // ãƒ‘ã‚¿ãƒ¼ãƒ³3: ã‚¦ã‚µã‚®çŠ¯äºº (æ¶ˆå»æ³•)
            culprit: 'rabbit',
            statements: {
                rabbit: 'ã‚­ãƒ„ãƒãã‚“ãŒ ãŸã¹ãŸã‚“ã ã‚ˆã€‚',
                bear: 'ã‚­ãƒ„ãƒãã‚“ã¯ ãŸã¹ã¦ãªã„ã‚ˆã€‚',
                fox: 'ã¼ãã‚‚ ãŸã¹ã¦ãªã„ã‚ˆã€‚'
            },
            explanation: `
                <strong>è§£èª¬ï¼š</strong><br>
                ã‚¯ãƒã¨ ã‚­ãƒ„ãƒãŒã€Œã‚­ãƒ„ãƒã¯ãŸã¹ã¦ãªã„ã€ã¨è¨€ã£ã¦ã„ã‚‹ã­ã€‚<br>
                ã‚‚ã— ã‚¯ãƒã‹ã‚­ãƒ„ãƒãŒ ã¯ã‚“ã«ã‚“ã ã¨ã—ãŸã‚‰ã€æ­£ç›´è€…ãŒã‚¦ã‚½ã‚’è¨€ã£ã¦ã„ã‚‹ã“ã¨ã«ãªã£ã¦çŸ›ç›¾ã—ã¡ã‚ƒã†ã€‚<br>
                ã ã‹ã‚‰ã€ã‚¦ã‚½ã‚’ã¤ã„ã¦ã„ã‚‹ã‚¦ã‚µã‚®ãŒã¯ã‚“ã«ã‚“ã ï¼
            `
        },
        {
            // ãƒ‘ã‚¿ãƒ¼ãƒ³4 (è¿½åŠ ): ã‚­ãƒ„ãƒçŠ¯äºº (è¨¼è¨€ã®å¦å®š)
            culprit: 'fox',
            statements: {
                rabbit: 'ã‚­ãƒ„ãƒãã‚“ãŒ ã‚„ã£ãŸã‚“ã ã€‚',
                bear: 'ã‚¦ã‚µã‚®ãã‚“ã® è¨€ã†ã¨ãŠã‚Šã ã‚ˆã€‚',
                fox: 'ã‚¦ã‚µã‚®ãã‚“ã¯ ã‚¦ã‚½ã‚’ã¤ã„ã¦ã‚‹ï¼'
            },
            explanation: `
                <strong>è§£èª¬ï¼š</strong><br>
                ã‚¦ã‚µã‚®ã¨ã‚¯ãƒãŒã€äºŒäººã¨ã‚‚ã€Œã‚­ãƒ„ãƒãŒã¯ã‚“ã«ã‚“ã€ã¨è¨€ã£ã¦ã„ã‚‹ã‚ˆã†ãªã‚‚ã®ã ã­ã€‚<br>
                ã‚‚ã—ã‚­ãƒ„ãƒãŒã¯ã‚“ã«ã‚“ãªã‚‰ã€ã€Œã‚¦ã‚µã‚®ã¯ã‚¦ã‚½ã¤ãï¼ˆï¼ã‚­ãƒ„ãƒã¯ã‚„ã£ã¦ãªã„ï¼‰ã€ã¨ã„ã†ã‚¦ã‚½ã‚’ã¤ã„ã¦ã„ã‚‹ã“ã¨ã«ãªã‚‹ã‹ã‚‰ã€ãƒ”ãƒƒã‚¿ãƒªåˆã†ã­ï¼
            `
        },
        {
            // ãƒ‘ã‚¿ãƒ¼ãƒ³5 (è¿½åŠ ): ã‚¯ãƒçŠ¯äºº (ã‚¢ãƒªãƒã‚¤è¨¼è¨€)
            culprit: 'bear',
            statements: {
                rabbit: 'ã‚­ãƒ„ãƒãã‚“ã¯ ã‚„ã£ã¦ãªã„ã‚ˆã€‚',
                bear: 'ã‚¦ã‚µã‚®ãã‚“ãŒ ã‚„ã£ãŸã‚“ã ï¼',
                fox: 'ã‚¦ã‚µã‚®ãã‚“ã¯ ã‚„ã£ã¦ãªã„ã‚ˆã€‚'
            },
            explanation: `
                <strong>è§£èª¬ï¼š</strong><br>
                ã‚¦ã‚µã‚®ã¨ã‚­ãƒ„ãƒãŒã€ãŠãŸãŒã„ã‚’ã‹ã°ã£ã¦ã„ã‚‹ã­ã€‚<br>
                ã‚‚ã—ã‚¦ã‚µã‚®ãŒã¯ã‚“ã«ã‚“ãªã‚‰ã€ã‚­ãƒ„ãƒï¼ˆæ­£ç›´è€…ï¼‰ãŒã€Œã‚¦ã‚µã‚®ã¯ã‚„ã£ã¦ãªã„ã€ã¨ã‚¦ã‚½ã‚’è¨€ã†ã“ã¨ã«ãªã£ã¦ã—ã¾ã†ã€‚<br>
                ã ã‹ã‚‰ã€ã‚¦ã‚½ã‚’ã¤ã„ã¦ã„ã‚‹ã®ã¯ã‚¯ãƒã ï¼
            `
        },
        {
            // ãƒ‘ã‚¿ãƒ¼ãƒ³6 (è¿½åŠ ): ã‚¦ã‚µã‚®çŠ¯äºº (ã‚¦ã‚½ã¤ãå‘¼ã°ã‚ã‚Š)
            culprit: 'rabbit',
            statements: {
                rabbit: 'ã‚¯ãƒãã‚“ã¯ ã‚¦ã‚½ã‚’ã¤ã„ã¦ã„ã‚‹ï¼',
                bear: 'ã¼ãã¯ ã‚„ã£ã¦ãªã„ã‚ˆã€‚',
                fox: 'ã‚¦ã‚µã‚®ãã‚“ãŒ ãŸã¹ãŸã®ã‚’è¦‹ãŸã‚ˆã€‚'
            },
            explanation: `
                <strong>è§£èª¬ï¼š</strong><br>
                ã‚‚ã—ã‚¦ã‚µã‚®ãŒæ­£ã—ã„ï¼ˆçŠ¯äººã˜ã‚ƒãªã„ï¼‰ãªã‚‰ã€ã‚¯ãƒã¯ã‚¦ã‚½ã‚’ã¤ã„ã¦ã„ã‚‹ï¼ˆçŠ¯äººï¼‰ã“ã¨ã«ãªã‚‹ã­ã€‚<br>
                ã§ã‚‚ãã†ã™ã‚‹ã¨ã€ã‚­ãƒ„ãƒï¼ˆæ­£ç›´è€…ï¼‰ãŒã€Œã‚¦ã‚µã‚®ãŒãŸã¹ãŸã€ã¨ã‚¦ã‚½ã‚’è¨€ã†ã“ã¨ã«ãªã£ã¦ ãŠã‹ã—ããªã‚‹ã€‚<br>
                ã ã‹ã‚‰ã€ã‚¦ã‚µã‚®ãŒã¯ã‚“ã«ã‚“ã ï¼
            `
        }
    ];

    let currentProblemIndex = 0;
    let selectedSuspectId = null;
    let gameProblems = []; // ä»Šå›å‡ºé¡Œã™ã‚‹3å•

    function gameStart() {
        document.getElementById('start-screen').style.display = 'none';
        
        // å…¨å•é¡Œã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«3å•é¸ã¶å‡¦ç†
        // 1. ã¾ãšå…¨éƒ¨ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã™ã‚‹
        const shuffled = [...problems].sort(() => Math.random() - 0.5);
        // 2. å…ˆé ­ã®3ã¤ã ã‘ã‚’å–ã‚Šå‡ºã™
        gameProblems = shuffled.slice(0, 3);

        currentProblemIndex = 0;
        loadProblem();
    }

    function loadProblem() {
        document.getElementById('result-screen').style.display = 'none';
        selectedSuspectId = null;
        document.getElementById('decide-btn').disabled = true;
        
        // åˆ†æ¯ã¯ã€Œ3ã€å›ºå®šã§OK
        document.getElementById('current-q').textContent = currentProblemIndex + 1;

        const problem = gameProblems[currentProblemIndex];
        const listEl = document.getElementById('suspect-list');
        listEl.innerHTML = '';

        chars.forEach(char => {
            const row = document.createElement('div');
            row.className = 'suspect-row';
            row.onclick = () => selectSuspect(char.id, row);
            
            const iconBox = document.createElement('div');
            iconBox.className = 'icon-box';
            iconBox.innerHTML = `<span class="char-icon">${char.icon}</span><span class="char-name">${char.name}</span>`;
            
            const bubble = document.createElement('div');
            bubble.className = 'bubble';
            bubble.textContent = problem.statements[char.id];

            row.appendChild(iconBox);
            row.appendChild(bubble);
            listEl.appendChild(row);
        });
    }

    function selectSuspect(id, element) {
        selectedSuspectId = id;
        document.querySelectorAll('.suspect-row').forEach(el => el.classList.remove('selected'));
        element.classList.add('selected');
        document.getElementById('decide-btn').disabled = false;
    }

    function checkAnswer() {
        if (!selectedSuspectId) return;

        const problem = gameProblems[currentProblemIndex];
        const isCorrect = (selectedSuspectId === problem.culprit);
        
        const resultScreen = document.getElementById('result-screen');
        const icon = document.getElementById('result-icon');
        const title = document.getElementById('result-title');
        const text = document.getElementById('explanation-text');
        const nextBtn = document.getElementById('next-btn');

        resultScreen.style.display = 'flex';

        if (currentProblemIndex >= gameProblems.length - 1) {
            nextBtn.textContent = "ãœã‚“ã¶ãŠã‚ã‚Šï¼";
        } else {
            nextBtn.textContent = "ã¤ãã®ã˜ã‘ã‚“ã¸";
        }

        if (isCorrect) {
            icon.textContent = "ğŸ•µï¸â€â™‚ï¸âœ¨";
            title.textContent = "åæ¨ç†ï¼";
            title.className = "result-title correct-col";
            text.innerHTML = `<strong>æ­£è§£ï¼</strong><br>${problem.explanation}`;
            
            nextBtn.onclick = handleNext;
            nextBtn.style.display = 'block';

        } else {
            icon.textContent = "ğŸ’¦";
            title.textContent = "ã¡ãŒã†ã¿ãŸã„...";
            title.className = "result-title wrong-col";
            text.innerHTML = `ã–ã‚“ã­ã‚“ã€ãã®äººã¯ ã¯ã‚“ã«ã‚“ ã˜ã‚ƒãªã„ã‚ˆã€‚<br>ã‚‚ã†ã„ã¡ã© æ¨ç†ã—ã¦ã¿ã‚ˆã†ï¼<br><br>ãƒ’ãƒ³ãƒˆï¼šã¯ã‚“ã«ã‚“ã ã‘ãŒ ã‚¦ã‚½ã‚’ã¤ãã‚ˆã€‚`;
            
            nextBtn.textContent = "ã‚‚ã†ã„ã¡ã© è€ƒãˆã‚‹";
            nextBtn.onclick = () => {
                resultScreen.style.display = 'none';
            };
        }
    }

    function handleNext() {
        currentProblemIndex++;
        if (currentProblemIndex >= gameProblems.length) {
            document.getElementById('result-screen').style.display = 'none';
            document.getElementById('finish-screen').style.display = 'flex';
        } else {
            loadProblem();
        }
    }

</script>
</body>
</html>