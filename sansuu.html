<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Åï„Çì„Åô„ÅÜ„Çø„Ç§„É†„Ç¢„Çø„ÉÉ„ÇØÔºÅ</title>
    <script src="ranking.js"></script>
    <style>
        :root {
            --primary-bg: #e0f7fa;
            --card-bg: #ffffff;
            --accent-color: #ff4081;
        }

        body {
            font-family: "UD Digital Kyokasho-tai-R", "Hiragino Kaku Gothic ProN", sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%);
            touch-action: manipulation;
        }

        #game-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            text-align: center;
            width: 95%;
            max-width: 500px;
            position: relative; 
        }

        .hidden { display: none; }

        .main-title {
            font-size: 1.8rem;
            color: #444;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .sub-title {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 20px;
        }

        /* „Ç≥„Éº„ÇπÈÅ∏Êäû„Éú„Çø„É≥„ÅÆ„Ç®„É™„Ç¢ */
        .btn-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        button {
            padding: 15px;
            font-size: 1.1rem;
            cursor: pointer;
            border: none;
            border-radius: 50px;
            color: white;
            font-weight: bold;
            transition: transform 0.1s;
            box-shadow: 0 4px 0 rgba(0,0,0,0.15);
            width: 100%;
            font-family: inherit;
        }

        button:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 rgba(0,0,0,0.15);
        }

        /* ÂêÑ„Éú„Çø„É≥„ÅÆËâ≤ */
        .btn-add-easy { background: #4fc3f7; } /* Ê∞¥Ëâ≤ */
        .btn-add-hard { background: #2196f3; } /* Èùí */
        .btn-sub-easy { background: #ff8a65; } /* „Ç™„É¨„É≥„Ç∏ */
        .btn-sub-hard { background: #f44336; } /* Ëµ§ */
        .btn-multi    { background: #ffca28; color: #5d4037; } /* ÈªÑËâ≤ */
        
        .retry-btn { background: #66bb6a; margin-top: 10px; }

        .home-link {
            display: inline-block;
            margin-top: 25px;
            color: #78909c;
            text-decoration: none;
            font-size: 0.9rem;
            border-bottom: 1px solid #78909c;
        }

        /* „Ç≤„Éº„É†ÁîªÈù¢ */
        #progress { font-size: 1rem; color: #888; margin-bottom: 10px; display: inline-block; background: #eee; padding: 5px 15px; border-radius: 20px;}
        #question { font-size: 3.5rem; margin: 10px 0 30px 0; color: #333; font-weight: bold; letter-spacing: 2px;}
        
        .choice-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .choice-btn { 
            background-color: #fff; 
            color: #333; 
            border: 2px solid #ddd;
            font-size: 1.5rem;
            padding: 20px 0;
            border-radius: 15px;
        }
        .choice-btn:active { background-color: #eee; }

        /* ÁµêÊûúÁîªÈù¢ */
        #result-time { font-size: 3rem; color: #e91e63; margin: 15px 0; font-weight: bold;}

        /* Ê≠£Ëß£„Éû„Éº„ÇØ */
        #correct-mark {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 150px;
            color: #ff3d00;
            font-weight: bold;
            display: none;
            z-index: 100;
            pointer-events: none;
            text-shadow: 2px 2px 0px white;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="correct-mark">‚óé</div>

    <div id="start-screen">
        <div class="main-title">‚è±Ô∏è „Åï„Çì„Åô„ÅÜ<br>„Çø„Ç§„É†„Ç¢„Çø„ÉÉ„ÇØ</div>
        <div class="sub-title">10„ÇÇ„Çì „ÅØ„ÇÑ„Å®„ÅçÔºÅ „Ç≥„Éº„Çπ„Çí„Åà„Çâ„Çì„Åß„Å≠</div>
        
        <div class="btn-grid">
            <button class="btn-add-easy" onclick="startGame('add_easy')">„Åü„Åó„Åñ„Çì</button>
            <button class="btn-add-hard" onclick="startGame('add_hard')">„Åü„Åó„Åñ„Çì („Åè„Çä„ÅÇ„Åå„Çä)</button>
            <button class="btn-sub-easy" onclick="startGame('sub_easy')">„Å≤„Åç„Åñ„Çì</button>
            <button class="btn-sub-hard" onclick="startGame('sub_hard')">„Å≤„Åç„Åñ„Çì („Åè„Çä„Åï„Åå„Çä)</button>
            <button class="btn-multi"    onclick="startGame('multi')">„Åã„Åë„Åñ„Çì (‰πù‰πù)</button>
        </div>

        <a href="index.html" class="home-link">üè† „Éõ„Éº„É†„Å∏„ÇÇ„Å©„Çã</a>
    </div>

    <div id="quiz-screen" class="hidden">
        <span id="progress">1 / 10</span>
        <div id="question"></div>
        <div id="choices" class="choice-grid"></div>
    </div>

    <div id="result-screen" class="hidden">
        <div class="main-title">üö© „Ç¥„Éº„É´ÔºÅ</div>
        <p>„ÅÇ„Å™„Åü„ÅÆ„Çø„Ç§„É†</p>
        <div id="result-time">0.00Áßí</div>
        
        <button class="retry-btn" onclick="resetGame()">„ÇÇ„ÅÜ„ÅÑ„Å°„Å© „ÅÇ„Åù„Å∂</button>
        <br>
        <a href="index.html" class="home-link">üè† „Éõ„Éº„É†„Å∏„ÇÇ„Å©„Çã</a>
    </div>
</div>

<script>
    let currentQuestion = 0;
    let currentMode = ''; // ÁèæÂú®„ÅÆ„Ç≥„Éº„ÇπID
    let correctAnswer = 0;
    let startTime;
    const totalQuestions = 10;
    
    // „É©„É≥„Ç≠„É≥„Ç∞‰øùÂ≠òÁî®„ÅÆIDÂØæÂøúË°®
    const RANKING_IDS = {
        'add_easy': 'math_add_easy',
        'add_hard': 'math_add_hard',
        'sub_easy': 'math_sub_easy',
        'sub_hard': 'math_sub_hard',
        'multi':    'math_multi'
    };

    function startGame(mode) {
        currentMode = mode;
        currentQuestion = 1;
        startTime = Date.now();
        
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('result-screen').classList.add('hidden');
        document.getElementById('quiz-screen').classList.remove('hidden');
        
        nextQuestion();
    }

    function nextQuestion() {
        if (currentQuestion > totalQuestions) {
            endGame();
            return;
        }

        document.getElementById('progress').innerText = `„Å†„ÅÑ ${currentQuestion} / ${totalQuestions} „ÇÇ„Çì`;
        generateProblem();
    }

    // ÂïèÈ°å‰ΩúÊàê„É≠„Ç∏„ÉÉ„ÇØ
    function generateProblem() {
        let n1, n2, opSign;

        // „É©„É≥„ÉÄ„É†Êï¥Êï∞‰ΩúÊàê„Éò„É´„Éë„Éº (min„Åã„Çâmax„Åæ„Åß)
        const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

        switch (currentMode) {
            case 'add_easy': // „Åè„Çä„ÅÇ„Åå„Çä„Å™„Åó (Âíå„Åå9‰ª•‰∏ã)
                // ‰æã: 2+3, 4+5
                do {
                    n1 = rand(1, 8);
                    n2 = rand(1, 8);
                } while (n1 + n2 > 9); 
                correctAnswer = n1 + n2;
                opSign = '+';
                break;

            case 'add_hard': // „Åè„Çä„ÅÇ„Åå„Çä„ÅÇ„Çä (Âíå„Åå10‰ª•‰∏ä)
                // ‰æã: 6+7, 8+5
                do {
                    n1 = rand(2, 9);
                    n2 = rand(2, 9);
                } while (n1 + n2 < 10);
                correctAnswer = n1 + n2;
                opSign = '+';
                break;

            case 'sub_easy': // „Åè„Çä„Åï„Åå„Çä„Å™„Åó
                // ‰æã: 8-3, 9-5
                n1 = rand(2, 9);
                n2 = rand(1, n1 - 1); // Âºï„ÅèÊï∞„ÅØn1„Çà„ÇäÂ∞è„Åï„ÅÑ
                correctAnswer = n1 - n2;
                opSign = '-';
                break;

            case 'sub_hard': // „Åè„Çä„Åï„Åå„Çä„ÅÇ„Çä (11~18 „Åã„ÇâÂºï„Åè„ÄÅ„Åã„Å§1„ÅÆ‰Ωç„Çà„ÇäÂ§ß„Åç„ÅÑÊï∞„ÇíÂºï„Åè)
                // ‰æã: 13-5 (3 < 5 „Å™„ÅÆ„ÅßÁπ∞„Çä‰∏ã„Åå„ÇäÁô∫Áîü)
                do {
                    n1 = rand(11, 18); // 11„Åã„Çâ18
                    n2 = rand(2, 9);
                    // Á≠î„Åà„Åå1Ê°Å„Å´„Å™„Çã(9‰ª•‰∏ã) „Åã„Å§ 1„ÅÆ‰ΩçÂêåÂ£´„ÅßÂºï„Åë„Å™„ÅÑ
                } while ((n1 - n2) > 9 || (n1 % 10) >= n2);
                correctAnswer = n1 - n2;
                opSign = '-';
                break;

            case 'multi': // ‰πù‰πù
                n1 = rand(1, 9);
                n2 = rand(1, 9);
                correctAnswer = n1 * n2;
                opSign = '√ó';
                break;
        }

        document.getElementById('question').innerText = `${n1} ${opSign} ${n2}`;
        generateChoices(correctAnswer);
    }

    function generateChoices(correct) {
        const choicesDiv = document.getElementById('choices');
        choicesDiv.innerHTML = '';
        let choices = new Set([correct]);

        // „ÉÄ„Éü„Éº„ÅÆÈÅ∏ÊäûËÇ¢„Çí‰Ωú„Çã
        while(choices.size < 4) {
            // Ê≠£Ëß£„Å´Ëøë„ÅÑÊï∞Â≠ó„Çí„É©„É≥„ÉÄ„É†„Å´‰Ωú„Çã
            let diff = Math.floor(Math.random() * 10) - 5; // -5 „Äú +4
            let wrong = correct + diff;
            if (wrong >= 0 && !choices.has(wrong)) {
                choices.add(wrong);
            }
        }

        // „Ç∑„É£„ÉÉ„Éï„É´„Åó„Å¶„Éú„Çø„É≥ÈÖçÁΩÆ
        let choiceArray = Array.from(choices).sort(() => Math.random() - 0.5);

        choiceArray.forEach(val => {
            const btn = document.createElement('button');
            btn.className = 'choice-btn';
            btn.innerText = val;
            btn.onclick = () => checkAnswer(val);
            choicesDiv.appendChild(btn);
        });
    }

    function checkAnswer(selected) {
        if (selected === correctAnswer) {
            // Ê≠£Ëß£ÔºÅ
            const mark = document.getElementById('correct-mark');
            mark.style.display = 'block';

            setTimeout(() => {
                mark.style.display = 'none';
                currentQuestion++;
                nextQuestion();
            }, 200); // „ÉÜ„É≥„Éù„Çà„ÅèÊ¨°„Å∏
        } else {
            // ‰∏çÊ≠£Ëß£
            document.body.style.backgroundColor = "#ffcdd2"; // ËÉåÊôØ„Çí‰∏ÄÁû¨Ëµ§„Åè
            setTimeout(() => { document.body.style.backgroundColor = ""; }, 200);
        }
    }

    function endGame() {
        const duration = ((Date.now() - startTime) / 1000).toFixed(2);
        
        document.getElementById('quiz-screen').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');
        document.getElementById('result-time').innerText = `${duration}Áßí`;

        // ‚òÖ„É©„É≥„Ç≠„É≥„Ç∞‰øùÂ≠òÁîªÈù¢„ÇíÂëº„Å≥Âá∫„Åó
        const rankingId = RANKING_IDS[currentMode];
        if(typeof showSaveDialog === 'function' && rankingId) {
            showSaveDialog(rankingId, duration);
        }
    }

    function resetGame() {
        document.getElementById('result-screen').classList.add('hidden');
        document.getElementById('start-screen').classList.remove('hidden');
    }
</script>

</body>
</html>