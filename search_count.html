<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‹ããˆã¦ï¼ã•ãŒã—ã¦ï¼</title>
    <style>
        body {
            font-family: "UD Digital Kyokasho-tai-R", "Hiragino Kaku Gothic ProN", sans-serif;
            background-color: #e8eaf6; /* çŸ¥çš„ãªè–„ç´« */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            touch-action: manipulation;
        }

        #game-container {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 30px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            width: 95%;
            max-width: 600px;
        }

        .screen { display: none; }
        .active { display: block; }

        h1 { color: #3f51b5; font-size: 24px; margin: 10px 0; }

        /* ã‚³ãƒ¼ã‚¹é¸æŠãƒœã‚¿ãƒ³ */
        .course-btn {
            display: block;
            width: 100%;
            padding: 20px;
            margin: 15px 0;
            font-size: 22px;
            font-weight: bold;
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            box-shadow: 0 5px rgba(0,0,0,0.2);
            transition: transform 0.1s;
        }
        .course-btn:active { transform: scale(0.98); box-shadow: 0 2px rgba(0,0,0,0.2); }
        
        .btn-alpha { background: #ff7043; } /* ã‚ªãƒ¬ãƒ³ã‚¸ */
        .btn-kata { background: #42a5f5; }  /* é’ */
        .btn-emoji { background: #66bb6a; }  /* ç·‘ */

        /* ã‚²ãƒ¼ãƒ ç”»é¢ */
        .instruction {
            font-size: 20px;
            margin-bottom: 10px;
            color: #333;
        }
        .target-char {
            font-size: 40px;
            font-weight: bold;
            color: #e91e63;
            background: #fce4ec;
            padding: 0 10px;
            border-radius: 10px;
            margin: 0 5px;
        }

        /* æ–‡å­—ãŒæ•£ã‚‰ã°ã‚‹ã‚¨ãƒªã‚¢ */
        #field {
            background: #fff;
            border: 4px solid #c5cae9;
            border-radius: 20px;
            padding: 15px;
            min-height: 250px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .item {
            font-size: 36px;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none;
            cursor: default;
            border-radius: 50%; /* ã¾ã‚‹ãã™ã‚‹ */
            transition: background 0.3s;
        }
        /* æ­£è§£ç™ºè¡¨ç”¨ */
        .item.highlight {
            background-color: #ffccbc; /* æ­£è§£ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ */
            border: 2px solid #ff5722;
            font-weight: bold;
        }

        /* ã‚¿ã‚¤ãƒãƒ¼ãƒãƒ¼ */
        #timer-bar-container {
            width: 100%;
            height: 10px;
            background: #eee;
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        #timer-bar {
            width: 100%;
            height: 100%;
            background: #ffca28;
            transition: width 1s linear;
        }

        /* è§£ç­”ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰ */
        #keypad {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-top: 10px;
        }
        .key-btn {
            font-size: 24px;
            padding: 15px 0;
            background: #e3f2fd;
            border: 2px solid #90caf9;
            border-radius: 10px;
            color: #1565c0;
            font-weight: bold;
            cursor: pointer;
        }
        .key-btn:active { background: #bbdefb; }

        .back-btn {
            background: #90a4ae; font-size: 14px; padding: 8px 20px;
            color: white; border-radius: 20px; text-decoration: none;
            display: inline-block; margin-top: 20px;
        }

        /* çµæœè¡¨ç¤º */
        #result-msg { font-size: 28px; font-weight: bold; margin: 20px 0; }
        .correct { color: #f44336; }
        .wrong { color: #555; }
        
        #actual-count-display {
            font-size: 18px; color: #555; margin-bottom: 20px;
        }

    </style>
</head>
<body>

<div id="game-container">

    <div id="home-screen" class="screen active">
        <h1>ã‹ããˆã¦ï¼ã•ãŒã—ã¦ï¼</h1>
        <div style="font-size: 80px; margin: 20px;">ğŸ”</div>
        <p>ã«ã¦ã„ã‚‹æ–‡å­—ãŒã¾ã–ã£ã¦ã„ã‚‹ã‚ˆã€‚<br>ãŸã ã—ã„æ•°ã‚’ã‹ããˆã¦ã­ï¼</p>
        
        <button class="course-btn btn-alpha" onclick="startGame('alpha')">ğŸ”¤ ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆ</button>
        <button class="course-btn btn-kata" onclick="startGame('kata')">ğŸˆ‚ ã‚«ã‚¿ã‚«ãƒŠ</button>
        <button class="course-btn btn-emoji" onclick="startGame('emoji')">ğŸ¶ çµµæ–‡å­—</button>
        
        <a href="index.html" class="back-btn">ğŸ  ã‚‚ã©ã‚‹</a>
    </div>

    <div id="game-screen" class="screen">
        <div id="timer-bar-container"><div id="timer-bar"></div></div>
        
        <div class="instruction">
            <span id="target-display" class="target-char">G</span> ã®ã‹ãšã¯ï¼Ÿ
        </div>

        <div id="field">
            </div>

        <div id="keypad">
            <button class="key-btn" onclick="checkAnswer(1)">1</button>
            <button class="key-btn" onclick="checkAnswer(2)">2</button>
            <button class="key-btn" onclick="checkAnswer(3)">3</button>
            <button class="key-btn" onclick="checkAnswer(4)">4</button>
            <button class="key-btn" onclick="checkAnswer(5)">5</button>
            <button class="key-btn" onclick="checkAnswer(6)">6</button>
            <button class="key-btn" onclick="checkAnswer(7)">7</button>
            <button class="key-btn" onclick="checkAnswer(8)">8</button>
            <button class="key-btn" onclick="checkAnswer(9)">9</button>
            <button class="key-btn" onclick="checkAnswer(10)">10</button>
        </div>
        
        <a href="index.html" class="back-btn" onclick="location.reload()">ğŸ  ã‚„ã‚ã‚‹</a>
    </div>

    <div id="result-screen" class="screen">
        <div id="result-icon" style="font-size: 80px;"></div>
        <div id="result-msg"></div>
        
        <div id="actual-count-display">
            æ­£è§£ã¯ <strong>5</strong> ã“ ã§ã—ãŸ
        </div>

        <button class="course-btn" style="background:#4caf50;" onclick="restartGame()">ã¤ãã®ã‚‚ã‚“ã ã„</button>
        <br>
        <a href="index.html" class="back-btn" onclick="location.reload()">ğŸ  ãƒ›ãƒ¼ãƒ ã¸</a>
    </div>

</div>

<script>
    // å•é¡Œãƒ‡ãƒ¼ã‚¿ï¼ˆä¼¼ã¦ã„ã‚‹æ–‡å­—ã®ã‚»ãƒƒãƒˆï¼‰
    const problemSets = {
        alpha: [
            { target: 'G', distractors: ['C', 'O', 'Q'] },
            { target: 'E', distractors: ['F', 'L'] },
            { target: 'M', distractors: ['N', 'W'] },
            { target: 'B', distractors: ['8', 'D', 'P'] },
            { target: 'I', distractors: ['1', 'l', 'j'] },
            { target: 'R', distractors: ['P', 'B'] },
            { target: 'S', distractors: ['5', 'Z'] },
            { target: 'V', distractors: ['U', 'Y'] }
        ],
        kata: [
            { target: 'ã‚·', distractors: ['ãƒ„', 'ãƒ³', 'ã‚½'] },
            { target: 'ãƒ„', distractors: ['ã‚·', 'ãƒ³', 'ã‚½'] },
            { target: 'ãƒŒ', distractors: ['ã‚¹', 'åˆ'] },
            { target: 'ãƒ«', distractors: ['ãƒ¬', 'å‡ '] },
            { target: 'ã‚¦', distractors: ['ãƒ¯', 'ãƒ©'] },
            { target: 'ãƒ', distractors: ['ãƒ ', 'ã‚¢'] },
            { target: 'ã‚¯', distractors: ['ã‚±', 'ã‚¿'] },
            { target: 'ã‚³', distractors: ['ãƒ¦', 'ãƒ¨'] }
        ],
        emoji: [
            { target: 'ğŸ¶', distractors: ['ğŸ¦Š', 'ğŸ±', 'ğŸº'] },
            { target: 'ğŸ', distractors: ['ğŸ…', 'ğŸ’', 'ğŸ“'] },
            { target: 'âš½', distractors: ['âš¾', 'ğŸ€', 'ğŸ'] },
            { target: 'ğŸš—', distractors: ['ğŸš•', 'ğŸš™', 'ğŸšŒ'] },
            { target: 'ğŸ˜Š', distractors: ['ğŸ˜„', 'ğŸ˜‰', 'ğŸ˜Œ'] },
            { target: 'ğŸŒ™', distractors: ['ğŸŒ', 'ğŸ¥'] }
        ]
    };

    let currentCourse = 'alpha';
    let currentTarget = '';
    let correctCount = 0;
    let timeLimit = 15; // ç§’
    let timerInterval;

    function changeScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function startGame(course) {
        currentCourse = course;
        restartGame();
    }

    function restartGame() {
        // å•é¡Œã‚’ä½œæˆ
        generateProblem();
        
        // ã‚¿ã‚¤ãƒãƒ¼ãƒªã‚»ãƒƒãƒˆ
        document.getElementById('timer-bar').style.width = '100%';
        document.getElementById('timer-bar').style.transition = 'none';
        
        changeScreen('game-screen');
        
        // å°‘ã—å¾…ã£ã¦ã‹ã‚‰ã‚¿ã‚¤ãƒãƒ¼ã‚¹ã‚¿ãƒ¼ãƒˆ
        setTimeout(() => {
            document.getElementById('timer-bar').style.transition = `width ${timeLimit}s linear`;
            document.getElementById('timer-bar').style.width = '0%';
            
            // ã‚¿ã‚¤ãƒ ã‚ªãƒ¼ãƒãƒ¼å‡¦ç†
            clearTimeout(timerInterval);
            timerInterval = setTimeout(() => {
                timeUp();
            }, timeLimit * 1000);
        }, 100);
    }

    function generateProblem() {
        // ã‚³ãƒ¼ã‚¹ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«ã‚»ãƒƒãƒˆã‚’é¸ã¶
        const set = problemSets[currentCourse];
        const problem = set[Math.floor(Math.random() * set.length)];
        
        currentTarget = problem.target;
        document.getElementById('target-display').textContent = currentTarget;

        // æ­£è§£ã®æ•°ï¼ˆ1ã€œ10å€‹ï¼‰
        correctCount = Math.floor(Math.random() * 8) + 2; // 2ã€œ9å€‹ãã‚‰ã„ã«ã™ã‚‹
        
        // å…¨ä½“ã®ã‚¢ã‚¤ãƒ†ãƒ æ•°ï¼ˆæ­£è§£ + é–“é•ã„ï¼‰
        const totalItems = Math.floor(Math.random() * 8) + 12; // 12ã€œ20å€‹ãã‚‰ã„
        const distractorCount = totalItems - correctCount;

        // é…åˆ—ã‚’ä½œã‚‹
        let items = [];
        // æ­£è§£ã‚’å…¥ã‚Œã‚‹
        for(let i=0; i<correctCount; i++) {
            items.push({ char: currentTarget, isTarget: true });
        }
        // é–“é•ã„ã‚’å…¥ã‚Œã‚‹
        for(let i=0; i<distractorCount; i++) {
            const dist = problem.distractors[Math.floor(Math.random() * problem.distractors.length)];
            items.push({ char: dist, isTarget: false });
        }

        // ã‚·ãƒ£ãƒƒãƒ•ãƒ«
        items.sort(() => Math.random() - 0.5);

        // ç”»é¢ã«é…ç½®
        const field = document.getElementById('field');
        field.innerHTML = '';
        items.forEach(item => {
            const div = document.createElement('div');
            div.className = 'item';
            div.textContent = item.char;
            if(item.isTarget) {
                div.dataset.target = "true"; // å¾Œã§æ­£è§£è¡¨ç¤ºã«ä½¿ã†
            }
            field.appendChild(div);
        });
    }

    function checkAnswer(userNum) {
        clearTimeout(timerInterval); // ã‚¿ã‚¤ãƒãƒ¼ã¨ã‚ã‚‹
        showResult(userNum === correctCount);
    }

    function timeUp() {
        showResult(false, true); // æ™‚é–“åˆ‡ã‚Œ
    }

    function showResult(isCorrect, isTimeout = false) {
        changeScreen('result-screen');
        
        const icon = document.getElementById('result-icon');
        const msg = document.getElementById('result-msg');
        const info = document.getElementById('actual-count-display');

        if(isCorrect) {
            icon.textContent = "â­•";
            msg.textContent = "ã ã„ã›ã„ã‹ã„ï¼";
            msg.className = "correct";
        } else {
            icon.textContent = isTimeout ? "â°" : "âŒ";
            msg.textContent = isTimeout ? "ã˜ã‹ã‚“ãã‚Œ..." : "ãŠã—ã„ï¼";
            msg.className = "wrong";
        }

        info.innerHTML = `æ­£è§£ã¯ <span style="font-size:30px; color:#e91e63; font-weight:bold;">${correctCount}</span> ã“ ã§ã—ãŸ`;
        
        // èƒŒæ™¯ã§æ­£è§£ã®å ´æ‰€ã‚’å…‰ã‚‰ã›ã‚‹æ¼”å‡ºï¼ˆã‚²ãƒ¼ãƒ ç”»é¢ã‚’ä¸€ç¬è¦‹ã›ã‚‹ãªã©ï¼‰ã‚‚å¯èƒ½ã§ã™ãŒ
        // ä»Šå›ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«çµæœç”»é¢ã§æ­£è§£æ•°ã‚’ä¼ãˆã¾ã™
    }
</script>

</body>
</html>