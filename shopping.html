<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã´ã£ãŸã‚Šæ‰•ãŠã† | ãƒ”ãƒƒãƒ”å•†åº—</title>
    <script src="ranking.js"></script>
    <style>
        body {
            font-family: "UD Digital Kyokasho-tai-R", sans-serif;
            background-color: #fff8e1;
            text-align: center;
            padding: 20px;
            margin: 0;
            color: #5d4037;
            touch-action: manipulation;
            user-select: none;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        h1 {
            margin: 0 0 10px 0;
            color: #ff6f00;
            font-size: 24px;
        }

        /* åº—å“¡ã•ã‚“ã‚¨ãƒªã‚¢ */
        .shop-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 15px;
        }

        .pippi-img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 50%;
            border: 3px solid #ffca28;
            background: #fff;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .speech-bubble {
            position: relative;
            background: #ffecb3;
            border-radius: 10px;
            padding: 5px 15px;
            font-size: 14px;
            font-weight: bold;
            color: #ff6f00;
            margin-top: 5px;
        }

        .speech-bubble::after {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 0 10px 10px;
            border-style: solid;
            border-color: #ffecb3 transparent;
            display: block;
            width: 0;
        }

        /* ãƒ¬ãƒ™ãƒ«é¸æŠ */
        .level-select {
            margin-bottom: 20px;
        }

        .lvl-btn {
            background: #fff;
            border: 2px solid #ffca28;
            color: #ff6f00;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            margin: 0 3px;
            font-size: 12px;
        }

        .lvl-btn.active {
            background: #ffca28;
            color: #fff;
        }

        /* å•†å“è¡¨ç¤º */
        .target-display {
            background: #3e2723;
            color: #fff;
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
            box-shadow: inset 0 0 10px #000;
        }

        .target-icon {
            font-size: 40px;
        }

        .target-price {
            font-size: 32px;
            font-weight: bold;
            color: #ffeb3b;
            font-family: monospace;
        }

        /* ãƒˆãƒ¬ã‚¤ï¼ˆå‡ºã—ãŸãŠé‡‘ï¼‰ */
        .tray-area {
            background: #8d6e63;
            min-height: 120px;
            border-radius: 10px;
            border: 4px solid #5d4037;
            padding: 10px;
            margin-bottom: 10px;
            position: relative;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 5px;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.3);
        }

        .tray-label {
            position: absolute;
            top: 5px;
            left: 10px;
            font-size: 12px;
            color: #d7ccc8;
        }

        .tray-total {
            position: absolute;
            bottom: 5px;
            right: 10px;
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 8px;
            border-radius: 5px;
        }

        /* æ“ä½œãƒœã‚¿ãƒ³ */
        .action-area {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .act-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 30px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            color: white;
            box-shadow: 0 4px rgba(0, 0, 0, 0.2);
        }

        .btn-reset {
            background: #ef5350;
        }

        .btn-pay {
            background: #43a047;
        }

        .act-btn:active {
            transform: translateY(2px);
            box-shadow: none;
        }

        /* è²¡å¸ƒï¼ˆãŠé‡‘ãƒ‘ãƒ¬ãƒƒãƒˆï¼‰ */
        .wallet-area {
            background: #f5f5f5;
            border: 2px dashed #ccc;
            padding: 15px;
            border-radius: 15px;
        }

        .wallet-label {
            font-size: 12px;
            color: #888;
            margin-bottom: 10px;
            display: block;
        }

        .money-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }

        /* â–¼â–¼â–¼ CSSã§ãŠé‡‘ã‚’æç”» â–¼â–¼â–¼ */
        .money {
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-family: sans-serif;
            cursor: pointer;
            position: relative;
            transition: transform 0.1s;
            box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
            user-select: none;
            box-sizing: border-box;
            /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å«ã‚ãŸã‚µã‚¤ã‚ºè¨ˆç®— */
        }

        .money:active {
            transform: scale(0.95);
        }

        /* ç¡¬è²¨å…±é€š */
        .coin {
            border-radius: 50%;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        /* 1å†† */
        .m-1 {
            width: 36px;
            height: 36px;
            background: #e0e0e0;
            color: #555;
            font-size: 12px;
        }

        /* 5å†† (ç©´ã‚ããƒ»æ•°å­—ãšã‚‰ã—) */
        .m-5 {
            width: 38px;
            height: 38px;
            background: #fdd835;
            color: #5d4037;
            font-size: 12px;
            border: 1px solid #fbc02d;
            align-items: flex-start;
            /* æ•°å­—ã‚’ä¸Šã« */
            padding-top: 1px;
            /* ãšã‚‰ã™é‡ */
        }

        .m-5::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            background: #8d6e63;
            /* ãƒˆãƒ¬ã‚¤ã®è‰²ã«åˆã‚ã›ã‚‹ç°¡æ˜“çš„ãªç©´è¡¨ç¾ */
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            /* ã©çœŸã‚“ä¸­ */
        }

        /* 10å†† */
        .m-10 {
            width: 40px;
            height: 40px;
            background: #d87a48;
            color: #5d2807;
            font-size: 14px;
        }

        /* 50å†† (ç©´ã‚ããƒ»æ•°å­—ãšã‚‰ã—) */
        .m-50 {
            width: 38px;
            height: 38px;
            background: #fafafa;
            color: #555;
            font-size: 12px;
            border: 1px solid #ccc;
            align-items: flex-start;
            /* æ•°å­—ã‚’ä¸Šã« */
            padding-top: 1px;
            /* ãšã‚‰ã™é‡ */
        }

        .m-50::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            background: #8d6e63;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            /* ã©çœŸã‚“ä¸­ */
        }

        /* 100å†† */
        .m-100 {
            width: 42px;
            height: 42px;
            background: #f5f5f5;
            color: #333;
            font-size: 14px;
            border: 2px solid #ddd;
        }

        /* 500å†† */
        .m-500 {
            width: 46px;
            height: 46px;
            background: #e6c15c;
            color: #fff;
            text-shadow: 0 0 1px #886812;
            font-size: 16px;
            border: 2px solid #d4ac0d;
        }

        /* 1000å††æœ­ */
        .bill {
            width: 100px;
            height: 50px;
            border-radius: 4px;
            background: #e3f2fd;
            border: 1px solid #90caf9;
            color: #1565c0;
            font-size: 16px;
            letter-spacing: 1px;
        }

        .bill::before {
            content: 'ğŸ’´';
            position: absolute;
            left: 5px;
            font-size: 20px;
            opacity: 0.5;
        }

        .bill::after {
            content: '1000';
            position: absolute;
            right: 5px;
            bottom: 2px;
            font-size: 10px;
        }

        /* ãƒˆãƒ¬ã‚¤ã®ä¸­ã®ç©´ã®è‰²èª¿æ•´ï¼ˆèƒŒæ™¯ã«åˆã‚ã›ã‚‹ï¼‰ */
        .tray-area .m-5::after,
        .tray-area .m-50::after {
            background: #8d6e63;
        }

        .wallet-area .m-5::after,
        .wallet-area .m-50::after {
            background: #f5f5f5;
        }

        .progress {
            margin-top: 10px;
            font-size: 14px;
            color: #888;
        }

        .back-link {
            display: inline-block;
            margin-top: 30px;
            color: #ff6f00;
            text-decoration: underline;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>ğŸ›’ ãƒ”ãƒƒãƒ”å•†åº—</h1>

        <div class="shop-header">
            <img src="pippi192.webp" alt="ãã¾ã®ãƒ”ãƒƒãƒ”" class="pippi-img">
            <div class="speech-bubble" id="pippi-msg">ã´ã£ãŸã‚Š ã¯ã‚‰ãˆã‚‹ã‹ãªï¼Ÿ</div>
        </div>

        <div class="level-select">
            <button class="lvl-btn active" onclick="setLevel(1)">Lv1 (100å††ã¾ã§)</button>
            <button class="lvl-btn" onclick="setLevel(2)">Lv2 (1000å††ã¾ã§)</button>
            <button class="lvl-btn" onclick="setLevel(3)">Lv3 (ãŠã•ã¤)</button>
        </div>

        <div id="game-area">
            <div class="target-display">
                <span id="item-icon" class="target-icon">ğŸ</span>
                <div>
                    <div style="font-size:12px; text-align:left;">ã”ã†ã‘ã„</div>
                    <div class="target-price"><span id="target-val">0</span>å††</div>
                </div>
            </div>

            <div class="tray-area" id="tray">
                <div class="tray-label">ã“ã“ã«ãŠé‡‘ã‚’ã ã—ã¦ã­</div>
                <div class="tray-total">ã„ã¾ <span id="current-total">0</span>å††</div>
            </div>

            <div class="action-area">
                <button class="act-btn btn-reset" onclick="resetTray()">ã‚„ã‚ŠãªãŠã—</button>
                <button class="act-btn btn-pay" onclick="checkPayment()">ã¯ã„ã€ã©ã†ãï¼</button>
            </div>

            <div class="wallet-area">
                <span class="wallet-label">ã•ã„ãµ (ã‚¿ãƒƒãƒã—ã¦ã­)</span>
                <div class="money-grid" id="wallet-grid">
                </div>
            </div>

            <div class="progress"><span id="q-count">1</span> / 5 å•ç›®</div>
        </div>

        <div id="result-area" style="display:none;">
            <h2 style="font-size:60px; margin:20px 0;">ğŸ‰</h2>
            <p style="font-size:20px; font-weight:bold;">ãŠã‹ã„ã‚‚ã® ã˜ã‚‡ã†ãšï¼</p>
            <p style="font-size:24px; color:#e65100;">ã‚¿ã‚¤ãƒ : <span id="final-time">0</span>ç§’</p>
            <button onclick="location.reload()"
                style="padding:15px 30px; font-size:18px; background:#ffca28; border:none; border-radius:30px; font-weight:bold; cursor:pointer;">ã‚‚ã†ã„ã£ã‹ã„</button>
        </div>

        <br>
        <a href="index.html" class="back-link">ğŸ  ãƒ›ãƒ¼ãƒ ã¸ã‚‚ã©ã‚‹</a>
    </div>

    <script>
        const ITEMS = [
            { icon: 'ğŸ', name: 'ã‚Šã‚“ã”' }, { icon: 'ğŸŒ', name: 'ãƒãƒŠãƒŠ' }, { icon: 'ğŸ‡', name: 'ã¶ã©ã†' },
            { icon: 'ğŸ', name: 'ãƒ‘ãƒ³' }, { icon: 'ğŸ°', name: 'ã‚±ãƒ¼ã‚­' }, { icon: 'ğŸ¬', name: 'ã‚¢ãƒ¡' },
            { icon: 'ğŸ¦', name: 'ã‚¢ã‚¤ã‚¹' }, { icon: 'âœï¸', name: 'ãˆã‚“ã´ã¤' }, { icon: 'ğŸ““', name: 'ãƒãƒ¼ãƒˆ' },
            { icon: 'ğŸ§¸', name: 'ãã¾' }, { icon: 'ğŸ¤–', name: 'ãƒ­ãƒœ' }, { icon: 'ğŸ§¢', name: 'ã¼ã†ã—' }
        ];

        let currentLevel = 1;
        let questionCount = 0;
        const MAX_QUESTIONS = 5;
        let startTime = 0;
        let targetAmount = 0;
        let currentTrayTotal = 0;

        function setLevel(lv) {
            currentLevel = lv;
            document.querySelectorAll('.lvl-btn').forEach((b, i) => {
                b.className = (i + 1 === lv) ? 'lvl-btn active' : 'lvl-btn';
            });

            // ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦è²¡å¸ƒã®ä¸­èº«ã‚’å¤‰ãˆã‚‹
            updateWalletDisplay();
            document.getElementById('pippi-msg').innerText = "ãŒã‚“ã°ã£ã¦ã­ï¼";
            startGame();
        }

        function updateWalletDisplay() {
            const grid = document.getElementById('wallet-grid');
            grid.innerHTML = '';

            // Lv1: 1, 5, 10, 50, 100
            const coins = [100, 50, 10, 5, 1];
            if (currentLevel >= 2) coins.unshift(500); // Lv2+: 500å††è¿½åŠ 
            if (currentLevel >= 3) coins.unshift(1000); // Lv3: 1000å††è¿½åŠ 

            coins.forEach(val => {
                const el = createMoneyElement(val);
                // è²¡å¸ƒã®ä¸­ã®ã‚³ã‚¤ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ãƒˆãƒ¬ã‚¤ã«è¿½åŠ 
                el.onclick = () => addToTray(val);
                grid.appendChild(el);
            });
        }

        function createMoneyElement(val) {
            const div = document.createElement('div');
            div.innerText = val;

            if (val === 1000) {
                div.className = 'money bill';
            } else {
                div.className = `money coin m-${val}`;
            }
            return div;
        }

        function startGame() {
            questionCount = 0;
            document.getElementById('game-area').style.display = 'block';
            document.getElementById('result-area').style.display = 'none';
            startTime = Date.now();
            nextQuestion();
        }

        function nextQuestion() {
            if (questionCount >= MAX_QUESTIONS) {
                finishGame();
                return;
            }
            questionCount++;
            document.getElementById('q-count').innerText = questionCount;
            resetTray();

            // å•é¡Œç”Ÿæˆ
            const item = ITEMS[Math.floor(Math.random() * ITEMS.length)];
            document.getElementById('item-icon').innerText = item.icon;

            if (currentLevel === 1) {
                // 100å††æœªæº€ (10~99å††)
                targetAmount = Math.floor(Math.random() * 90) + 10;
            } else if (currentLevel === 2) {
                // 1000å††æœªæº€ (100~999å††)
                targetAmount = Math.floor(Math.random() * 900) + 100;
            } else {
                // 2000å††æœªæº€ (500~1999å††)
                targetAmount = Math.floor(Math.random() * 1500) + 500;
            }
            document.getElementById('target-val').innerText = targetAmount;
        }

        function addToTray(val) {
            // ãƒˆãƒ¬ã‚¤ã«è¿½åŠ 
            currentTrayTotal += val;
            document.getElementById('current-total').innerText = currentTrayTotal;

            const el = createMoneyElement(val);
            // ãƒˆãƒ¬ã‚¤ã®ã‚³ã‚¤ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨æ¶ˆã›ã‚‹ã‚ˆã†ã«ã™ã‚‹
            el.onclick = function () {
                this.remove();
                currentTrayTotal -= val;
                document.getElementById('current-total').innerText = currentTrayTotal;
            };

            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨
            el.style.transform = 'scale(0)';
            document.getElementById('tray').appendChild(el);
            setTimeout(() => el.style.transform = 'scale(1)', 10);
        }

        function resetTray() {
            currentTrayTotal = 0;
            document.getElementById('current-total').innerText = 0;
            // tray-label ã¨ tray-total ä»¥å¤–ã‚’å‰Šé™¤
            const tray = document.getElementById('tray');
            const items = tray.querySelectorAll('.money');
            items.forEach(i => i.remove());
        }

        function checkPayment() {
            if (currentTrayTotal === targetAmount) {
                document.getElementById('pippi-msg').innerText = "ã¡ã‚‡ã†ã©ã ã­ï¼ã‚ã‚ŠãŒã¨ã†ï¼";
                // playSound('correct');
                setTimeout(nextQuestion, 800);
            } else if (currentTrayTotal > targetAmount) {
                document.getElementById('pippi-msg').innerText = "ãŠãŠã„ã‚ˆï¼ ãŠã¤ã‚Šã¯ ãªã„ã‚ˆ";
                alert("ãŠãŠã„ã‚ˆï¼\nã´ã£ãŸã‚Š æ‰•ã£ã¦ã­ã€‚");
            } else {
                document.getElementById('pippi-msg').innerText = "ã‚ã‚Œï¼Ÿ ãŠé‡‘ãŒãŸã‚Šãªã„ã‚ˆ";
                alert("ãŠé‡‘ãŒ ãŸã‚Šãªã„ã‚ˆï¼");
            }
        }

        function finishGame() {
            const endTime = Date.now();
            const timeSec = ((endTime - startTime) / 1000).toFixed(1);

            document.getElementById('game-area').style.display = 'none';
            document.getElementById('result-area').style.display = 'block';
            document.getElementById('final-time').innerText = timeSec;
            document.getElementById('pippi-msg').innerText = "ã¾ã„ã©ã‚ã‚Šãƒ¼ï¼";

            if (typeof showSaveDialog === 'function') {
                showSaveDialog('shopping', timeSec);
            }
        }

        window.onload = function () {
            updateWalletDisplay(); // åˆæœŸè¡¨ç¤ºç”¨
            startGame();
        };
    </script>

</body>

</html>