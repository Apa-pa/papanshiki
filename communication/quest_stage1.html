<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒ‘ãƒ‘ã‚’èª¬å¾—ã—ã¦ã¿ã‚ˆã†ï¼ | ã‚³ã‚³ãƒ­ã®ã‚¯ã‚¨ã‚¹ãƒˆ</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
        }

        body {
            font-family: "UD Digital Kyokasho-tai-R", sans-serif;
            background: linear-gradient(135deg, #fff9c4 0%, #ffecb3 50%, #fff9c4 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 10px;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ï¼†ãƒ¡ãƒ¼ã‚¿ãƒ¼ */
        .header {
            flex-shrink: 0;
            margin-bottom: 10px;
        }

        .back-btn {
            display: inline-block;
            text-decoration: none;
            color: #888;
            font-size: 14px;
            background: white;
            padding: 6px 14px;
            border-radius: 20px;
            border: 2px solid #ddd;
            margin-bottom: 10px;
        }

        .meter-box {
            background: white;
            padding: 12px 15px;
            border-radius: 20px;
            border: 4px solid #ffb74d;
            box-shadow: 0 4px 0 #ff9800;
            text-align: center;
        }

        .meter-title {
            font-size: 15px;
            font-weight: bold;
            color: #e65100;
            margin-bottom: 8px;
        }

        .meter-bg {
            background: #eee;
            height: 24px;
            border-radius: 12px;
            overflow: hidden;
            border: inset 2px rgba(0, 0, 0, 0.1);
        }

        .meter-bar {
            height: 100%;
            width: 0%;
            background: #ff7043;
            transition: width 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), background-color 0.4s;
        }

        .meter-text {
            font-size: 14px;
            color: #555;
            margin-top: 5px;
            font-weight: bold;
        }

        /* ã‚²ãƒ¼ãƒ ç”»é¢ã‚¨ãƒªã‚¢ */
        .game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨ç¤º */
        .char-display {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            padding-bottom: 10px;
            min-height: 160px;
        }

        .char-img {
            max-height: 180px;
            object-fit: contain;
            animation: float 2.5s infinite ease-in-out;
            display: none;
            filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.15));
        }

        .emoji-avatar {
            font-size: 55px;
            width: 130px;
            height: 130px;
            background: #bbdefb;
            border: 6px solid #42a5f5;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
            line-height: 1;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            animation: popIn 0.3s ease-out;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes popIn {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒƒã‚¯ã‚¹ */
        .msg-box {
            background: white;
            border: 5px solid #ffb74d;
            border-radius: 20px;
            padding: 25px 20px 20px;
            position: relative;
            min-height: 130px;
            margin-bottom: 10px;
            box-shadow: 0 6px 0 rgba(0, 0, 0, 0.05);
        }

        .msg-name {
            position: absolute;
            top: -16px;
            left: 20px;
            background: #ff9800;
            color: white;
            padding: 4px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 15px;
            border: 3px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .msg-text {
            font-size: 19px;
            line-height: 1.6;
            color: #333;
            font-weight: bold;
        }

        ruby rt {
            font-size: 10px;
            color: #777;
            font-weight: normal;
        }

        /* é¸æŠè‚¢ãƒœã‚¿ãƒ³ */
        .options-box {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 15px;
            display: none;
        }

        .option-btn {
            background: white;
            border: 4px solid #64b5f6;
            padding: 16px;
            border-radius: 18px;
            font-size: 17px;
            font-weight: bold;
            color: #333;
            text-align: left;
            box-shadow: 0 5px 0 #42a5f5;
            cursor: pointer;
            line-height: 1.5;
            transition: transform 0.1s, box-shadow 0.1s;
        }

        .option-btn:active {
            transform: translateY(5px);
            box-shadow: none;
        }

        /* æ¬¡ã¸ãƒœã‚¿ãƒ³ */
        .next-btn {
            background: #ff9800;
            color: white;
            border: none;
            padding: 16px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 30px;
            width: 100%;
            cursor: pointer;
            box-shadow: 0 6px 0 #e65100;
            transition: 0.1s;
            display: none;
            margin-bottom: 20px;
        }

        .next-btn:active {
            transform: translateY(6px);
            box-shadow: none;
        }

        /* ãƒã‚¤ãƒ³ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .point-popup {
            position: absolute;
            font-size: 32px;
            font-weight: bold;
            color: #4CAF50;
            text-shadow: 2px 2px 0 white, -2px -2px 0 white, 2px -2px 0 white, -2px 2px 0 white;
            pointer-events: none;
            animation: floatUp 1s forwards ease-out;
            z-index: 100;
            left: 50%;
            top: 30%;
            transform: translateX(-50%);
        }

        .point-popup.negative {
            color: #f44336;
        }

        @keyframes floatUp {
            0% {
                transform: translate(-50%, 0) scale(0.5);
                opacity: 1;
            }

            50% {
                transform: translate(-50%, -30px) scale(1.2);
                opacity: 1;
            }

            100% {
                transform: translate(-50%, -60px) scale(1);
                opacity: 0;
            }
        }

        /* ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç”¨ */
        .ending-box {
            text-align: center;
            padding: 20px 10px;
            background: white;
            border-radius: 20px;
            border: 4px solid #ffb74d;
            box-shadow: 0 6px 0 rgba(0, 0, 0, 0.05);
            display: none;
            margin-top: 20px;
        }

        .ending-icon {
            font-size: 70px;
            margin-bottom: 15px;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .ending-title {
            font-size: 26px;
            color: #e65100;
            margin-bottom: 15px;
        }

        .ending-text {
            font-size: 18px;
            line-height: 1.6;
            font-weight: bold;
            margin-bottom: 25px;
        }
    </style>
</head>

<body>

    <div class="container">
        <div class="header">
            <a href="hub.html" class="back-btn">â† ã‚‚ã©ã‚‹</a>
            <div class="meter-box">
                <div class="meter-title">ãƒ‘ãƒ‘ã® <ruby>ç´å¾—åº¦<rt>ãªã£ã¨ãã©</rt></ruby>ãƒ¡ãƒ¼ã‚¿ãƒ¼</div>
                <div class="meter-bg">
                    <div class="meter-bar" id="meter-bar"></div>
                </div>
                <div class="meter-text" id="meter-text">0 / 100</div>
            </div>
        </div>

        <div class="game-area" id="game-area">
            <div class="char-display" id="char-display">
                <img src="../hi-192.webp" id="char-img" class="char-img" alt="ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼">
                <div id="char-icon" class="emoji-avatar">ğŸ‘¨â€ğŸ’¼</div>
            </div>

            <div class="msg-box" id="msg-box">
                <div class="msg-name" id="msg-name">ãƒ’ãƒ¼ã¡ã‚ƒã‚“</div>
                <div class="msg-text" id="msg-text">ãƒ†ã‚­ã‚¹ãƒˆ</div>
            </div>

            <div class="options-box" id="options-box"></div>

            <button class="next-btn" id="next-btn" onclick="nextStep()">æ¬¡ï¼ˆã¤ãï¼‰ã¸ â–¶</button>

            <div class="ending-box" id="ending-box">
                <div class="ending-icon" id="ending-icon">ğŸ‘¨â€ğŸ’¼âœ¨</div>
                <h2 class="ending-title" id="ending-title">ã‚¿ã‚¤ãƒˆãƒ«</h2>
                <div class="ending-text" id="ending-text">ãƒ†ã‚­ã‚¹ãƒˆ</div>

                <button class="next-btn" id="point-btn"
                    style="display:none; margin-top:10px; background:#4CAF50; box-shadow: 0 6px 0 #388E3C;"
                    onclick="getPoints()">ğŸ ãƒã‚¤ãƒ³ãƒˆã‚’ã‚‚ã‚‰ã†</button>

                <button class="next-btn" style="display:block; margin-top:15px;" onclick="location.reload()">ã‚‚ã†<ruby>ä¸€åº¦
                        <rt>ã„ã¡ã©</rt>
                    </ruby>ã‚ãã¶ â†»</button>
                <a href="hub.html" style="display:block; margin-top:20px; color:#888; text-decoration:none;">â†
                    ãƒãƒ–ã«<ruby>æˆ»<rt>ã‚‚ã©</rt></ruby>ã‚‹</a>
            </div>
        </div>
    </div>

    <script src="../ranking.js"></script>
    <script>
        const chars = {
            hi: { name: "ãƒ’ãƒ¼ã¡ã‚ƒã‚“", type: "img", src: "../hi-192.webp", color: "#ff9800", border: "#ffb74d" },
            an: { name: "ã‚¢ãƒ³ã¡ã‚ƒã‚“", type: "img", src: "../an192.webp", color: "#e91e63", border: "#f48fb1" },
            papa: { name: "ãƒ‘ãƒ‘", type: "emoji", src: "ğŸ‘¨â€ğŸ’¼", color: "#1976d2", border: "#64b5f6" }
        };

        const scenario = [
            {
                type: "msg", speaker: "hi",
                text: "ã©ã†ã—ã¦ã‚‚<ruby>æ–°<rt>ã‚ãŸã‚‰</rt></ruby>ã—ã„ã‚²ãƒ¼ãƒ ãŒã»ã—ã„ãªãâ€¦"
            },
            {
                type: "msg", speaker: "an",
                text: "ãƒ‘ãƒ‘ã«ãƒ—ãƒ¬ã‚¼ãƒ³ã—ã¦ã€<ruby>è²·<rt>ã‹</rt></ruby>ã£ã¦ã‚‚ã‚‰ãŠã†ï¼<br>ã€Œï¼°ï¼²ï¼¥ï¼°ï¼ˆãƒ—ãƒ¬ãƒƒãƒ—ï¼‰ã® ã¾ã»ã†ã€ã‚’ã¤ã‹ãˆã°ã€ãã£ã¨<ruby>ä¼<rt>ã¤ãŸ</rt></ruby>ã‚ã‚‹ã‚ï¼"
            },
            {
                type: "msg", speaker: "an",
                text: "ãŸã ã€Œã»ã—ã„ï¼ã€ã¨ã„ã†ã ã‘ã˜ã‚ƒãƒ€ãƒ¡ã€‚ã€Œã“ã‚Œã‚’<ruby>è²·<rt>ã‹</rt></ruby>ã†ã¨ ã©ã†<ruby>æˆé•·<rt>ã›ã„ã¡ã‚‡ã†</rt></ruby>ã§ãã‚‹ã‹ï¼ˆ<ruby>æŠ•è³‡<rt>ã¨ã†ã—</rt></ruby>ï¼‰ã€ã‚’ <ruby>è€ƒ<rt>ã‹ã‚“ãŒ</rt></ruby>ãˆã‚‹ã®ã‚ˆï¼"
            },
            {
                type: "msg", speaker: "papa",
                text: "ã‚“ï¼Ÿã‚²ãƒ¼ãƒ ãŒ<ruby>æ¬²<rt>ã»</rt></ruby>ã—ã„ã£ã¦ï¼Ÿ<br>ãªã‚“ã§ã‚²ãƒ¼ãƒ ãªã‚“ã¦<ruby>å¿…è¦<rt>ã²ã¤ã‚ˆã†</rt></ruby>ãªã‚“ã ï¼Ÿ"
            },
            // --- 1. çµè«– (P) ---
            {
                type: "question", speaker: "an",
                text: "ã¾ãšã¯ã€ï¼°ï¼ˆ<ruby>çµè«–<rt>ã‘ã¤ã‚ã‚“</rt></ruby>ï¼‰ã‹ã‚‰ï¼<br>ã¯ã£ãã‚Šã¨ã€Œã©ã†ã—ã¦ã»ã—ã„ã‹ã€ã‚’ <ruby>ä¼<rt>ã¤ãŸ</rt></ruby>ãˆã‚‹ã®ã‚ˆï¼",
                options: [
                    { text: "ã©ã†ã—ã¦ã‚‚ã»ã—ã„ã‹ã‚‰<ruby>è²·<rt>ã‹</rt></ruby>ã£ã¦ï¼", score: -10, response_speaker: "papa", response_text: "ãã‚Œã˜ã‚ƒã‚ã€ãŸã ã®ãƒ¯ã‚¬ãƒãƒã˜ã‚ƒãªã„ã‹ã€‚" },
                    { text: "ã‚²ãƒ¼ãƒ ã‚’<ruby>è²·<rt>ã‹</rt></ruby>ã£ã¦ãã ã•ã„ï¼", score: 10, response_speaker: "papa", response_text: "ã†ã‚€ã€ã¯ã£ãã‚Š<ruby>è¨€<rt>ã„</rt></ruby>ãˆãŸãªã€‚ã§ã‚‚ã€ãã‚Œã ã‘ã˜ã‚ƒã¾ã <ruby>åˆ†<rt>ã‚</rt></ruby>ã‹ã‚‰ã‚“ãªã€‚" },
                    { text: "ã‚²ãƒ¼ãƒ ã‚’<ruby>è²·<rt>ã‹</rt></ruby>ã£ã¦ãã ã•ã„ï¼ãªãœãªã‚‰ã€<ruby>åƒ•<rt>ã¼ã</rt></ruby>ã®<ruby>æˆé•·<rt>ã›ã„ã¡ã‚‡ã†</rt></ruby>ã«<ruby>å½¹ç«‹<rt>ã‚„ãã </rt></ruby>ã¤ã‹ã‚‰ã§ã™ï¼", score: 20, response_speaker: "papa", response_text: "ã»ã†ï¼ã‚²ãƒ¼ãƒ ãŒ<ruby>æˆé•·<rt>ã›ã„ã¡ã‚‡ã†</rt></ruby>ã«<ruby>å½¹ç«‹<rt>ã‚„ãã </rt></ruby>ã¤ï¼Ÿ<ruby>é¢ç™½<rt>ãŠã‚‚ã—ã‚</rt></ruby>ã„ã“ã¨ã‚’<ruby>è¨€<rt>ã„</rt></ruby>ã†ãªã€‚" }
                ]
            },
            // --- 2. ç†ç”± (R) ---
            {
                type: "msg", speaker: "an",
                text: "æ¬¡ï¼ˆã¤ãï¼‰ã¯ã€ï¼²ï¼ˆ<ruby>ç†ç”±<rt>ã‚Šã‚†ã†</rt></ruby>ï¼‰ã‚ˆã€‚<br>ã€Œãªãœãã†<ruby>æ€<rt>ãŠã‚‚</rt></ruby>ã†ã®ã‹ã€ã‚’ã—ã£ã‹ã‚Š<ruby>èª¬æ˜<rt>ã›ã¤ã‚ã„</rt></ruby>ã—ã¦ã­ï¼"
            },
            {
                type: "question", speaker: "hi",
                text: "ï¼ˆã©ã†ã‚„ã£ã¦<ruby>ç†ç”±<rt>ã‚Šã‚†ã†</rt></ruby>ã‚’ <ruby>ä¼<rt>ã¤ãŸ</rt></ruby>ãˆã‚ˆã†ã‹ãªâ€¦ï¼‰",
                options: [
                    { text: "ã ã£ã¦ã€ã¿ã‚“ãª<ruby>æŒ<rt>ã‚‚</rt></ruby>ã£ã¦ã‚‹ã‹ã‚‰â€¦<ruby>ä»²é–“å¤–<rt>ãªã‹ã¾ã¯ãš</rt></ruby>ã‚Œã«ã•ã‚Œã‚‹ã—â€¦", score: 0, response_speaker: "papa", response_text: "ãªã‚‹ã»ã©ãªã€‚<ruby>å‹é”<rt>ã¨ã‚‚ã ã¡</rt></ruby>ã¨<ruby>éŠ<rt>ã‚ã</rt></ruby>ã¹ãªã„ã®ã¯è¾›ã„ãªã€‚ã§ã‚‚ã€ãã‚Œã ã‘ã§ã¯ã¾ã å¼±ï¼ˆã‚ˆã‚ï¼‰ã„ãªã€‚" },
                    { text: "ã“ã®ã‚²ãƒ¼ãƒ ã¯ã€<ruby>é ­<rt>ã‚ãŸã¾</rt></ruby>ã‚’ã¤ã‹ã£ã¦ãƒ‘ã‚ºãƒ«ã‚’<ruby>è§£<rt>ã¨</rt></ruby>ãã‹ã‚‰ã§ã™ï¼", score: 10, response_speaker: "papa", response_text: "ãªã‚‹ã»ã©ã€ãŸã <ruby>éŠ<rt>ã‚ã</rt></ruby>ã¶ã ã‘ã˜ã‚ƒãªãã¦ã€ãƒ‘ã‚ºãƒ«ã§<ruby>é ­<rt>ã‚ãŸã¾</rt></ruby>ã‚’<ruby>ä½¿<rt>ã¤ã‹</rt></ruby>ã†ã‚“ã ãªã€‚" },
                    { text: "<ruby>é ­<rt>ã‚ãŸã¾</rt></ruby>ã‚’ã¤ã‹ã†ãƒãƒ¼ãƒ <ruby>æˆ¦<rt>ã›ã‚“</rt></ruby>ãªã®ã§ã€<ruby>è€ƒ<rt>ã‹ã‚“ãŒ</rt></ruby>ãˆã‚‹<ruby>åŠ›<rt>ã¡ã‹ã‚‰</rt></ruby>ã¨<ruby>å”åŠ›<rt>ãã‚‡ã†ã‚Šã‚‡ã</rt></ruby>ã™ã‚‹<ruby>åŠ›<rt>ã¡ã‹ã‚‰</rt></ruby>ãŒ<ruby>èº«<rt>ã¿</rt></ruby>ã«ã¤ãã‹ã‚‰ã§ã™ï¼", score: 20, response_speaker: "papa", response_text: "ãŠãŠï¼<ruby>æ€è€ƒåŠ›<rt>ã—ã“ã†ã‚Šã‚‡ã</rt></ruby>ã¨<ruby>å”èª¿æ€§<rt>ãã‚‡ã†ã¡ã‚‡ã†ã›ã„</rt></ruby>ã‹ã€‚<ruby>ç¢º<rt>ãŸã—</rt></ruby>ã‹ã«ãã‚Œã¯ã„ã„ãªã€‚" }
                ]
            },
            // --- 3. å…·ä½“ä¾‹ (E) ---
            {
                type: "msg", speaker: "papa",
                text: "ãµã‚€ãµã‚€ã€‚ã§ã‚‚ã€ã‚²ãƒ¼ãƒ ã°ã‹ã‚Šã—ã¦<ruby>å‹‰å¼·<rt>ã¹ã‚“ãã‚‡ã†</rt></ruby>ã—ãªããªã‚‹ã‚“ã˜ã‚ƒãªã„ã‹ï¼Ÿ"
            },
            {
                type: "msg", speaker: "an",
                text: "ã“ã“ãŒ<ruby>ä¸€ç•ª<rt>ã„ã¡ã°ã‚“</rt></ruby>ã®ãƒã‚¤ãƒ³ãƒˆï¼ï¼¥ï¼ˆ<ruby>å…·ä½“ä¾‹<rt>ããŸã„ã‚Œã„</rt></ruby>ï¼‰ã‚ˆã€‚<br>ãƒ‘ãƒ‘ã®<ruby>å¿ƒé…<rt>ã—ã‚“ã±ã„</rt></ruby>ã‚’ãªãã™ã‚ˆã†ãªã€ãƒ«ãƒ¼ãƒ«ã‚„<ruby>ä¾‹<rt>ã‚Œã„</rt></ruby>ã‚’<ruby>ææ¡ˆ<rt>ã¦ã„ã‚ã‚“</rt></ruby>ã—ã¦ï¼"
            },
            {
                type: "question", speaker: "hi",
                text: "ï¼ˆãƒ‘ãƒ‘ã‚’<ruby>å®‰å¿ƒ<rt>ã‚ã‚“ã—ã‚“</rt></ruby>ã•ã›ã‚‹ ãƒ«ãƒ¼ãƒ«ã‚’<ruby>è¨€<rt>ã„</rt></ruby>ãŠã†ï¼ï¼‰",
                options: [
                    { text: "<ruby>å¤§ä¸ˆå¤«<rt>ã ã„ã˜ã‚‡ã†ã¶</rt></ruby>ï¼<ruby>å‹‰å¼·<rt>ã¹ã‚“ãã‚‡ã†</rt></ruby>ã¯ã‚ã¨ã§<ruby>çµ¶å¯¾<rt>ãœã£ãŸã„</rt></ruby>ã‚„ã‚‹ã‹ã‚‰ï¼ï¼", score: -10, response_speaker: "papa", response_text: "ã€Œã‚ã¨ã§ã‚„ã‚‹ã€ã¯ã€ã„ã¤ã‚‚ã‚„ã‚‰ãªã„ã‚„ã¤ã®<ruby>å°è©<rt>ã›ã‚Šãµ</rt></ruby>ã ãã€‚" },
                    { text: "ï¼‘<ruby>æ—¥<rt>ã«ã¡</rt></ruby>ï¼‘<ruby>æ™‚é–“<rt>ã˜ã‹ã‚“</rt></ruby>ã ã‘ã«ã™ã‚‹ã£ã¦<ruby>ç´„æŸ<rt>ã‚„ããã</rt></ruby>ã™ã‚‹ã‚ˆï¼", score: 10, response_speaker: "papa", response_text: "ï¼‘<ruby>æ™‚é–“<rt>ã˜ã‹ã‚“</rt></ruby>ã ãªï¼Ÿ ã¡ã‚ƒã‚“ã¨<ruby>å®ˆ<rt>ã¾ã‚‚</rt></ruby>ã‚Œã‚‹ãªã‚‰ã„ã„ã‚“ã ãŒâ€¦" },
                    { text: "<ruby>å®¿é¡Œ<rt>ã—ã‚…ãã ã„</rt></ruby>ãŒ<ruby>çµ‚<rt>ãŠ</rt></ruby>ã‚ã£ãŸã‚ã¨ã ã‘ã‚„ã‚Šã¾ã™ã€‚<ruby>è‡ªåˆ†<rt>ã˜ã¶ã‚“</rt></ruby>ã§<ruby>æ±º<rt>ã</rt></ruby>ã‚ãŸãƒ«ãƒ¼ãƒ«ã‚’<ruby>å®ˆ<rt>ã¾ã‚‚</rt></ruby>ã‚‹<ruby>ç·´ç¿’<rt>ã‚Œã‚“ã—ã‚…ã†</rt></ruby>ã«ã‚‚ãªã‚Šã¾ã™ï¼", score: 20, response_speaker: "papa", response_text: "<ruby>è‡ªåˆ†<rt>ã˜ã¶ã‚“</rt></ruby>ã§ãƒ«ãƒ¼ãƒ«ã‚’<ruby>ä½œ<rt>ã¤ã</rt></ruby>ã£ã¦<ruby>å®ˆ<rt>ã¾ã‚‚</rt></ruby>ã‚‹ã®ã‹ã€‚ãã‚Œã¯<ruby>ç«‹æ´¾<rt>ã‚Šã£ã±</rt></ruby>ãª<ruby>æˆé•·<rt>ã›ã„ã¡ã‚‡ã†</rt></ruby>ã®ãƒãƒ£ãƒ³ã‚¹ã ãªï¼" }
                ]
            },
            // --- 4. æŠ•è³‡ãƒã‚¤ãƒ³ãƒ‰ (Investment) ---
            {
                type: "msg", speaker: "papa",
                text: "ãªã‚‹ã»ã©ã€‚ã ãŒã€ã‚²ãƒ¼ãƒ <ruby>ä»¥å¤–<rt>ã„ãŒã„</rt></ruby>ã§ã‚‚<ruby>æˆé•·<rt>ã›ã„ã¡ã‚‡ã†</rt></ruby>ã§ãã‚‹ã˜ã‚ƒãªã„ã‹ï¼Ÿ"
            },
            {
                type: "msg", speaker: "an",
                text: "ã‚‚ã†<ruby>ä¸€<rt>ã²ã¨</rt></ruby>ã¤ã€Œ<ruby>æŠ•è³‡<rt>ã¨ã†ã—</rt></ruby>ã€ã®<ruby>è€ƒ<rt>ã‹ã‚“ãŒ</rt></ruby>ãˆ<ruby>æ–¹<rt>ã‹ãŸ</rt></ruby>ã‚’<ruby>è¿½åŠ <rt>ã¤ã„ã‹</rt></ruby>ã—ã‚ˆã†ï¼<br><ruby>è²·<rt>ã‹</rt></ruby>ã£ã¦ã‚‚ã‚‰ã£ãŸ<ruby>åˆ†<rt>ã¶ã‚“</rt></ruby>ã€ã©ã‚“ãªã€ŒãŠ<ruby>è¿”<rt>ã‹ãˆ</rt></ruby>ã—ã€ãŒã§ãã‚‹ã‹<ruby>ä¼<rt>ã¤ãŸ</rt></ruby>ãˆã‚‹ã®ã‚ˆï¼"
            },
            {
                type: "question", speaker: "hi",
                text: "ï¼ˆ<ruby>æŠ•è³‡<rt>ã¨ã†ã—</rt></ruby>ã—ã¦ã‚‚ã‚‰ã£ã¦ã€ã©ã‚“ãª ãŠ<ruby>è¿”<rt>ã‹ãˆ</rt></ruby>ã—ãŒã§ãã‚‹ã‹ãªï¼Ÿï¼‰",
                options: [
                    { text: "ãŠ<ruby>è¿”<rt>ã‹ãˆ</rt></ruby>ã—ãªã‚“ã¦ãªã„ã‚ˆï¼ãŸã <ruby>éŠ<rt>ã‚ã</rt></ruby>ã³ãŸã„ã ã‘ï¼", score: -10, response_speaker: "papa", response_text: "ãã‚Œã§ã¯ã€Œ<ruby>æŠ•è³‡<rt>ã¨ã†ã—</rt></ruby>ã€ã§ã¯ãªãã€ãŸã ã®ã€Œ<ruby>ç„¡é§„é£<rt>ã‚€ã ã¥ã‹</rt></ruby>ã„ã€ã ãªã€‚" },
                    { text: "ã‚²ãƒ¼ãƒ ã‚’<ruby>è²·<rt>ã‹</rt></ruby>ã£ã¦ãã‚ŒãŸã‚‰ã€ãŠ<ruby>ä»•äº‹<rt>ã—ã”ã¨</rt></ruby>ã®<ruby>è‚©<rt>ã‹ãŸ</rt></ruby>ãŸãŸãã‚’ã™ã‚‹ã‚ˆï¼", score: 10, response_speaker: "papa", response_text: "<ruby>å„ª<rt>ã‚„ã•</rt></ruby>ã—ã„ãªã€‚ã ãŒã€ãã‚Œã¯ã€ŒãŠ<ruby>æ‰‹ä¼<rt>ã¦ã¤ã </rt></ruby>ã„ã® ã”<ruby>è¤’ç¾<rt>ã»ã†ã³</rt></ruby>ã€ã ãªã€‚" },
                    { text: "ã‚²ãƒ¼ãƒ ã§<ruby>å­¦<rt>ã¾ãª</rt></ruby>ã‚“ã ã€<ruby>è€ƒ<rt>ã‹ã‚“ãŒ</rt></ruby>ãˆã‚‹<ruby>åŠ›<rt>ã¡ã‹ã‚‰</rt></ruby>ã€ã‚’<ruby>ä½¿<rt>ã¤ã‹</rt></ruby>ã£ã¦ã€<ruby>å°†æ¥<rt>ã—ã‚‡ã†ã‚‰ã„</rt></ruby>ãƒ‘ãƒ‘ã®ãŠ<ruby>ä»•äº‹<rt>ã—ã”ã¨</rt></ruby>ã‚’<ruby>åŠ©<rt>ãŸã™</rt></ruby>ã‘ã‚‹ã‹ã‚‰ã€<ruby>æŠ•è³‡<rt>ã¨ã†ã—</rt></ruby>ã ã¨<ruby>æ€<rt>ãŠã‚‚</rt></ruby>ã£ã¦<ruby>è²·<rt>ã‹</rt></ruby>ã£ã¦ï¼", score: 20, response_speaker: "papa", response_text: "ãƒãƒƒãƒãƒƒãƒï¼<ruby>å°†æ¥<rt>ã—ã‚‡ã†ã‚‰ã„</rt></ruby>ã®<ruby>æˆ¦åŠ›<rt>ã›ã‚“ã‚Šã‚‡ã</rt></ruby>ã«ãªã‚‹ãªã‚‰ã€ã„ã„ã€Œ<ruby>æŠ•è³‡<rt>ã¨ã†ã—</rt></ruby>ã€ã«ãªã‚Šãã†ã ãªï¼" }
                ]
            },
            // --- 5. çµè«–ã®ã¾ã¨ã‚ (P) ---
            {
                type: "msg", speaker: "papa",
                text: "ã¡ã‚ƒã‚“ã¨<ruby>æ·±<rt>ãµã‹</rt></ruby>ã<ruby>è€ƒ<rt>ã‹ã‚“ãŒ</rt></ruby>ãˆã¦ã‚‹ã‚“ã ãªã€‚"
            },
            {
                type: "msg", speaker: "an",
                text: "ã„ã‚ˆã„ã‚ˆ<ruby>æœ€å¾Œ<rt>ã•ã„ã”</rt></ruby>ã®<ruby>ä»•ä¸Š<rt>ã—ã‚</rt></ruby>ã’ï¼ï¼°ï¼ˆã¾ã¨ã‚ã®<ruby>çµè«–<rt>ã‘ã¤ã‚ã‚“</rt></ruby>ï¼‰ã‚ˆã€‚<br>ã‚‚ã†<ruby>ä¸€åº¦<rt>ã„ã¡ã©</rt></ruby>ã€<ruby>å…ƒæ°—<rt>ã’ã‚“ã</rt></ruby>ã«ã€Œã©ã†ã—ã¦ã»ã—ã„ã‹ã€ã‚’<ruby>ä¼<rt>ã¤ãŸ</rt></ruby>ãˆã¦ï¼"
            },
            {
                type: "question", speaker: "hi",
                text: "ï¼ˆã‚ˆã—ã€<ruby>æœ€å¾Œ<rt>ã•ã„ã”</rt></ruby>ã®ã²ã¨ãŠã—ï¼ï¼‰",
                options: [
                    { text: "ã ã‹ã‚‰<ruby>æ—©<rt>ã¯ã‚„</rt></ruby>ã<ruby>è²·<rt>ã‹</rt></ruby>ã£ã¦ã‚ˆãƒ¼ï¼", score: -10, response_speaker: "papa", response_text: "ã†ãƒ¼ã‚“ã€ã›ã£ã‹ãã„ã„ã“ã¨ã‚’<ruby>è¨€<rt>ã„</rt></ruby>ã£ã¦ãŸã®ã«<ruby>æ®‹å¿µ<rt>ã–ã‚“ã­ã‚“</rt></ruby>ã ã€‚" },
                    { text: "ã ã‹ã‚‰ã€ã‚²ãƒ¼ãƒ ã‚’<ruby>è²·<rt>ã‹</rt></ruby>ã£ã¦ãã ã•ã„ï¼", score: 10, response_speaker: "papa", response_text: "ã†ã‚“ã€ã‚ã‹ã£ãŸã€‚ã¡ã‚ƒã‚“ã¨<ruby>ä¼<rt>ã¤ãŸ</rt></ruby>ã‚ã£ãŸã‚ˆã€‚" },
                    { text: "ãƒ«ãƒ¼ãƒ«ã‚’<ruby>å®ˆ<rt>ã¾ã‚‚</rt></ruby>ã£ã¦ã€<ruby>è€ƒ<rt>ã‹ã‚“ãŒ</rt></ruby>ãˆã‚‹<ruby>åŠ›<rt>ã¡ã‹ã‚‰</rt></ruby>ã‚‚<ruby>ä¼¸<rt>ã®</rt></ruby>ã°ã—ã¾ã™ï¼ã ã‹ã‚‰ã€<ruby>åƒ•<rt>ã¼ã</rt></ruby>ã«<ruby>æŠ•è³‡<rt>ã¨ã†ã—</rt></ruby>ã—ã¦ãã ã•ã„ï¼", score: 20, response_speaker: "papa", response_text: "ã‚ˆã—ï¼ã€Œ<ruby>æŠ•è³‡<rt>ã¨ã†ã—</rt></ruby>ã—ã¦ãã‚Œã€ã¨ã¯<ruby>é ¼<rt>ãŸã®</rt></ruby>ã‚‚ã—ã„ãªï¼" }
                ]
            }
        ];

        let currentStep = 0;
        let points = 0;

        const charImg = document.getElementById("char-img");
        const charIcon = document.getElementById("char-icon");
        const msgBox = document.getElementById("msg-box");
        const msgName = document.getElementById("msg-name");
        const msgText = document.getElementById("msg-text");
        const optionsBox = document.getElementById("options-box");
        const nextBtn = document.getElementById("next-btn");

        function renderSpeaker(speakerId) {
            const char = chars[speakerId];
            msgName.textContent = char.name;
            msgName.style.backgroundColor = char.color;
            msgBox.style.borderColor = char.border;

            if (char.type === "img") {
                charImg.src = char.src;
                charImg.style.display = "block";
                charIcon.style.display = "none";
            } else {
                charIcon.textContent = char.src;
                charIcon.style.borderColor = char.border;
                charIcon.style.display = "flex";
                charImg.style.display = "none";
            }
        }

        function advance() {
            if (currentStep >= scenario.length) {
                showEnding();
                return;
            }

            const step = scenario[currentStep];
            renderSpeaker(step.speaker);
            msgText.innerHTML = step.text;
            msgBox.style.display = "block";

            if (step.type === "msg") {
                optionsBox.style.display = "none";
                nextBtn.style.display = "block";
            } else if (step.type === "question") {
                optionsBox.innerHTML = "";
                step.options.forEach(opt => {
                    const btn = document.createElement("button");
                    btn.className = "option-btn";
                    btn.innerHTML = opt.text;
                    btn.onclick = () => selectOption(opt);
                    optionsBox.appendChild(btn);
                });
                optionsBox.style.display = "flex";
                nextBtn.style.display = "none";
            }
        }

        function selectOption(opt) {
            // ãƒã‚¤ãƒ³ãƒˆè¨ˆç®—
            points += opt.score;
            if (points < 0) points = 0;
            if (points > 100) points = 100;

            // ãƒ¡ãƒ¼ã‚¿ãƒ¼æ›´æ–°
            const bar = document.getElementById("meter-bar");
            const text = document.getElementById("meter-text");
            bar.style.width = points + "%";
            text.textContent = points + " / 100";
            if (points >= 100) bar.style.backgroundColor = "#4CAF50";
            else if (points >= 60) bar.style.backgroundColor = "#ff9800";
            else bar.style.backgroundColor = "#f44336";

            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤º
            const popup = document.createElement("div");
            popup.className = "point-popup" + (opt.score < 0 ? " negative" : "");
            popup.textContent = (opt.score >= 0 ? "+" : "") + opt.score;
            document.getElementById("game-area").appendChild(popup);
            setTimeout(() => popup.remove(), 1000);

            // æ¬¡ã®åå¿œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å³å¸­ã§å·®ã—è¾¼ã‚€
            scenario.splice(currentStep + 1, 0, {
                type: "msg",
                speaker: opt.response_speaker,
                text: opt.response_text
            });

            currentStep++;
            advance();
        }

        function nextStep() {
            currentStep++;
            advance();
        }

        function showEnding() {
            msgBox.style.display = "none";
            optionsBox.style.display = "none";
            nextBtn.style.display = "none";
            document.getElementById("char-display").style.display = "none";

            const endBox = document.getElementById("ending-box");
            endBox.style.display = "block";

            let title = "";
            let text = "";
            let icon = "";

            if (points >= 100) {
                title = "ğŸ‰ <ruby>å¤§æˆåŠŸ<rt>ã ã„ã›ã„ã“ã†</rt></ruby>ï¼";
                text = "<ruby>å®Œç’§<rt>ã‹ã‚“ãºã</rt></ruby>ãªãƒ—ãƒ¬ã‚¼ãƒ³ã ã€‚ãã¿ã®<ruby>æœªæ¥<rt>ã¿ã‚‰ã„</rt></ruby>ã«<ruby>æŠ•è³‡<rt>ã¨ã†ã—</rt></ruby>ã—ã‚ˆã†ï¼ã‚²ãƒ¼ãƒ ã‚’<ruby>è²·<rt>ã‹</rt></ruby>ã£ã¦ã‚ã’ã‚‹ã‚ˆï¼";
                icon = "ğŸ‘¨â€ğŸ’¼âœ¨";
            } else if (points >= 60) {
                title = "ğŸ‘ <ruby>æˆåŠŸ<rt>ã›ã„ã“ã†</rt></ruby>ï¼";
                text = "ã‚ˆã—ã€ãã“ã¾ã§<ruby>ç†±æ„<rt>ã­ã¤ã„</rt></ruby>ãŒã‚ã‚‹ãªã‚‰ã€ãŠ<ruby>çš¿æ´—<rt>ã•ã‚‰ã‚ã‚‰</rt></ruby>ã„ã® ãŠ<ruby>æ‰‹ä¼<rt>ã¦ã¤ã </rt></ruby>ã„ã‚’<ruby>æ¡ä»¶<rt>ã˜ã‚‡ã†ã‘ã‚“</rt></ruby>ã« <ruby>è²·<rt>ã‹</rt></ruby>ã£ã¦ã‚ã’ã‚ˆã†ï¼";
                icon = "ğŸ‘¨â€ğŸ’¼ğŸ‘";
            } else {
                title = "ğŸ˜¢ <ruby>å¤±æ•—<rt>ã—ã£ã±ã„</rt></ruby>â€¦";
                text = "ã†ãƒ¼ã‚“ã€‚ã¾ã <ruby>ç´å¾—<rt>ãªã£ã¨ã</rt></ruby>ã§ããªã„ãªã€‚ã‚‚ã†<ruby>ä¸€åº¦<rt>ã„ã¡ã©</rt></ruby>ã‚ˆã<ruby>è€ƒ<rt>ã‹ã‚“ãŒ</rt></ruby>ãˆã¦ã‹ã‚‰ãŠã„ã§ã€‚";
                icon = "ğŸ‘¨â€ğŸ’¼ğŸ’§";
            }

            document.getElementById("ending-icon").textContent = icon;
            document.getElementById("ending-title").innerHTML = title;
            document.getElementById("ending-text").innerHTML = text;

            if (points >= 60 && !pointsGiven) {
                const pointBtn = document.getElementById("point-btn");
                pointBtn.style.display = "block";
            }
        }

        let pointsGiven = false;
        function getPoints() {
            if (pointsGiven) return;
            pointsGiven = true;

            const pointBtn = document.getElementById("point-btn");
            if (pointBtn) {
                pointBtn.disabled = true;
                pointBtn.textContent = 'âœ… ã‚‚ã‚‰ã£ãŸï¼';
                pointBtn.style.backgroundColor = '#999';
                pointBtn.style.boxShadow = '0 6px 0 #777';
            }

            if (typeof showPointGetDialog === 'function') {
                showPointGetDialog(50, 'quest_stage1');
            } else {
                alert('50ãƒã‚¤ãƒ³ãƒˆ ã‚‚ã‚‰ã£ãŸã‚ˆï¼');
            }
        }

        // åˆæœŸåŒ–
        advance();

    </script>
</body>

</html>